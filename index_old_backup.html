<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArnavutkÃ¶y Belediyesi - JD-R Anket</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        .material-icons { vertical-align: middle; }
        
        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
            background: #F7F8FA;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        /* SIDEBAR */
        .sidebar {
            width: 270px;
            background: #ffffff;
            color: #1a1a1a;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 8px rgba(0,0,0,0.05);
            border-right: 1px solid #e5e7eb;
        }
        
        .sidebar-header {
            padding: 20px 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .sidebar-header-text {
            flex: 1;
        }
        
        .sidebar-menu {
            flex: 1;
            overflow-y: auto;
            padding: 12px 0;
        }
        
        .menu-category {
            padding: 8px 20px 4px 20px;
            font-size: 11px;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 16px;
        }
        
        .menu-category:empty {
            display: none;
            margin: 0;
            padding: 0;
        }
        
        .menu-category:first-child {
            margin-top: 0;
        }
        
        .menu-category:last-of-type {
            margin-top: auto;
            padding-top: 12px;
            border-top: 1px solid #e5e7eb;
        }
        
        .menu-item {
            padding: 10px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.15s;
            border-left: 3px solid transparent;
            font-size: 14px;
            color: #374151;
            font-weight: 500;
            margin: 2px 0;
        }
        
        .menu-item:hover {
            background: rgba(74, 144, 226, 0.08);
            color: #1a1a1a;
        }
        
        .menu-item.active {
            background: rgba(74, 144, 226, 0.1);
            border-left-color: #4A90E2;
            color: #4A90E2;
            font-weight: 600;
        }
        
        .menu-item-icon {
            font-size: 20px;
            width: 22px;
            text-align: center;
            opacity: 0.7;
        }
        
        .menu-item.active .menu-item-icon {
            opacity: 1;
        }
        
        .menu-item-important {
            background: #f8fbff;
            border-left: 3px solid #4A90E2;
            font-weight: 600;
            margin: 2px 12px;
            border-radius: 6px;
            padding: 12px 16px;
        }
        
        .menu-item-important:hover {
            background: rgba(74, 144, 226, 0.08);
            transform: translateX(2px);
        }
        
        .menu-item-important.active {
            background: #4A90E2;
            color: white;
            border-left-color: #2563eb;
        }
        
        .menu-item-important.active .menu-item-icon {
            color: white;
        }
        
        .menu-category:last-of-type {
            margin-top: auto;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
        }
        
        /* MAIN CONTENT */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #F7F8FA;
            position: relative;
        }
        
        .content-header {
            background: #ffffff;
            padding: 20px 32px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border-bottom: 1px solid #e5e7eb;
        }
        
        .content-header h2 {
            font-size: 20px;
            color: #1a1a1a;
            margin-bottom: 0;
            font-weight: 600;
        }
        
        .content-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px 32px 60px 32px;
            background: #F7F8FA;
        }
        
        .footer-signature {
            position: fixed;
            bottom: 16px;
            right: 32px;
            font-size: 13px;
            color: #4A90E2;
            font-weight: 700;
            background: white;
            padding: 8px 16px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.2);
            border: 1px solid #e5e7eb;
        }
        
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* BUTTONS */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .btn-danger { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); }
        .btn-small { padding: 6px 12px; font-size: 12px; }
        .btn-reset { background: #6c757d; padding: 8px 16px; font-size: 13px; margin: 0; }
        .btn-reset:hover { background: #5a6268; transform: none; }
        
        /* TABLES */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border-radius: 12px;
            overflow: hidden;
            margin: 15px 0;
            font-size: 13px;
            border: 1px solid #e5e7eb;
        }
        
        th {
            background: #f9fafb;
            color: #374151;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 1px solid #e5e7eb;
        }
        
        td {
            padding: 10px 8px;
            border-bottom: 1px solid #f3f4f6;
            color: #1f2937;
        }
        
        tr:hover { background: #f9fafb; }
        tr:nth-child(even) { background: #fafafa; }
        tr:hover:nth-child(even) { background: #f9fafb; }
        
        .highlight { background: #fef3c7 !important; font-weight: 600; }
        .positive { color: #10b981; font-weight: 600; }
        .negative { color: #ef4444; font-weight: 600; }
        
        /* INFO BOXES */
        .info-box, .warning-box {
            padding: 14px 16px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 3px solid;
            font-size: 13px;
        }
        
        .info-box {
            background: #eff6ff;
            border-color: #4A90E2;
            color: #1e40af;
        }
        
        .warning-box {
            background: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
        }
        
        .success-message {
            background: #d1fae5;
            border: 1px solid #a7f3d0;
            color: #065f46;
            padding: 14px 16px;
            border-radius: 10px;
            margin: 10px 0;
            animation: slideDown 0.3s;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* STATS CARDS */
        .stats-card {
            background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 10px 10px 10px 0;
            box-shadow: 0 2px 8px rgba(74, 144, 226, 0.2);
            display: inline-block;
            min-width: 150px;
        }
        
        .stats-card h3 { font-size: 13px; margin-bottom: 8px; opacity: 0.9; font-weight: 500; }
        .stats-card p { font-size: 28px; font-weight: 700; }
        
        /* FORM ELEMENTS */
        select {
            padding: 10px 14px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            min-width: 300px;
            cursor: pointer;
            background: white;
            color: #1f2937;
        }
        
        select:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }
        
        .filter-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            padding: 12px 16px;
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .filter-bar input {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 13px;
            flex: 1;
            max-width: 300px;
        }
        
        .filter-bar input:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }
        
        /* TABLE CONTAINER */
        .table-container {
            overflow-x: auto;
            max-height: 70vh;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
        }
        
        /* EXCEL TABLE */
        .excel-table { font-size: 12px; }
        
        .excel-table thead th {
            position: sticky;
            top: 0;
            background: #f3f4f6;
            color: #374151;
            padding: 8px 4px;
            font-size: 11px;
            z-index: 10;
            border: 1px solid #e5e7eb;
        }
        
        .excel-table tbody td {
            border: 1px solid #e5e7eb;
            padding: 6px 4px;
            min-width: 40px;
            text-align: center;
            background: white;
        }
        
        .excel-table tbody td[contenteditable="true"] {
            cursor: text;
        }
        
        .excel-table tbody td[contenteditable="true"]:focus {
            outline: 2px solid #4A90E2;
            background: #eff6ff;
        }
        
        .excel-table tbody td.filled { background: #d1fae5; }
        .excel-table tbody tr:hover td { background: #f9fafb; }
        .excel-table tbody tr:hover td.filled { background: #a7f3d0; }
        
        /* SORTABLE HEADERS */
        .sortable-header {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 20px;
            transition: all 0.2s;
        }
        
        .sortable-header:hover { background: #e5e7eb; }
        
        .sort-icon {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            opacity: 0.6;
        }
        
        .sortable-header.sorted-asc .sort-icon::after,
        .sortable-header.sorted-desc .sort-icon::after {
            opacity: 1;
            color: #4A90E2;
        }
        
        .sortable-header.sorted-asc .sort-icon::after { content: 'â–²'; }
        .sortable-header.sorted-desc .sort-icon::after { content: 'â–¼'; }
        .sortable-header:not(.sorted-asc):not(.sorted-desc) .sort-icon::after { content: 'â‡…'; }
        
        /* SORU HIGHLIGHT */
        .soru-highlighted {
            background: #fff9e6 !important;
            border-left: 4px solid #f59e0b;
        }
        
        .soru-highlighted td {
            background: #fef3c7 !important;
            font-weight: 700 !important;
        }
        
        .soru-highlighted:hover td {
            background: #fde68a !important;
        }
        
        /* SORULAR TABLOSU */
        #sorularTable th {
            min-width: 180px;
            text-align: center;
            vertical-align: middle;
            white-space: normal;
            padding: 16px 12px;
        }
        
        #sorularTable th:first-child {
            min-width: 400px;
            text-align: left;
        }
        
        #sorularTable td {
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            min-width: 180px;
        }
        
        #sorularTable td:first-child {
            text-align: left;
            min-width: 400px;
            font-weight: 400;
            padding: 12px 16px;
        }
        
        #sorularTable tbody tr:hover {
            background: #f9fafb;
        }
        
        #sorularTable .highlight {
            background: #fef3c7 !important;
        }
        
        #sorularTable .highlight:hover {
            background: #fde68a !important;
        }
        
        /* LABELS & TAGS */
        .code-label {
            background: #4A90E2;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
        }
        
        #sorularTable .code-label {
            display: inline-block;
            margin-bottom: 6px;
        }
        
        .anket-tag {
            display: inline-block;
            background: #4A90E2;
            color: white;
            padding: 4px 8px;
            margin: 2px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .anket-tag.gecersiz { background: #ef4444; }
        
        .anket-tag .remove-btn {
            margin-left: 6px;
            cursor: pointer;
            font-weight: bold;
            opacity: 0.8;
        }
        
        .anket-tag .remove-btn:hover { opacity: 1; }
        
        /* OPEN-ENDED QUESTIONS */
        .keyword-item {
            display: inline-block;
            position: relative;
            cursor: help;
            transition: all 0.3s;
        }
        
        .keyword-item:hover { color: #4A90E2; }
        
        .keyword-tooltip {
            display: none;
            position: absolute;
            background: #1f2937;
            color: white;
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .keyword-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #1f2937;
        }
        
        .keyword-item:hover .keyword-tooltip { display: block; }
        
        .clickable-count {
            cursor: pointer;
            color: #4A90E2;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .clickable-count:hover {
            color: #2563eb;
            transform: scale(1.05);
        }
        
        /* RESPONSES CONTAINER */
        .responses-container {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #ffffff;
            border-radius: 16px;
            animation: slideDown 0.3s;
            border: 1px solid #e5e7eb;
        }
        
        .responses-container.active { display: block; }
        
        .response-balloon {
            background: #f9fafb;
            border-radius: 10px;
            padding: 14px 18px;
            margin: 10px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border-left: 3px solid #4A90E2;
            transition: all 0.3s;
        }
        
        .response-balloon:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateX(5px);
        }
        
        .response-header {
            font-size: 11px;
            color: #4A90E2;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .response-text {
            color: #1f2937;
            line-height: 1.6;
            font-size: 14px;
        }
        
        .response-empty {
            color: #9ca3af;
            font-style: italic;
        }
        
        .responses-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .responses-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }
        
        .responses-actions {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>
    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-header-text" style="flex: 1;">
                <h1 style="font-size: 18px; margin-bottom: 4px; font-weight: 700; color: #00447c; letter-spacing: 0.5px;">ARNAVUTKÃ–Y BELEDÄ°YESÄ°</h1>
                <p style="font-size: 11px; color: #6b7280; font-weight: 500;">Anket DeÄŸerlendirme Sistemi</p>
            </div>
        </div>
        <div class="sidebar-menu" id="sidebarMenu"></div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <div class="content-header">
            <h2 id="pageTitle">Veri GiriÅŸi</h2>
        </div>
        <div class="content-body" id="contentBody"></div>
    </div>

    <script>
        'use strict';

        const CONFIG = {
            QUESTIONS_PER_SURVEY: 49,
            SOCIAL_MEDIA_COLUMNS: 8,
            MAX_TABLE_ROWS_INITIAL: 1600,
            LIKERT_SCALE_MAX: 4,
            VALIDATION_CONTROL_QUESTION: 44,
            CONSISTENCY_CHECK_QUESTIONS: [24, 43],
            CONSISTENCY_THRESHOLD: 2,
            TOP_KEYWORDS: 5,
            MESSAGE_TIMEOUT: 5000
        };

        const KELIME_GRUPLARI = {
            'YÃ¶netici': ['amir', 'yÃ¶netici', 'mÃ¼dÃ¼r', 'ÅŸef', 'baÅŸkan', 'amirlik'],
            'Yemek': ['yemek', 'yemekhane', 'kahvaltÄ±', 'Ã¶ÄŸle', 'akÅŸam', 'menÃ¼', 'mutfak'],
            'Temizlik': ['temizlik', 'hijyen', 'pis', 'kirli', 'dÃ¼zen', 'tertip'],
            'MaaÅŸ': ['maaÅŸ', 'Ã¼cret', 'Ã¶deme', 'para', 'prim', 'ikramiye', 'hak'],
            'EÄŸitim': ['eÄŸitim', 'kurs', 'seminer', 'geliÅŸim', 'Ã¶ÄŸrenme', 'ders'],
            'Servis': ['servis', 'taÅŸÄ±ma', 'ulaÅŸÄ±m', 'araÃ§', 'otobÃ¼s', 'minibÃ¼s'],
            'Ä°letiÅŸim': ['iletiÅŸim', 'bilgi', 'haberleÅŸme', 'duyuru', 'haber'],
            'Fiziksel Alan': ['masa', 'sandalye', 'oda', 'alan', 'mekan', 'ofis'],
            'Ä°klim': ['sÄ±cak', 'soÄŸuk', 'klima', 'Ä±sÄ±tma', 'soÄŸutma', 'havalandÄ±rma'],
            'Teknoloji': ['bilgisayar', 'yazÄ±lÄ±m', 'sistem', 'program', 'internet'],
            'Ä°ÅŸ YÃ¼kÃ¼': ['iÅŸ', 'yÃ¼k', 'fazla', 'mesai', 'zaman', 'saat'],
            'Ekip': ['ekip', 'takÄ±m', 'birlik', 'dayanÄ±ÅŸma', 'iÅŸbirliÄŸi'],
            'SaÄŸlÄ±k': ['saÄŸlÄ±k', 'hastalÄ±k', 'doktor', 'revir'],
            'GÃ¼venlik': ['gÃ¼venlik', 'koruma', 'can'],
            'AraÃ§-GereÃ§': ['malzeme', 'ekipman', 'alet', 'donanÄ±m'],
            'Sosyal': ['sosyal', 'aktivite', 'etkinlik', 'tesis'],
            'Tuvalet': ['tuvalet', 'wc', 'banyo'],
            'Ã‡ay OcaÄŸÄ±': ['Ã§ay', 'ocak', 'kahve'],
            'Park': ['park', 'otopark'],
            'Ä°zin': ['izin', 'tatil', 'dinlenme', 'rapor']
        };

        const STOPWORDS = new Set([
            've', 'veya', 'ile', 'iÃ§in', 'bir', 'bu', 'ÅŸu', 'o', 'ne', 'nasÄ±l', 
            'neden', 'gibi', 'gÃ¶re', 'kadar', 'daha', 'Ã§ok', 'az', 'ben', 'sen', 
            'biz', 'siz', 'onlar', 'var', 'yok', 'mi', 'mu', 'mÄ±', 'mÃ¼', 'da', 
            'de', 'ta', 'te', 'ama', 'fakat', 'ancak', 'ya', 'yahut', 'ki', 
            'diye', 'ÅŸey', 'ÅŸeyler', 'hem', 'hep', 'her', 'hiÃ§', 'bazÄ±', 'birÃ§ok',
            'olarak', 'olmak', 'olan', 'olduÄŸu', 'ise', 'iÅŸte', 'artÄ±k', 'sadece',
            'dÃ¼ÅŸÃ¼nÃ¼yorum', 'istiyorum', 'olmalÄ±', 'gerekli', 'memnun', 'iyi', 'kÃ¶tÃ¼',
            'soru', 'cevap', 'anket', 'evet', 'hayÄ±r'
        ]);

        const SENTIMENT_WORDS = {
            positive: [
                'memnun', 'iyi', 'gÃ¼zel', 'harika', 'mÃ¼kemmel', 'baÅŸarÄ±lÄ±', 'teÅŸekkÃ¼r',
                'kaliteli', 'yeterli', 'pratik', 'hÄ±zlÄ±', 'gÃ¼Ã§lÃ¼', 'uyumlu', 'rahat',
                'dÃ¼zenli', 'temiz', 'hijyenik', 'lezzetli', 'taze', 'Ã§eÅŸitli',
                'destekleyici', 'yardÄ±mcÄ±', 'saygÄ±lÄ±', 'adil', 'ÅŸeffaf', 'profesyonel',
                'verimli', 'etkili', 'kolay', 'anlaÅŸÄ±lÄ±r', 'net', 'pozitif', 'mutlu',
                'keyifli', 'konforlu', 'modern', 'yenilikÃ§i', 'geliÅŸmiÅŸ', 'uygun'
            ],
            negative: [
                'kÃ¶tÃ¼', 'yetersiz', 'sorun', 'problem', 'eksik', 'pis', 'kirli',
                'dÃ¼zensiz', 'karÄ±ÅŸÄ±k', 'belirsiz', 'zor', 'yavaÅŸ', 'eski', 'bozuk',
                'arÄ±zalÄ±', 'kalitesiz', 'lezzetsiz', 'bayat', 'az', 'dar', 'sÄ±kÄ±ÅŸÄ±k',
                'gÃ¼rÃ¼ltÃ¼lÃ¼', 'rahatsÄ±z', 'stresli', 'gergin', 'yorucu', 'zorlu',
                'adaletsiz', 'ayrÄ±mcÄ±', 'saygÄ±sÄ±z', 'ilgisiz', 'duyarsÄ±z', 'geÃ§',
                'yok', 'hiÃ§', 'asla', 'kesinlikle', 'Ã§ok fazla', 'Ã§ok az', 'berbat',
                'rezalet', 'felaket', 'soÄŸuk', 'sÄ±cak', 'nemli', 'havasÄ±z', 'karanlÄ±k'
            ]
        };

        const MUDURLUKLER = {
            101: { name: 'AFET Ä°ÅžLERÄ° MÃœDÃœRLÃœÄžÃœ', personel: 12 },
            102: { name: 'AKILLI ULAÅžIM SÄ°STEMLERÄ° MÃœDÃœRLÃœÄžÃœ', personel: 19 },
            103: { name: 'BASIN VE YAYIN MÃœDÃœRLÃœÄžÃœ', personel: 21 },
            104: { name: 'DESTEK HÄ°ZMETLERÄ° MÃœDÃœRLÃœÄžÃœ', personel: 366 },
            105: { name: 'EMLAK VE Ä°STÄ°MLAK MÃœDÃœRLÃœÄžÃœ', personel: 26 },
            106: { name: 'FEN Ä°ÅžLERÄ° MÃœDÃœRLÃœÄžÃœ', personel: 120 },
            107: { name: 'GELÄ°RLER MÃœDÃœRLÃœÄžÃœ', personel: 39 },
            108: { name: 'GENÃ‡LÄ°K VE SPOR HÄ°ZMETLERÄ° MÃœDÃœRLÃœÄžÃœ', personel: 131 },
            109: { name: 'HALKLA Ä°LÄ°ÅžKÄ°LER MÃœDÃœRLÃœÄžÃœ', personel: 30 },
            110: { name: 'HUKUK Ä°ÅžLERÄ° MÃœDÃœRLÃœÄžÃœ', personel: 11 },
            111: { name: 'Ä°KLÄ°M DEÄžÄ°ÅžÄ°KLÄ°ÄžÄ° VE SIFIR ATIK MÃœDÃœRLÃœÄžÃœ', personel: 24 },
            112: { name: 'Ä°MAR VE ÅžEHÄ°RCÄ°LÄ°K MÃœDÃœRLÃœÄžÃœ', personel: 47 },
            113: { name: 'Ä°NOVASYON VE TEKNOLOJÄ° MÃœDÃœRLÃœÄžÃœ', personel: 41 },
            114: { name: 'Ä°NSAN KAYNAKLARI VE EÄžÄ°TÄ°M MÃœDÃœRLÃœÄžÃœ', personel: 13 },
            115: { name: 'Ä°ÅžLETME VE Ä°ÅžTÄ°RAKLER MÃœDÃœRLÃœÄžÃœ', personel: 18 },
            116: { name: 'KOORDÄ°NASYON Ä°ÅžLERÄ° MÃœDÃœRLÃœÄžÃœ', personel: 6 },
            117: { name: 'KÃœLTÃœR Ä°ÅžLERÄ° MÃœDÃœRLÃœÄžÃœ', personel: 87 },
            118: { name: 'MALÄ° HÄ°ZMETLER MÃœDÃœRLÃœÄžÃœ', personel: 9 },
            119: { name: 'MUHTARLIK Ä°ÅžLERÄ° MÃœDÃœRLÃœÄžÃœ', personel: 5 },
            120: { name: 'Ã–ZEL KALEM MÃœDÃœRLÃœÄžÃœ', personel: 15 },
            121: { name: 'PARK VE BAHÃ‡ELER MÃœDÃœRLÃœÄžÃœ', personel: 85 },
            122: { name: 'PLAN VE PROJE MÃœDÃœRLÃœÄžÃœ', personel: 17 },
            123: { name: 'RUHSAT VE DENETÄ°M MÃœDÃœRLÃœÄžÃœ', personel: 12 },
            124: { name: 'SOSYAL DESTEK HÄ°ZMETLERÄ° MÃœDÃœRLÃœÄžÃœ', personel: 98 },
            125: { name: 'STRATEJÄ° GELÄ°ÅžTÄ°RME MÃœDÃœRLÃœÄžÃœ', personel: 10 },
            126: { name: 'TEMÄ°ZLÄ°K Ä°ÅžLERÄ° MÃœDÃœRLÃœÄžÃœ', personel: 578 },
            127: { name: 'VETERÄ°NER Ä°ÅžLERÄ° MÃœDÃœRLÃœÄžÃœ', personel: 38 },
            1288: { name: 'YAPI KONTROL MÃœDÃœRLÃœÄžÃœ', personel: 37 },
            129: { name: 'YAZI Ä°ÅžLERÄ° MÃœDÃœRLÃœÄžÃœ', personel: 37 },
            130: { name: 'ZABITA MÃœDÃœRLÃœÄžÃœ', personel: 135 }
        };

        const SORULAR = [
            "YaptÄ±ÄŸÄ±m iÅŸ, yetenek ve becerilerimle uyumludur.",
            "Bu iÅŸi seÃ§tiÄŸim iÃ§in mutluyum.",
            "YaptÄ±ÄŸÄ±m iÅŸi anlamlÄ± buluyorum.",
            "GÃ¶rev tanÄ±mÄ±m ve sorumluluklarÄ±m aÃ§Ä±kÃ§a belirlenmiÅŸtir.",
            "Birimimde hangi iÅŸlerin kimin sorumluluÄŸunda olduÄŸu nettir.",
            "Yetki ve karar sÄ±nÄ±rlarÄ±m konusunda belirsizlik yaÅŸamam.",
            "GÃ¶rev ve talimatlar birbiriyle uyumludur.",
            "Ä°ÅŸim gereÄŸi duygusal olarak zorlayÄ±cÄ± durumlarla oldukÃ§a sÄ±k karÅŸÄ±laÅŸÄ±rÄ±m.",
            "GÃ¼n iÃ§inde yetiÅŸtirmem gereken gÃ¶revler Ã§oÄŸu zaman fazla olur.",
            "VatandaÅŸ/baÅŸvuru talep yoÄŸunluÄŸu iÅŸim gereÄŸi fazladÄ±r.",
            "Ä°ÅŸimi tamamlamak iÃ§in sÄ±k sÄ±k zaman sÄ±kÄ±ÅŸÄ±klÄ±ÄŸÄ± yaÅŸarÄ±m.",
            "Ä°htiyaÃ§ duyduÄŸumda amirime kolaylÄ±kla ulaÅŸabilirim.",
            "Amirimin verdiÄŸi geri bildirimler geliÅŸimime yardÄ±mcÄ± olur.",
            "Sorun yaÅŸadÄ±ÄŸÄ±mda amirim destek olmak iÃ§in Ã§aba gÃ¶sterir.",
            "Kendi Ã§alÄ±ÅŸmamÄ± etkileyen kararlara katÄ±lma ve fikirlerimi sÃ¶yleme fÄ±rsatÄ± buluyorum.",
            "Amirim Ã§alÄ±ÅŸanlara eÅŸit yaklaÅŸÄ±r, ayrÄ±mcÄ±lÄ±k yapmaz.",
            "Amirim bana karÅŸÄ± saygÄ±lÄ±dÄ±r.",
            "Ä°ÅŸ arkadaÅŸlarÄ±mla uyum iÃ§inde Ã§alÄ±ÅŸÄ±rÄ±m.",
            "Ekibimizde dayanÄ±ÅŸma gÃ¼Ã§lÃ¼dÃ¼r.",
            "Bilgi ve deneyim paylaÅŸÄ±mÄ± yaygÄ±ndÄ±r.",
            "Ä°ÅŸ arkadaÅŸlarÄ±mÄ±n teknik/sosyal desteÄŸi iÅŸimi kolaylaÅŸtÄ±rÄ±r.",
            "AnlaÅŸmazlÄ±klarÄ± iÅŸ arkadaÅŸlarÄ±mÄ±zla kendi aramÄ±zda Ã§Ã¶zeriz.",
            "YaptÄ±ÄŸÄ±mÄ±z Ã¶neri ve geri bildirimlerin sonuÃ§larÄ± hakkÄ±nda bilgilendiriliriz.",
            "Belediyede alÄ±nan karar ve geliÅŸmelerden iletiÅŸim kanallarÄ± Ã¼zerinden haberdar edilirim.",
            "Bu kurumda Ã§alÄ±ÅŸmaktan genel olarak memnunum.",
            "Ã‡alÄ±ÅŸma alanlarÄ±mÄ±n temizliÄŸi yeterlidir.",
            "IsÄ±tma/soÄŸutma (iklimlendirme) sistemleri yeterlidir.",
            "Bireysel Ã§alÄ±ÅŸma alanÄ±m (masa, sandalye, priz vb.) iÅŸimi rahat yapmama elveriÅŸlidir.",
            "Ortak alanlar (Ã§ay ocaÄŸÄ±, dinlenme alanÄ±, tuvaletler vb.) yeterlidir.",
            "Yemekhane/yemek hizmeti kalitesinden memnunum.",
            "Ä°ÅŸ saÄŸlÄ±ÄŸÄ± ve gÃ¼venliÄŸi (Ä°SG) uygulamalarÄ± dÃ¼zenli ve yeterlidir.",
            "Servis (ulaÅŸÄ±m) hizmeti kalitesi yeterlidir.",
            "SaÄŸlanan teknoloji altyapÄ±sÄ± yeterlidir.",
            "Piyasa koÅŸullarÄ±yla kÄ±yaslandÄ±ÄŸÄ±nda verilen Ã¼cretler makuldÃ¼r.",
            "Ä°ÅŸim aracÄ±lÄ±ÄŸÄ±yla topluma/kamuya hizmet etmekten gurur duyuyorum.",
            "Topluma gerÃ§ekten katkÄ± sunmak isteyen birine, kamu kurumlarÄ±nda Ã§alÄ±ÅŸmayÄ± tavsiye ederim.",
            "YaptÄ±ÄŸÄ±m iÅŸin toplum iÃ§in anlamlÄ± ve faydalÄ± olduÄŸunu dÃ¼ÅŸÃ¼nÃ¼yorum.",
            "Yetkinlik BazlÄ± Performans deÄŸerlendirme kriterleri nettir.",
            "Yetkinlik BazlÄ± Performans deÄŸerlendirme kriterleri adildir.",
            "PerformansÄ±m dÃ¼zenli aralÄ±klarla deÄŸerlendirilir.",
            "DeÄŸerlendirme sonrasÄ±nda yapÄ±cÄ± geri bildirim alÄ±rÄ±m.",
            "Kurumda yapÄ±lan eÄŸitim faaliyetlerini yeterli buluyorum.",
            "YapÄ±lan eÄŸitimlerin kiÅŸisel ve mesleki geliÅŸimime katkÄ±sÄ± olduÄŸunu dÃ¼ÅŸÃ¼nÃ¼yorum.",
            "Bu kurumda Ã§alÄ±ÅŸmaktan genel olarak memnunum.",
            "Dikkat kontrol sorusu (3 olmalÄ±)",
            "Son 2 hafta iÃ§inde, zevk aldÄ±ÄŸÄ±m ÅŸeylere karÅŸÄ± keyif alamadÄ±ÄŸÄ±m gÃ¼nler Ã§ok oldu.",
            "Son 2 hafta iÃ§inde, kendimi sÄ±k sÄ±k Ã¼zgÃ¼n, Ã§Ã¶kkÃ¼n veya umutsuz hissettim.",
            "Son 2 haftada, sÄ±k sÄ±k gergin veya kaygÄ±lÄ± hissettim.",
            "Son 2 haftada, endiÅŸelerimi kontrol etmekte zorlandÄ±ÄŸÄ±m gÃ¼nler Ã§ok oldu."
        ];

        const THEME_QUESTIONS = {
            calismaKosullari: [25, 26, 27, 28, 29, 30, 31, 32, 33],
            yoneticilerleIliskiler: [11, 12, 13, 14, 15, 16],
            calismaArkadaslari: [17, 18, 19, 20, 21],
            kamuHizmetiMotivasyonu: [34, 35, 36],
            gorevRolNetligi: [3, 4, 5, 6],
            isKisiUyumu: [0, 1, 2],
            hizmetTalepYogunlugu: [7, 8, 9, 10],
            kurumIciIletisim: [22, 23],
            yetkinlikPerformans: [37, 38, 39, 40],
            egitimGelisim: [41, 42]
        };

        const THEME_INFO = {
            calismaKosullari: {
                title: 'Ã‡alÄ±ÅŸma KoÅŸullarÄ±',
                icon: 'ðŸ¢',
                keywords: ['temizlik', 'masa', 'oda', 'yemek', 'servis', 'klima', 'Ä±sÄ±tma', 'teknoloji', 'maaÅŸ', 'Ã¼cret'],
                description: 'Fiziksel Ã§alÄ±ÅŸma ortamÄ±, hijyen standartlarÄ±, yemek-ulaÅŸÄ±m hizmetleri, teknolojik altyapÄ± ve Ã¼cret adaleti'
            },
            yoneticilerleIliskiler: {
                title: 'YÃ¶neticilerle Ä°liÅŸkiler',
                icon: 'ðŸ‘”',
                keywords: ['amir', 'yÃ¶netici', 'mÃ¼dÃ¼r', 'destek', 'geri bildirim', 'saygÄ±'],
                description: 'Amirler ve mÃ¼dÃ¼rlere ulaÅŸÄ±labilirlik, yÃ¶netici desteÄŸi, geliÅŸim amaÃ§lÄ± geri bildirim, karar sÃ¼reÃ§lerine katÄ±lÄ±m ve yÃ¶netici adaleti'
            },
            calismaArkadaslari: {
                title: 'Ã‡alÄ±ÅŸma ArkadaÅŸlarÄ±',
                icon: 'ðŸ‘¥',
                keywords: ['ekip', 'takÄ±m', 'arkadaÅŸ', 'dayanÄ±ÅŸma', 'iÅŸbirliÄŸi', 'paylaÅŸÄ±m'],
                description: 'Ekip iÃ§i uyum, Ã§alÄ±ÅŸma arkadaÅŸlarÄ± arasÄ± dayanÄ±ÅŸma, bilgi paylaÅŸÄ±mÄ± kÃ¼ltÃ¼rÃ¼ ve sosyal destek dÃ¼zeyi'
            },
            kamuHizmetiMotivasyonu: {
                title: 'Kamu Hizmeti Motivasyonu',
                icon: 'ðŸŽ–ï¸',
                keywords: ['toplum', 'hizmet', 'kamu', 'gurur', 'fayda', 'katkÄ±'],
                description: 'Kamusal misyon bilinci, toplumsal fayda odaklÄ±lÄ±k, kamu hizmeti deÄŸeri ve kurumsal aidiyet hissi'
            },
            gorevRolNetligi: {
                title: 'GÃ¶rev ve Rol NetliÄŸi',
                icon: 'ðŸ“‹',
                keywords: ['gÃ¶rev', 'sorumluluk', 'yetki', 'talimat', 'belirsiz', 'net'],
                description: 'GÃ¶rev tanÄ±mlarÄ±nÄ±n aÃ§Ä±klÄ±ÄŸÄ±, sorumluluk alanlarÄ±nÄ±n netliÄŸi, yetki-karar sÄ±nÄ±rlarÄ± ve talimat tutarlÄ±lÄ±ÄŸÄ±'
            },
            isKisiUyumu: {
                title: 'Ä°ÅŸ-KiÅŸi Uyumu',
                icon: 'ðŸŽ¯',
                keywords: ['iÅŸ', 'uyum', 'yetenek', 'beceri', 'mutlu', 'anlamlÄ±'],
                description: 'Ã‡alÄ±ÅŸanlarÄ±n mevcut gÃ¶revlerinin yetenek ve becerilerine uygunluÄŸu, iÅŸ tatmini ve iÅŸin anlamlÄ±lÄ±ÄŸÄ± algÄ±sÄ±'
            },
            hizmetTalepYogunlugu: {
                title: 'Hizmet ve Talep YoÄŸunluÄŸu',
                icon: 'âš¡',
                keywords: ['yoÄŸunluk', 'iÅŸ yÃ¼kÃ¼', 'zaman', 'yetiÅŸ', 'talep', 'vatandaÅŸ'],
                description: 'Ä°ÅŸ yoÄŸunluÄŸu, zaman baskÄ±sÄ±, duygusal emek gereksinimi ve hizmet talep dÃ¼zeyi'
            },
            kurumIciIletisim: {
                title: 'Kurum Ä°Ã§i Ä°letiÅŸim',
                icon: 'ðŸ’¬',
                keywords: ['iletiÅŸim', 'bilgi', 'duyuru', 'haber', 'karar', 'geliÅŸme'],
                description: 'Kurumsal bilgi akÄ±ÅŸÄ±, geri bildirim mekanizmalarÄ±, ÅŸeffaflÄ±k ve Ã§alÄ±ÅŸanÄ±n karar sÃ¼reÃ§lerinden haberdar olma dÃ¼zeyi'
            },
            yetkinlikPerformans: {
                title: 'Yetkinlik ve Performans',
                icon: 'ðŸ“Š',
                keywords: ['performans', 'deÄŸerlendirme', 'kriter', 'adil', 'geri bildirim'],
                description: 'Performans deÄŸerlendirme sisteminin ÅŸeffaflÄ±ÄŸÄ±, kriterlerin netliÄŸi, sÃ¼reÃ§ adaleti ve geliÅŸimsel geri bildirim'
            },
            egitimGelisim: {
                title: 'EÄŸitim ve GeliÅŸim',
                icon: 'ðŸ“š',
                keywords: ['eÄŸitim', 'kurs', 'seminer', 'geliÅŸim', 'Ã¶ÄŸrenme'],
                description: 'Kurumsal eÄŸitim programlarÄ±nÄ±n yeterliliÄŸi, mesleki geliÅŸim fÄ±rsatlarÄ± ve eÄŸitimlerin etkililiÄŸi'
            }
        };

        const MENU_ITEMS = [
            { category: '', items: [
                { id: 'dashboard', icon: 'home', title: 'Ana Dashboard', highlight: true }
            ]},
            { category: 'DETAYLI ANALÄ°ZLER', items: [
                { id: 'genel-skorlar', icon: 'dashboard', title: 'Genel Memnuniyet OranlarÄ±' },
                { id: 'temalar', icon: 'insights', title: 'Konular Ãœzerinden Analiz' },
                { id: 'sosyal-medya', icon: 'groups', title: 'Sosyal Medya Takip OranlarÄ±' },
                { id: 'ruh-sagligi', icon: 'smoking_rooms', title: 'Ruh SaÄŸlÄ±ÄŸÄ± TaramasÄ±' },
                { id: 'sorular', icon: 'analytics', title: 'Sorular Ãœzerinden Analiz' },
                { id: 'mudurluk-karsilastir', icon: 'compare_arrows', title: 'MÃ¼dÃ¼rlÃ¼k KarÅŸÄ±laÅŸtÄ±rma' },
                { id: 'mudurluk-sec', icon: 'check_circle_outline', title: 'MÃ¼dÃ¼rlÃ¼k Detay Analizi' },
                { id: 'acik-uclu', icon: 'rule', title: 'AÃ§Ä±k UÃ§lu Cevaplar' }
            ]},
            { category: 'VERÄ° PANELÄ°', items: [
                { id: 'veri-girisi', icon: 'input', title: 'Veri GiriÅŸi' },
                { id: 'girilen-anketler', icon: 'list_alt', title: 'Girilen Anketler' }
            ]}
        ];

        const state = {
            allSurveys: [],
            processedData: null,
            currentOpenResponses: null,
            charts: {}
        };

        const utils = {
            formatPercentage: (value) => {
                const num = parseFloat(value);
                return isNaN(num) ? '0' : num.toFixed(1);
            },

            calculateAverage: (surveys, questionIndices) => {
                const { total, count } = surveys.reduce((acc, survey) => {
                    questionIndices.forEach(idx => {
                        const val = survey.cevaplar[idx];
                        if (val !== null && val !== undefined && !isNaN(val)) {
                            acc.total += val;
                            acc.count++;
                        }
                    });
                    return acc;
                }, { total: 0, count: 0 });
                
                if (count === 0) return '0';
                const average = (total / count / CONFIG.LIKERT_SCALE_MAX * 100);
                return utils.formatPercentage(average);
            },

            calculateSocialMedia: (surveys) => {
                const total = surveys.length;
                if (total === 0) return utils.getEmptySocialMediaData();
                
                const aggregated = surveys.reduce((acc, survey) => {
                    if (!survey.sosyalMedya) return acc;
                    
                    Object.keys(acc.detay).forEach(key => {
                        acc.detay[key] += survey.sosyalMedya[key] || 0;
                    });
                    
                    return acc;
                }, {
                    detay: {
                        instagram_belediye: 0, instagram_baskan: 0,
                        twitter_belediye: 0, twitter_baskan: 0,
                        facebook_belediye: 0, facebook_baskan: 0,
                        nextsosyal_belediye: 0, nextsosyal_baskan: 0
                    }
                });

                const belediye = ['instagram_belediye', 'twitter_belediye', 'facebook_belediye', 'nextsosyal_belediye']
                    .reduce((sum, key) => sum + aggregated.detay[key], 0);
                
                const baskan = ['instagram_baskan', 'twitter_baskan', 'facebook_baskan', 'nextsosyal_baskan']
                    .reduce((sum, key) => sum + aggregated.detay[key], 0);
                
                return {
                    belediye: utils.formatPercentage(belediye / (total * 4) * 100),
                    baskan: utils.formatPercentage(baskan / (total * 4) * 100),
                    toplam: utils.formatPercentage((belediye + baskan) / (total * 8) * 100),
                    detay: Object.fromEntries(
                        Object.entries(aggregated.detay).map(([k, v]) => 
                            [k, utils.formatPercentage(v / total * 100)]
                        )
                    )
                };
            },

            getEmptySocialMediaData: () => ({
                belediye: '0', baskan: '0', toplam: '0',
                detay: {
                    instagram_belediye: '0', instagram_baskan: '0',
                    twitter_belediye: '0', twitter_baskan: '0',
                    facebook_belediye: '0', facebook_baskan: '0',
                    nextsosyal_belediye: '0', nextsosyal_baskan: '0'
                }
            }),

            showMessage: (message, type = 'success') => {
                const statusDiv = document.getElementById('processStatus');
                if (!statusDiv) return;

                const colors = {
                    success: { bg: '#d4edda', text: '#155724', border: '#c3e6cb' },
                    warning: { bg: '#fff3cd', text: '#856404', border: '#ffeaa7' },
                    error: { bg: '#f8d7da', text: '#721c24', border: '#f5c6cb' }
                };
                
                const color = colors[type] || colors.success;
                statusDiv.innerHTML = `
                    <div style="background: ${color.bg}; border: 1px solid ${color.border}; 
                                color: ${color.text}; padding: 15px; border-radius: 8px; animation: slideDown 0.3s;">
                        ${message}
                    </div>
                `;
                
                setTimeout(() => statusDiv.innerHTML = '', CONFIG.MESSAGE_TIMEOUT);
            },

            parseSocialMediaFromText: (text) => {
                const sm = text.toLowerCase();
                const platforms = [
                    { key: 'instagram_belediye', conditions: ['instagram', 'arnavutkoybelediyesi'] },
                    { key: 'instagram_baskan', conditions: ['instagram', 'mcandaroglutr'] },
                    { key: 'twitter_belediye', conditions: ['twitter', 'x:', 'arnavutkoy'] },
                    { key: 'twitter_baskan', conditions: ['twitter', 'x:', 'mcandaroglutr'] },
                    { key: 'facebook_belediye', conditions: ['facebook', 'arnavutkoybelediyesi'] },
                    { key: 'facebook_baskan', conditions: ['facebook', 'mcandaroglutr'] },
                    { key: 'nextsosyal_belediye', conditions: ['nextsosyal', 'arnavutkoybelediyesi'] },
                    { key: 'nextsosyal_baskan', conditions: ['nextsosyal', 'mustafa'] }
                ];

                return platforms.reduce((acc, { key, conditions }) => {
                    acc[key] = conditions.every(cond => sm.includes(cond)) ? 1 : 0;
                    return acc;
                }, {});
            },

            stemWord: (word) => {
                const suffixes = ['lik', 'lÃ¼k', 'lÄ±k', 'luk', 'ler', 'lar', 'im', 'Ä±m', 'um', 'Ã¼m', 
                                 'ye', 'ya', 'den', 'dan', 'ten', 'tan', 'in', 'Ä±n', 'un', 'Ã¼n'];
                
                for (const suffix of suffixes) {
                    if (word.endsWith(suffix) && word.length > suffix.length + 2) {
                        return word.slice(0, -suffix.length);
                    }
                }
                return word;
            },

            cleanWord: (word) => word.toLowerCase().replace(/[.,!?;:()"""']/g, '').trim(),

            extractKeywords: (text) => {
                if (!text || typeof text !== 'string') return [];
                
                return text.split(/\s+/)
                    .map(w => utils.cleanWord(w))
                    .filter(w => w.length >= 3)
                    .map(w => utils.stemWord(w))
                    .filter(w => !STOPWORDS.has(w));
            },

            analyzeKeywords: (surveys) => {
                const wordFreq = {};
                const groupFreq = {};
                
                surveys.forEach(survey => {
                    utils.extractKeywords(survey.acikUclu || '').forEach(word => {
                        wordFreq[word] = (wordFreq[word] || 0) + 1;
                    });
                });

                Object.entries(KELIME_GRUPLARI).forEach(([groupName, keywords]) => {
                    const groupDetails = {};
                    let groupCount = 0;
                    
                    keywords.forEach(keyword => {
                        const stemmed = utils.stemWord(keyword);
                        if (wordFreq[stemmed]) {
                            groupCount += wordFreq[stemmed];
                            groupDetails[keyword] = wordFreq[stemmed];
                            delete wordFreq[stemmed];
                        }
                    });
                    
                    if (groupCount > 0) {
                        groupFreq[groupName] = { count: groupCount, isGroup: true, details: groupDetails };
                    }
                });

                Object.entries(wordFreq).forEach(([word, count]) => {
                    groupFreq[word] = { count, isGroup: false };
                });

                return Object.entries(groupFreq)
                    .sort(([, a], [, b]) => b.count - a.count)
                    .slice(0, CONFIG.TOP_KEYWORDS)
                    .map(([name, data]) => ({
                        name,
                        count: data.count,
                        isGroup: data.isGroup,
                        details: data.details || {}
                    }));
            },

            analyzeThemeKeywords: (surveys, themeKeywords) => {
                const wordFreq = {};
                
                surveys.forEach(survey => {
                    const text = survey.acikUclu || '';
                    const words = utils.extractKeywords(text);
                    
                    words.forEach(word => {
                        if (themeKeywords.some(kw => utils.stemWord(kw).includes(word) || word.includes(utils.stemWord(kw)))) {
                            wordFreq[word] = (wordFreq[word] || 0) + 1;
                        }
                    });
                });

                return Object.entries(wordFreq)
                    .sort(([, a], [, b]) => b - a)
                    .slice(0, 5)
                    .map(([word, count]) => ({ word, count }));
            },

            calculateThemeSentiment: (surveys, themeKeywords) => {
                let positive = 0;
                let negative = 0;
                let total = 0;

                surveys.forEach(survey => {
                    const text = (survey.acikUclu || '').toLowerCase();
                    const hasThemeWord = themeKeywords.some(kw => text.includes(kw.toLowerCase()));
                    
                    if (hasThemeWord) {
                        total++;
                        const words = text.split(/\s+/);
                        
                        words.forEach(word => {
                            if (SENTIMENT_WORDS.positive.some(pw => word.includes(pw))) positive++;
                            if (SENTIMENT_WORDS.negative.some(nw => word.includes(nw))) negative++;
                        });
                    }
                });

                if (total === 0) return { positive: 0, negative: 0, neutral: 0 };

                const posPercent = positive > 0 ? Math.round((positive / (positive + negative)) * 100) : 0;
                const negPercent = negative > 0 ? Math.round((negative / (positive + negative)) * 100) : 0;
                
                return {
                    positive: posPercent,
                    negative: negPercent,
                    neutral: 100 - posPercent - negPercent,
                    mentionCount: total
                };
            }
        };

        const dataProcessor = {
            validateSurvey: (survey) => {
                const q25 = survey.cevaplar[24];
                const q44 = survey.cevaplar[43];
                const q45 = survey.cevaplar[44];
                
                if (q45 === null || q45 !== 3) return false;
                
                if (q25 === null || q44 === null) return false;
                
                if (Math.abs(q25 - q44) >= CONFIG.CONSISTENCY_THRESHOLD) return false;
                
                return true;
            },

            analyzeMudurluk: (mudurlukData) => {
                const { gecerliAnketler } = mudurlukData;
                
                if (gecerliAnketler.length === 0) {
                    return dataProcessor.getEmptyMudurlukData();
                }

                const workloadQuestions = [7, 8, 9, 10];
                const supportQuestions = [0,1,2,3,4,5,6,11,12,13,14,15,16,17,18,19,20,21,22,23,
                                         25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42];

                const isYuku = utils.calculateAverage(gecerliAnketler, workloadQuestions);
                const kurumDestegi = utils.calculateAverage(gecerliAnketler, supportQuestions);
                
                return {
                    genelMemnuniyet: utils.calculateAverage(gecerliAnketler, [24]),
                    isYuku,
                    kurumDestegi,
                    denge: utils.formatPercentage(parseFloat(kurumDestegi) - parseFloat(isYuku)),
                    temalar: dataProcessor.calculateThemes(gecerliAnketler),
                    ruhSagligi: utils.calculateAverage(gecerliAnketler, [45, 46, 47, 48]),
                    ruhSagligiDetay: {
                        keyifAlamama: utils.calculateAverage(gecerliAnketler, [45]),
                        uzgunCokkun: utils.calculateAverage(gecerliAnketler, [46]),
                        gerginKaygili: utils.calculateAverage(gecerliAnketler, [47]),
                        endiseKontrol: utils.calculateAverage(gecerliAnketler, [48])
                    },
                    sigaraOrani: dataProcessor.calculateSmokingRate(gecerliAnketler),
                    sosyalMedya: utils.calculateSocialMedia(gecerliAnketler),
                    soruOrtalamalar: dataProcessor.calculateQuestionAverages(gecerliAnketler),
                    acikUcluKeywords: utils.analyzeKeywords(gecerliAnketler)
                };
            },

            calculateThemes: (surveys) => 
                Object.fromEntries(
                    Object.entries(THEME_QUESTIONS).map(([key, questions]) => 
                        [key, utils.calculateAverage(surveys, questions)]
                    )
                ),

            calculateSmokingRate: (surveys) => {
                const smokers = surveys.filter(s => 
                    s.sigara && ['evet', 'yes'].includes(s.sigara.toLowerCase())
                ).length;
                return utils.formatPercentage(smokers / surveys.length * 100);
            },

            calculateQuestionAverages: (surveys) => 
                Array.from({ length: CONFIG.QUESTIONS_PER_SURVEY }, (_, i) => 
                    utils.calculateAverage(surveys, [i])
                ),

            getEmptyMudurlukData: () => ({
                genelMemnuniyet: '0',
                isYuku: '0',
                kurumDestegi: '0',
                denge: '0',
                temalar: {},
                ruhSagligi: '0',
                ruhSagligiDetay: {},
                sigaraOrani: '0',
                sosyalMedya: utils.getEmptySocialMediaData(),
                soruOrtalamalar: new Array(CONFIG.QUESTIONS_PER_SURVEY).fill('0'),
                acikUcluKeywords: []
            }),

            analyzeAllData: (rawSurveys) => {
                const mudurlukData = Object.fromEntries(
                    Object.keys(MUDURLUKLER).map(kod => [kod, {
                        kod,
                        ad: MUDURLUKLER[kod].name,
                        toplamPersonel: MUDURLUKLER[kod].personel,
                        anketler: [],
                        gecerliAnketler: [],
                        gecersizAnketler: []
                    }])
                );

                rawSurveys.forEach(survey => {
                    const md = mudurlukData[survey.mudurlukKod];
                    if (!md) return;
                    
                    md.anketler.push(survey);
                    
                    if (dataProcessor.validateSurvey(survey)) {
                        md.gecerliAnketler.push(survey);
                    } else {
                        md.gecersizAnketler.push(survey);
                    }
                });

                Object.values(mudurlukData).forEach(md => {
                    md.katilimOrani = md.toplamPersonel > 0 
                        ? utils.formatPercentage(md.anketler.length / md.toplamPersonel * 100)
                        : '0';
                    
                    Object.assign(md, dataProcessor.analyzeMudurluk(md));
                });

                return mudurlukData;
            }
        };

        const tableRenderer = {
            createSortableHeader: (text, tableId, columnIndex) => `
                <th class="sortable-header" onclick="tableSorter.sort('${tableId}', ${columnIndex})">
                    ${text}<span class="sort-icon"></span>
                </th>
            `,

            createFilterBar: (inputId, tableId) => `
                <div class="filter-bar">
                    <span class="material-icons" style="color: #6b7280;">search</span>
                    <input type="text" id="${inputId}" placeholder="MÃ¼dÃ¼rlÃ¼k adÄ± yazÄ±n..." 
                           onkeyup="tableFilter.filter('${tableId}', '${inputId}', 0)">
                    <button class="btn btn-reset" onclick="tableFilter.reset('${tableId}', '${inputId}')">
                        <span class="material-icons" style="font-size: 16px;">refresh</span> SÄ±fÄ±rla
                    </button>
                </div>
            `,

            renderGenelSkorlar: () => {
                const tbody = document.getElementById('genelSkorlarBody');
                if (!tbody) return;

                tbody.innerHTML = '';
                
                const genelBelediye = tableRenderer.calculateGenelBelediye();
                tbody.innerHTML += tableRenderer.createGenelSkorRow('GENEL BELEDÄ°YE', genelBelediye, true);
                
                Object.values(state.processedData).forEach(md => {
                    tbody.innerHTML += tableRenderer.createGenelSkorRow(
                        `<span class="code-label">#${md.kod}</span> ${md.ad}`,
                        md,
                        false
                    );
                });
            },

            createGenelSkorRow: (name, data, isGenel) => {
                const denge = parseFloat(data.denge) || 0;
                const dengeClass = denge >= 0 ? 'positive' : 'negative';
                const dengeSymbol = denge >= 0 ? '+' : '';
                
                return `
                    <tr class="${isGenel ? 'highlight' : ''}">
                        <td><strong>${name}</strong></td>
                        <td>${data.toplamPersonel || 0}</td>
                        <td>${data.anketler?.length || 0}</td>
                        <td>${data.gecerliAnketler?.length || 0}</td>
                        <td>${data.gecersizAnketler?.length || 0}</td>
                        <td>${data.katilimOrani || 0}%</td>
                        <td><strong>${data.genelMemnuniyet || 0}%</strong></td>
                        <td>${data.isYuku || 0}%</td>
                        <td>${data.kurumDestegi || 0}%</td>
                        <td class="${dengeClass}"><strong>${dengeSymbol}${data.denge || 0}%</strong></td>
                    </tr>
                `;
            },

            calculateGenelBelediye: () => {
                const allValidSurveys = Object.values(state.processedData)
                    .flatMap(md => md.gecerliAnketler);
                
                const totals = Object.values(state.processedData).reduce((acc, md) => ({
                    personel: acc.personel + md.toplamPersonel,
                    anketler: acc.anketler + md.anketler.length,
                    gecerli: acc.gecerli + md.gecerliAnketler.length,
                    gecersiz: acc.gecersiz + md.gecersizAnketler.length
                }), { personel: 0, anketler: 0, gecerli: 0, gecersiz: 0 });

                const workload = utils.calculateAverage(allValidSurveys, [7, 8, 9, 10]);
                const support = utils.calculateAverage(allValidSurveys, 
                    [0,1,2,3,4,5,6,11,12,13,14,15,16,17,18,19,20,21,22,23,
                     25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42]);
                
                return {
                    toplamPersonel: totals.personel,
                    anketler: { length: totals.anketler },
                    gecerliAnketler: { length: totals.gecerli },
                    gecersizAnketler: { length: totals.gecersiz },
                    katilimOrani: totals.personel > 0 
                        ? utils.formatPercentage(totals.anketler / totals.personel * 100)
                        : '0',
                    genelMemnuniyet: utils.calculateAverage(allValidSurveys, [24]),
                    isYuku: workload,
                    kurumDestegi: support,
                    denge: utils.formatPercentage(parseFloat(support) - parseFloat(workload))
                };
            },

            renderAllTables: () => {
                tableRenderer.renderGirilenAnketler();
                
                if (!state.processedData || Object.keys(state.processedData).length === 0) {
                    return;
                }
                
                surveyManager.renderGenelBakisCards();
                surveyManager.renderEnMemnunMudurlukler();
                tableRenderer.renderGenelSkorlar();
                tableRenderer.renderSosyalMedya();
                tableRenderer.renderRuhSagligi();
                tableRenderer.renderThemeCards();
                tableRenderer.renderTemalar();
                tableRenderer.renderSorular();
                tableRenderer.renderAcikUclu();
                tableRenderer.populateMudurlukSelect();
            },

            renderGirilenAnketler: () => {
                const tbody = document.getElementById('girilenAnketlerBody');
                if (!tbody) return;

                tbody.innerHTML = '';
                
                if (state.allSurveys.length === 0 || !state.processedData) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding:30px;">HenÃ¼z anket giriÅŸi yapÄ±lmamÄ±ÅŸ...</td></tr>';
                    ['toplamAnketSayisi', 'gecerliAnketSayisi', 'gecersizAnketSayisi'].forEach(id => {
                        const el = document.getElementById(id);
                        if (el) el.textContent = '0';
                    });
                    return;
                }
                
                const mudurlukAnketleri = Object.fromEntries(
                    Object.keys(MUDURLUKLER).map(kod => [kod, { gecerli: [], gecersiz: [] }])
                );
                
                let toplamGecerli = 0;
                let toplamGecersiz = 0;
                
                state.allSurveys.forEach(anket => {
                    const md = state.processedData[anket.mudurlukKod];
                    if (!md) return;
                    
                    const isGecerli = md.gecerliAnketler.find(a => a.kod === anket.kod);
                    if (isGecerli) {
                        mudurlukAnketleri[anket.mudurlukKod].gecerli.push(anket.kod);
                        toplamGecerli++;
                    } else {
                        mudurlukAnketleri[anket.mudurlukKod].gecersiz.push(anket.kod);
                        toplamGecersiz++;
                    }
                });
                
                Object.entries(MUDURLUKLER).forEach(([kod, md]) => {
                    const anketler = mudurlukAnketleri[kod];
                    const toplamAnket = anketler.gecerli.length + anketler.gecersiz.length;
                    
                    if (toplamAnket === 0) return;
                    
                    const createTags = (kodlar, gecersiz = false) => 
                        kodlar.map(anketKod => 
                            `<span class="anket-tag ${gecersiz ? 'gecersiz' : ''}" ${gecersiz ? 'title="GeÃ§ersiz"' : ''}>
                                ${anketKod}<span class="remove-btn" data-kod="${anketKod}">Ã—</span>
                            </span>`
                        ).join('');
                    
                    tbody.innerHTML += `
                        <tr>
                            <td><span class="code-label">#${kod}</span> <strong>${md.name}</strong></td>
                            <td><strong>${toplamAnket}</strong></td>
                            <td>${anketler.gecerli.length}</td>
                            <td>${anketler.gecersiz.length}</td>
                            <td>${createTags(anketler.gecerli)}${createTags(anketler.gecersiz, true)}</td>
                            <td>
                                <button class="btn btn-small btn-danger btn-remove-mudurluk" data-mudurluk="${kod}">
                                    <span class="material-icons" style="font-size: 16px;">delete</span> TÃ¼mÃ¼nÃ¼ Sil
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                document.getElementById('toplamAnketSayisi').textContent = state.allSurveys.length;
                document.getElementById('gecerliAnketSayisi').textContent = toplamGecerli;
                document.getElementById('gecersizAnketSayisi').textContent = toplamGecersiz;
            },

            renderSosyalMedya: () => {
                sosyalMedyaManager.renderDashboard();
                
                const tbody = document.getElementById('sosyalMedyaBody');
                if (!tbody) return;

                tbody.innerHTML = '';
                
                const genelBelediye = tableRenderer.calculateGenelBelediyeAggregate('sosyalMedya');
                tbody.innerHTML += tableRenderer.createSosyalMedyaRow('GENEL BELEDÄ°YE', genelBelediye, true);
                
                Object.values(state.processedData).forEach(md => {
                    if (md.sosyalMedya) {
                        tbody.innerHTML += tableRenderer.createSosyalMedyaRow(
                            `<span class="code-label">#${md.kod}</span> ${md.ad}`,
                            md.sosyalMedya,
                            false
                        );
                    }
                });
            },

            createSosyalMedyaRow: (name, sm, isGenel) => `
                <tr class="${isGenel ? 'highlight' : ''}">
                    <td><strong>${name}</strong></td>
                    <td>${sm.detay?.instagram_belediye || 0}%</td>
                    <td>${sm.detay?.instagram_baskan || 0}%</td>
                    <td>${sm.detay?.twitter_belediye || 0}%</td>
                    <td>${sm.detay?.twitter_baskan || 0}%</td>
                    <td>${sm.detay?.facebook_belediye || 0}%</td>
                    <td>${sm.detay?.facebook_baskan || 0}%</td>
                    <td>${sm.detay?.nextsosyal_belediye || 0}%</td>
                    <td>${sm.detay?.nextsosyal_baskan || 0}%</td>
                </tr>
            `,

            renderRuhSagligi: () => {
                const tbody = document.getElementById('ruhSagligiBody');
                if (!tbody) return;

                tbody.innerHTML = '';
                
                const genelBelediye = tableRenderer.calculateGenelBelediyeRuhSagligi();
                tbody.innerHTML += tableRenderer.createRuhSagligiRow('GENEL BELEDÄ°YE', genelBelediye, true);
                
                Object.values(state.processedData).forEach(md => {
                    tbody.innerHTML += tableRenderer.createRuhSagligiRow(
                        `<span class="code-label">#${md.kod}</span> ${md.ad}`,
                        {
                            ruhSagligi: md.ruhSagligi,
                            sigaraOrani: md.sigaraOrani,
                            ruhSagligiDetay: md.ruhSagligiDetay
                        },
                        false
                    );
                });
            },

            createRuhSagligiRow: (name, data, isGenel) => `
                <tr class="${isGenel ? 'highlight' : ''}">
                    <td><strong>${name}</strong></td>
                    <td>${data.ruhSagligi || 0}%</td>
                    <td>${data.sigaraOrani || 0}%</td>
                    <td>${data.ruhSagligiDetay?.keyifAlamama || 0}%</td>
                    <td>${data.ruhSagligiDetay?.uzgunCokkun || 0}%</td>
                    <td>${data.ruhSagligiDetay?.gerginKaygili || 0}%</td>
                    <td>${data.ruhSagligiDetay?.endiseKontrol || 0}%</td>
                </tr>
            `,

            calculateGenelBelediyeRuhSagligi: () => {
                const allValidSurveys = Object.values(state.processedData)
                    .flatMap(md => md.gecerliAnketler);
                
                const smokers = allValidSurveys.filter(s => 
                    s.sigara && ['evet', 'yes'].includes(s.sigara.toLowerCase())
                ).length;
                
                return {
                    ruhSagligi: utils.calculateAverage(allValidSurveys, [45, 46, 47, 48]),
                    sigaraOrani: allValidSurveys.length > 0 
                        ? utils.formatPercentage(smokers / allValidSurveys.length * 100)
                        : '0',
                    ruhSagligiDetay: {
                        keyifAlamama: utils.calculateAverage(allValidSurveys, [45]),
                        uzgunCokkun: utils.calculateAverage(allValidSurveys, [46]),
                        gerginKaygili: utils.calculateAverage(allValidSurveys, [47]),
                        endiseKontrol: utils.calculateAverage(allValidSurveys, [48])
                    }
                };
            },

            renderTemalar: () => {
                const tbody = document.getElementById('temalarBody');
                if (!tbody) return;

                tbody.innerHTML = '';
                
                const genelBelediye = tableRenderer.calculateGenelBelediyeTemalar();
                tbody.innerHTML += tableRenderer.createTemalarRow('GENEL BELEDÄ°YE', genelBelediye, true);
                
                Object.values(state.processedData).forEach(md => {
                    tbody.innerHTML += tableRenderer.createTemalarRow(
                        `<span class="code-label">#${md.kod}</span> ${md.ad}`,
                        md.temalar,
                        false
                    );
                });
            },

            createTemalarRow: (name, temalar, isGenel) => `
                <tr class="${isGenel ? 'highlight' : ''}">
                    <td><strong>${name}</strong></td>
                    <td>${temalar.isKisiUyumu || 0}%</td>
                    <td>${temalar.gorevRolNetligi || 0}%</td>
                    <td>${temalar.hizmetTalepYogunlugu || 0}%</td>
                    <td>${temalar.yoneticilerleIliskiler || 0}%</td>
                    <td>${temalar.calismaArkadaslari || 0}%</td>
                    <td>${temalar.kurumIciIletisim || 0}%</td>
                    <td>${temalar.calismaKosullari || 0}%</td>
                    <td>${temalar.kamuHizmetiMotivasyonu || 0}%</td>
                    <td>${temalar.yetkinlikPerformans || 0}%</td>
                    <td>${temalar.egitimGelisim || 0}%</td>
                </tr>
            `,

            calculateGenelBelediyeTemalar: () => {
                const allValidSurveys = Object.values(state.processedData)
                    .flatMap(md => md.gecerliAnketler);
                
                return Object.fromEntries(
                    Object.entries(THEME_QUESTIONS).map(([key, questions]) => 
                        [key, utils.calculateAverage(allValidSurveys, questions)]
                    )
                );
            },

            renderSorular: () => {
                const thead = document.getElementById('sorularTableHead');
                const tbody = document.getElementById('sorularBody');
                const soruSelect = document.getElementById('soruSelect');
                const mudurlukSelect = document.getElementById('mudurlukSoruSelect');
                
                if (!thead || !tbody) return;
                
                if (!state.processedData || Object.keys(state.processedData).length === 0) {
                    thead.innerHTML = '<tr><th style="min-width:400px;">Soru</th></tr>';
                    tbody.innerHTML = '<tr><td style="text-align:center; padding:30px;">LÃ¼tfen veri giriÅŸi yapÄ±nÄ±z...</td></tr>';
                    if (soruSelect) {
                        soruSelect.innerHTML = '<option value="">-- TÃ¼m Sorular --</option>';
                    }
                    if (mudurlukSelect) {
                        mudurlukSelect.innerHTML = '<option value="">-- TÃ¼m MÃ¼dÃ¼rlÃ¼kler --</option>';
                    }
                    return;
                }
                
                // Soru dropdown'Ä±nÄ± doldur
                if (soruSelect && soruSelect.options.length === 1) {
                    SORULAR.forEach((soru, i) => {
                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = `S${i+1}. ${soru.substring(0, 60)}${soru.length > 60 ? '...' : ''}`;
                        soruSelect.appendChild(option);
                    });
                }
                
                // MÃ¼dÃ¼rlÃ¼k dropdown'Ä±nÄ± doldur
                if (mudurlukSelect && mudurlukSelect.options.length === 1) {
                    Object.values(state.processedData).forEach(md => {
                        const option = document.createElement('option');
                        option.value = md.kod;
                        option.textContent = `#${md.kod} - ${md.ad}`;
                        mudurlukSelect.appendChild(option);
                    });
                }
                
                let headerHTML = '<tr>';
                
                // Soru sÃ¼tunu
                headerHTML += '<th style="min-width:400px;" data-col="0">Soru</th>';
                
                // Genel Belediye sÃ¼tunu
                headerHTML += `
                    <th class="sortable-header" data-mudurluk="genel" data-col="1" style="min-width:180px;" onclick="tableSorter.sort('sorularTable', 1)">
                        <strong>GENEL<br>BELEDÄ°YE</strong><span class="sort-icon"></span>
                    </th>
                `;
                
                // MÃ¼dÃ¼rlÃ¼k sÃ¼tunlarÄ±
                Object.values(state.processedData).forEach((md, index) => {
                    const mdName = md.ad.length > 25 ? md.ad.substring(0, 22) + '...' : md.ad;
                    const colIndex = index + 2;
                    headerHTML += `
                        <th class="sortable-header" data-mudurluk="md_${md.kod}" data-col="${colIndex}" style="min-width:180px;" onclick="tableSorter.sort('sorularTable', ${colIndex})">
                            <span class="code-label" style="display:block; margin-bottom:4px;">#${md.kod}</span>${mdName}<span class="sort-icon"></span>
                        </th>
                    `;
                });
                
                headerHTML += '</tr>';
                thead.innerHTML = headerHTML;
                
                const genelBelediyeSorular = tableRenderer.calculateGenelBelediyeSorular();
                
                tbody.innerHTML = SORULAR.map((soru, i) => {
                    let rowHTML = `<tr data-soru-index="${i}"><td data-col="0"><strong>S${i+1}.</strong> ${soru}</td>`;
                    rowHTML += `<td class="highlight" data-mudurluk="genel" data-col="1"><strong>${genelBelediyeSorular[i]}%</strong></td>`;
                    
                    Object.values(state.processedData).forEach((md, index) => {
                        rowHTML += `<td data-mudurluk="md_${md.kod}" data-col="${index + 2}">${md.soruOrtalamalar[i]}%</td>`;
                    });
                    
                    return rowHTML + '</tr>';
                }).join('');
            },

            calculateGenelBelediyeSorular: () => {
                const allValidSurveys = Object.values(state.processedData)
                    .flatMap(md => md.gecerliAnketler);
                
                return Array.from({ length: CONFIG.QUESTIONS_PER_SURVEY }, (_, i) => 
                    utils.calculateAverage(allValidSurveys, [i])
                );
            },

            calculateGenelBelediyeAggregate: (property) => {
                const allValidSurveys = Object.values(state.processedData)
                    .flatMap(md => md.gecerliAnketler);
                
                return property === 'sosyalMedya' 
                    ? utils.calculateSocialMedia(allValidSurveys)
                    : null;
            },

            renderAcikUclu: () => {
                const tbody = document.getElementById('acikUcluBody');
                if (!tbody) return;

                if (!state.processedData || Object.keys(state.processedData).length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:30px;">LÃ¼tfen veri giriÅŸi yapÄ±nÄ±z...</td></tr>';
                    return;
                }

                tbody.innerHTML = '';

                const allSurveys = Object.values(state.processedData).flatMap(md => [...md.gecerliAnketler, ...md.gecersizAnketler]);
                const genelKeywords = utils.analyzeKeywords(allSurveys);
                const genelCount = allSurveys.filter(s => s.acikUclu && s.acikUclu.trim()).length;
                
                tbody.innerHTML += tableRenderer.createAcikUcluRow('GENEL BELEDÄ°YE', genelKeywords, genelCount, 'genel', true);

                Object.values(state.processedData).forEach(md => {
                    const allMdSurveys = [...md.gecerliAnketler, ...md.gecersizAnketler];
                    const count = allMdSurveys.filter(s => s.acikUclu && s.acikUclu.trim()).length;
                    const keywords = utils.analyzeKeywords(allMdSurveys);
                    tbody.innerHTML += tableRenderer.createAcikUcluRow(
                        `<span class="code-label">#${md.kod}</span> ${md.ad}`,
                        keywords,
                        count,
                        md.kod,
                        false
                    );
                });
            },

            createAcikUcluRow: (name, keywords, count, mudurlukKod, isGenel) => {
                const keywordsHTML = keywords.map(kw => {
                    const tooltipContent = kw.isGroup
                        ? `<strong>${kw.name} (GRUP)</strong><br>${Object.entries(kw.details).map(([word, cnt]) => `â€¢ ${word}: ${cnt}`).join('<br>')}`
                        : `<strong>${kw.name}</strong><br>Tekil kelime`;
                    
                    return `
                        <span class="keyword-item">
                            ${kw.name}(${kw.count})
                            <div class="keyword-tooltip">${tooltipContent}</div>
                        </span>
                    `;
                }).join(', ');

                const countHTML = count > 0 
                    ? `<span class="clickable-count" onclick="openEndedManager.showResponses('${mudurlukKod}')">${count} cevap (TÄ±klayÄ±n ðŸ‘ï¸)</span>`
                    : `<span style="color: #999; font-style: italic;">Cevap yok</span>`;

                return `
                    <tr class="${isGenel ? 'highlight' : ''}">
                        <td><strong>${name}</strong></td>
                        <td style="max-width: 500px;">${keywordsHTML || '<em style="color:#999;">Cevap yok</em>'}</td>
                        <td>${countHTML}</td>
                    </tr>
                `;
            },

            populateMudurlukSelect: () => {
                const select = document.getElementById('mudurlukSelect');
                if (!select) return;

                select.innerHTML = '<option value="">-- MÃ¼dÃ¼rlÃ¼k SeÃ§iniz --</option>';
                
                if (!state.processedData || Object.keys(state.processedData).length === 0) {
                    return;
                }
                
                Object.values(state.processedData).forEach(md => {
                    const option = document.createElement('option');
                    option.value = md.kod;
                    option.textContent = `#${md.kod} - ${md.ad}`;
                    select.appendChild(option);
                });
            },

            renderThemeCards: () => {
                const container = document.getElementById('themeCardsContainer');
                if (!container || !state.processedData) return;

                const allValidSurveys = Object.values(state.processedData).flatMap(md => md.gecerliAnketler);
                const genelTemalar = tableRenderer.calculateGenelBelediyeTemalar();

                const cardsHTML = Object.entries(THEME_INFO).map(([themeKey, info]) => {
                    const score = parseFloat(genelTemalar[themeKey]) || 0;
                    const sentiment = utils.calculateThemeSentiment(allValidSurveys, info.keywords);
                    const keywords = utils.analyzeThemeKeywords(allValidSurveys, info.keywords);
                    
                    let statusColor = '#10b981';
                    let statusText = 'Ã‡ok Ä°yi';
                    let statusIcon = 'ðŸ˜Š';
                    
                    if (score < 50) {
                        statusColor = '#ef4444';
                        statusText = 'DÃ¼ÅŸÃ¼k';
                        statusIcon = 'ðŸ˜ž';
                    } else if (score < 70) {
                        statusColor = '#f59e0b';
                        statusText = 'Orta';
                        statusIcon = 'ðŸ˜';
                    }

                    const exampleResponses = allValidSurveys
                        .filter(s => {
                            const text = (s.acikUclu || '').toLowerCase();
                            return info.keywords.some(kw => text.includes(kw.toLowerCase()));
                        });

                    const displayResponses = exampleResponses.slice(0, 5);
                    const hasMore = exampleResponses.length > 5;

                    const questionCount = THEME_QUESTIONS[themeKey].length;
                    
                    return `
                        <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #e5e7eb;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                <span style="font-size: 32px;">${info.icon}</span>
                                <div style="flex: 1;">
                                    <h3 style="font-size: 16px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px;">${info.title}</h3>
                                </div>
                            </div>
                            
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 16px; border-radius: 10px; margin-bottom: 16px;">
                                <div style="font-size: 11px; color: rgba(255,255,255,0.9); font-weight: 600; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">
                                    ðŸ“Š Anketin Test SorularÄ±ndan Gelen Ortalama Â· ${questionCount} Sorudan Ã–lÃ§Ã¼lmÃ¼ÅŸtÃ¼r
                                </div>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <span style="font-size: 32px; font-weight: 700; color: white;">${score.toFixed(1)}%</span>
                                    <div>
                                        <div style="display: flex; align-items: center; gap: 6px;">
                                            <span style="font-size: 24px;">${statusIcon}</span>
                                            <span style="font-size: 14px; color: white; font-weight: 600;">${statusText}</span>
                                        </div>
                                        <div style="font-size: 11px; color: rgba(255,255,255,0.8); line-height: 1.4; margin-top: 4px;">
                                            ${info.description}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            ${sentiment.mentionCount > 0 ? `
                            <div style="background: #f9fafb; padding: 16px; border-radius: 10px; border: 1px solid #e5e7eb;">
                                <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;">
                                    ðŸ’¬ Anketin AÃ§Ä±k UÃ§lu KÄ±smÄ±ndan AlÄ±nan YanÄ±tlar
                                </div>
                                <div style="font-size: 12px; color: #374151; margin-bottom: 8px;">
                                    <strong>${sentiment.mentionCount} kiÅŸi</strong> bu tema hakkÄ±nda yorum yaptÄ±
                                </div>
                                <div style="display: flex; gap: 8px; font-size: 12px; margin-bottom: 12px;">
                                    ${sentiment.positive > 0 ? `<span style="color: #10b981; font-weight: 600;">ðŸ˜Š %${sentiment.positive} Pozitif</span>` : ''}
                                    ${sentiment.negative > 0 ? `<span style="color: #ef4444; font-weight: 600;">ðŸ˜ž %${sentiment.negative} Negatif</span>` : ''}
                                </div>
                                
                                ${keywords.length > 0 ? `
                                <div style="margin-bottom: 12px; padding-top: 12px; border-top: 1px solid #e5e7eb;">
                                    <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 6px;">ðŸ”‘ SÄ±k GeÃ§en Kelimeler:</div>
                                    <div style="font-size: 12px; color: #374151;">
                                        ${keywords.map(k => `<span style="background: #e0e7ff; padding: 4px 8px; border-radius: 4px; margin-right: 6px; display: inline-block; margin-bottom: 4px;">${k.word} (${k.count})</span>`).join('')}
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${displayResponses.length > 0 ? `
                                <div style="padding-top: 12px; border-top: 1px solid #e5e7eb;">
                                    <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 8px;">ðŸ“ Ã–rnek Yorumlar:</div>
                                    <div id="responses-${themeKey}">
                                        ${displayResponses.map(s => `
                                            <div style="font-size: 12px; color: #374151; padding: 8px; background: white; border-radius: 6px; margin-bottom: 6px; border-left: 3px solid ${statusColor};">
                                                "${s.acikUclu.substring(0, 100)}${s.acikUclu.length > 100 ? '...' : ''}"
                                            </div>
                                        `).join('')}
                                    </div>
                                    ${hasMore ? `
                                    <button class="btn btn-small" onclick="themeManager.showAllResponses('${themeKey}', ${JSON.stringify(exampleResponses.map(s => s.acikUclu)).replace(/"/g, '&quot;')})" style="margin-top: 8px; margin-left: 0;">
                                        <span class="material-icons" style="font-size: 14px;">visibility</span> 
                                        TÃ¼mÃ¼nÃ¼ GÃ¶r (${exampleResponses.length} yorum)
                                    </button>
                                    ` : ''}
                                </div>
                                ` : ''}
                            </div>
                            </div>
                            ` : `
                            <div style="background: #f9fafb; padding: 16px; border-radius: 10px; border: 1px solid #e5e7eb;">
                                <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;">
                                    ðŸ’¬ Anketin AÃ§Ä±k UÃ§lu KÄ±smÄ±ndan AlÄ±nan YanÄ±tlar
                                </div>
                                <div style="text-align: center; padding: 20px; color: #9ca3af; font-size: 13px;">
                                    <span style="font-size: 32px; display: block; margin-bottom: 8px;">ðŸ’­</span>
                                    Bu tema ile ilgili aÃ§Ä±k uÃ§lu yorum bulunamadÄ±
                                </div>
                            </div>
                            `}
                        </div>
                    `;
                }).join('');

                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin: 20px 0;">
                        ${cardsHTML}
                    </div>
                `;
            }
        };

        const openEndedManager = {
            showResponses: (mudurlukKod) => {
                const container = document.getElementById('responsesContainer');
                if (!container) return;

                let surveys, title;

                if (mudurlukKod === 'genel') {
                    surveys = Object.values(state.processedData).flatMap(md => [...md.gecerliAnketler, ...md.gecersizAnketler]);
                    title = 'GENEL BELEDÄ°YE';
                } else {
                    const md = state.processedData[mudurlukKod];
                    if (!md) return;
                    surveys = [...md.gecerliAnketler, ...md.gecersizAnketler];
                    title = `#${md.kod} - ${md.ad}`;
                }

                const responsesWithText = surveys.filter(s => s.acikUclu && s.acikUclu.trim());
                state.currentOpenResponses = responsesWithText;

                const responsesHTML = responsesWithText.length > 0
                    ? responsesWithText.map(survey => `
                        <div class="response-balloon">
                            <div class="response-header">ðŸ’¬ ${survey.kod}</div>
                            <div class="response-text">${survey.acikUclu}</div>
                        </div>
                    `).join('')
                    : '<div class="response-balloon"><div class="response-text response-empty">Bu mÃ¼dÃ¼rlÃ¼kten aÃ§Ä±k uÃ§lu cevap bulunmuyor.</div></div>';

                container.innerHTML = `
                    <div class="responses-header">
                        <div class="responses-title">ðŸ“‹ ${title} - AÃ§Ä±k UÃ§lu Cevaplar (${responsesWithText.length} adet)</div>
                        <div class="responses-actions">
                            <button class="btn btn-small" onclick="openEndedManager.exportResponses()">
                                <span class="material-icons" style="font-size: 16px;">download</span> Excel'e Aktar
                            </button>
                            <button class="btn btn-small" onclick="openEndedManager.copyResponses()">
                                <span class="material-icons" style="font-size: 16px;">content_copy</span> Kopyala
                            </button>
                            <button class="btn btn-small btn-danger" onclick="openEndedManager.closeResponses()">
                                <span class="material-icons" style="font-size: 16px;">close</span> Kapat
                            </button>
                        </div>
                    </div>
                    ${responsesHTML}
                `;

                container.classList.add('active');
                container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            },

            closeResponses: () => {
                const container = document.getElementById('responsesContainer');
                if (container) {
                    container.classList.remove('active');
                    state.currentOpenResponses = null;
                }
            },

            copyResponses: () => {
                if (!state.currentOpenResponses) return;

                const text = state.currentOpenResponses
                    .map(s => `${s.kod}:\n${s.acikUclu}`)
                    .join('\n\n---\n\n');

                navigator.clipboard.writeText(text).then(() => {
                    utils.showMessage('âœ… Cevaplar panoya kopyalandÄ±!', 'success');
                }).catch(() => {
                    utils.showMessage('âŒ Kopyalama baÅŸarÄ±sÄ±z oldu.', 'error');
                });
            },

            exportResponses: () => {
                if (!state.currentOpenResponses) return;

                const csv = 'Anket Kodu,MÃ¼dÃ¼rlÃ¼k,AÃ§Ä±k UÃ§lu Cevap\n' + 
                    state.currentOpenResponses.map(s => {
                        const escaped = s.acikUclu.replace(/"/g, '""');
                        return `"${s.kod}","${s.mudurlukAd}","${escaped}"`;
                    }).join('\n');

                const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'acik_uclu_cevaplar.csv';
                link.click();

                utils.showMessage('âœ… Excel dosyasÄ± indirildi!', 'success');
            }
        };

        const tableSorter = {
            sort: (tableId, columnIndex) => {
                const table = document.getElementById(tableId);
                const tbody = table.querySelector('tbody');
                const rows = Array.from(tbody.querySelectorAll('tr'));
                
                if (rows.length <= 1) return;
                
                const [headerRow, ...dataRows] = rows;
                const headers = table.querySelectorAll('.sortable-header');
                const clickedHeader = headers[columnIndex];
                
                const direction = tableSorter.getNextSortDirection(clickedHeader);
                
                headers.forEach(h => h.classList.remove('sorted-asc', 'sorted-desc'));
                
                if (direction === 'reset') {
                    tableSorter.resetTableToOriginal(tableId);
                    return;
                }
                
                clickedHeader.classList.add(direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
                
                const isNumeric = columnIndex !== 0;
                
                dataRows.sort((a, b) => {
                    let aVal = a.cells[columnIndex].textContent.trim();
                    let bVal = b.cells[columnIndex].textContent.trim();
                    
                    if (isNumeric) {
                        aVal = parseFloat(aVal.replace(/[^0-9.-]/g, '')) || 0;
                        bVal = parseFloat(bVal.replace(/[^0-9.-]/g, '')) || 0;
                        return direction === 'asc' ? (aVal - bVal) : (bVal - aVal);
                    }
                    
                    return direction === 'asc' 
                        ? aVal.localeCompare(bVal, 'tr')
                        : bVal.localeCompare(aVal, 'tr');
                });
                
                tbody.innerHTML = '';
                tbody.appendChild(headerRow);
                dataRows.forEach(row => tbody.appendChild(row));
            },

            getNextSortDirection: (header) => {
                if (header.classList.contains('sorted-asc')) return 'desc';
                if (header.classList.contains('sorted-desc')) return 'reset';
                return 'asc';
            },

            resetTableToOriginal: (tableId) => {
                const renderMap = {
                    'genelSkorlarTable': tableRenderer.renderGenelSkorlar,
                    'sosyalMedyaTable': tableRenderer.renderSosyalMedya,
                    'ruhSagligiTable': tableRenderer.renderRuhSagligi,
                    'temalarTable': tableRenderer.renderTemalar,
                    'sorularTable': tableRenderer.renderSorular
                };
                
                const renderFn = renderMap[tableId];
                if (renderFn) renderFn();
            }
        };

        const tableFilter = {
            filter: (tableId, inputId, columnIndex) => {
                const input = document.getElementById(inputId);
                const filterText = input.value.toUpperCase().trim();
                const table = document.getElementById(tableId);
                const tbody = table.querySelector('tbody');
                const rows = tbody.querySelectorAll('tr');
                
                rows.forEach((row, index) => {
                    if (index === 0 && tableId !== 'sorularTable') {
                        row.style.display = '';
                        return;
                    }
                    
                    const cell = row.cells[columnIndex];
                    if (cell) {
                        const txtValue = cell.textContent || cell.innerText;
                        row.style.display = txtValue.toUpperCase().includes(filterText) ? '' : 'none';
                    }
                });
            },

            reset: (tableId, filterId) => {
                const table = document.getElementById(tableId);
                const headers = table.querySelectorAll('.sortable-header');
                headers.forEach(h => h.classList.remove('sorted-asc', 'sorted-desc'));
                
                const filterInput = document.getElementById(filterId);
                if (filterInput) filterInput.value = '';
                
                const tbody = table.querySelector('tbody');
                const rows = tbody.querySelectorAll('tr');
                rows.forEach(row => {
                    row.style.display = '';
                });
                
                tableSorter.resetTableToOriginal(tableId);
                utils.showMessage('ðŸ”„ Tablo ve filtre sÄ±fÄ±rlandÄ±.', 'success');
            }
        };

        const dataInput = {
            addTableRows: (count) => {
                const tbody = document.getElementById('dataTableBody');
                if (!tbody) return;

                const fragment = document.createDocumentFragment();
                for (let i = 0; i < count; i++) {
                    const row = document.createElement('tr');
                    for (let j = 0; j < 61; j++) {
                        const cell = document.createElement('td');
                        cell.contentEditable = 'true';
                        cell.className = 'editable-cell';
                        row.appendChild(cell);
                    }
                    fragment.appendChild(row);
                }
                tbody.appendChild(fragment);
            },

            clearTableData: () => {
                if (!confirm('Tablodaki tÃ¼m verileri temizlemek istediÄŸinizden emin misiniz?')) return;
                
                const tbody = document.getElementById('dataTableBody');
                if (!tbody) return;

                tbody.querySelectorAll('td').forEach(cell => {
                    cell.textContent = '';
                    cell.classList.remove('filled');
                });
                utils.showMessage('âœ… Tablo temizlendi.', 'success');
            },

            setupPasteHandler: () => {
                const table = document.getElementById('dataTable');
                if (!table) return;

                table.addEventListener('paste', (e) => {
                    e.preventDefault();
                    
                    const pastedData = (e.clipboardData || window.clipboardData).getData('text');
                    if (!pastedData) return;
                    
                    const targetCell = e.target;
                    if (targetCell.tagName !== 'TD') return;
                    
                    const targetRow = targetCell.parentElement;
                    const targetRowIndex = Array.from(targetRow.parentElement.children).indexOf(targetRow);
                    const targetCellIndex = Array.from(targetRow.children).indexOf(targetCell);
                    
                    const rows = pastedData.split('\n').filter(r => r.trim());
                    const tbody = document.getElementById('dataTableBody');
                    
                    const neededRows = targetRowIndex + rows.length;
                    const currentRows = tbody.children.length;
                    if (neededRows > currentRows) {
                        dataInput.addTableRows(neededRows - currentRows);
                    }
                    
                    rows.forEach((rowData, i) => {
                        const cells = rowData.split('\t');
                        const tableRow = tbody.children[targetRowIndex + i];
                        
                        cells.forEach((cellData, j) => {
                            const cellIndex = targetCellIndex + j;
                            if (cellIndex < tableRow.children.length) {
                                const cell = tableRow.children[cellIndex];
                                cell.textContent = cellData.trim();
                                if (cellData.trim()) {
                                    cell.classList.add('filled');
                                }
                            }
                        });
                    });
                    
                    utils.showMessage('ðŸ“‹ Veriler tabloya yapÄ±ÅŸtÄ±rÄ±ldÄ±. "Tablodan Verileri Ä°ÅŸle" butonuna tÄ±klayÄ±n.', 'success');
                });
            },

            processTableData: () => {
                const tbody = document.getElementById('dataTableBody');
                if (!tbody) return;

                const rows = Array.from(tbody.children);
                
                let yeniAnketSayisi = 0;
                let gecersizFormat = 0;
                const hataMesajlari = [];
                
                rows.forEach((row, rowIndex) => {
                    const values = Array.from(row.children).map(cell => cell.textContent.trim());
                    
                    if (values.every(v => !v)) return;
                    
                    const kod = values[0];
                    
                    if (!kod || !kod.includes('_')) {
                        if (kod) {
                            hataMesajlari.push(`SatÄ±r ${rowIndex + 1}: GeÃ§ersiz kod "${kod}"`);
                            gecersizFormat++;
                        }
                        return;
                    }
                    
                    if (state.allSurveys.find(s => s.kod === kod)) return;
                    
                    const mudurlukKod = parseInt(kod.split('_')[0]);
                    if (!MUDURLUKLER[mudurlukKod]) {
                        hataMesajlari.push(`SatÄ±r ${rowIndex + 1}: Bilinmeyen mÃ¼dÃ¼rlÃ¼k "${mudurlukKod}"`);
                        gecersizFormat++;
                        return;
                    }
                    
                    state.allSurveys.push(dataInput.parseSurveyRow(values, kod, mudurlukKod));
                    yeniAnketSayisi++;
                });
                
                if (yeniAnketSayisi === 0 && gecersizFormat === 0) {
                    utils.showMessage('âš ï¸ Tabloda iÅŸlenebilecek yeni anket bulunamadÄ±!', 'warning');
                    return;
                }
                
                if (yeniAnketSayisi === 0 && gecersizFormat > 0) {
                    const hataDetay = hataMesajlari.slice(0, 3).join('<br>') + 
                        (hataMesajlari.length > 3 ? `<br>... ve ${hataMesajlari.length - 3} hata daha.` : '');
                    utils.showMessage(`âŒ HiÃ§bir anket iÅŸlenemedi. ${gecersizFormat} satÄ±rda hata:<br><br>${hataDetay}`, 'error');
                    return;
                }
                
                state.processedData = dataProcessor.analyzeAllData(state.allSurveys);
                tableRenderer.renderAllTables();
                
                databaseAPI.saveData();
                
                let message = `âœ… ${yeniAnketSayisi} yeni anket baÅŸarÄ±yla iÅŸlendi!`;
                if (gecersizFormat > 0) message += `<br>âš ï¸ ${gecersizFormat} satÄ±r atlandÄ±.`;
                message += `<br>ðŸ“Š Toplam sistemdeki anket: ${state.allSurveys.length}`;
                message += `<br>ðŸ’¾ Veriler otomatik olarak kaydedildi.`;
                utils.showMessage(message, 'success');
                
                dataInput.clearTableData();
            },

            parseSurveyRow: (values, kod, mudurlukKod) => {
                const surveyData = {
                    kod,
                    mudurlukKod,
                    mudurlukAd: MUDURLUKLER[mudurlukKod].name,
                    cevaplar: Array.from({ length: CONFIG.QUESTIONS_PER_SURVEY }, (_, i) => {
                        const val = values[i + 1];
                        return val === '' || val === 'null' ? null : parseInt(val);
                    }),
                    sigara: values[50] || '',
                    acikUclu: values[60] || ''
                };
                
                const sosyalMedya1to0 = values.slice(52, 60);
                const has1or0Values = sosyalMedya1to0.some(v => v === '1' || v === '0');
                
                if (has1or0Values) {
                    surveyData.sosyalMedya = {
                        instagram_belediye: sosyalMedya1to0[0] === '1' ? 1 : 0,
                        instagram_baskan: sosyalMedya1to0[1] === '1' ? 1 : 0,
                        twitter_belediye: sosyalMedya1to0[2] === '1' ? 1 : 0,
                        twitter_baskan: sosyalMedya1to0[3] === '1' ? 1 : 0,
                        facebook_belediye: sosyalMedya1to0[4] === '1' ? 1 : 0,
                        facebook_baskan: sosyalMedya1to0[5] === '1' ? 1 : 0,
                        nextsosyal_belediye: sosyalMedya1to0[6] === '1' ? 1 : 0,
                        nextsosyal_baskan: sosyalMedya1to0[7] === '1' ? 1 : 0
                    };
                } else {
                    const sosyalMedyaMetni = values[51] || '';
                    surveyData.sosyalMedya = sosyalMedyaMetni 
                        ? utils.parseSocialMediaFromText(sosyalMedyaMetni)
                        : Object.fromEntries(
                            ['instagram_belediye', 'instagram_baskan', 'twitter_belediye', 'twitter_baskan',
                             'facebook_belediye', 'facebook_baskan', 'nextsosyal_belediye', 'nextsosyal_baskan']
                            .map(key => [key, 0])
                        );
                }
                
                return surveyData;
            }
        };

        const themeManager = {
            showAllResponses: (themeKey, responses) => {
                const container = document.getElementById(`responses-${themeKey}`);
                const themeName = THEME_INFO[themeKey]?.title || themeKey;
                
                if (!container) return;

                const responsesHTML = responses.map(text => `
                    <div style="font-size: 12px; color: #374151; padding: 8px; background: #f9fafb; border-radius: 6px; margin-bottom: 4px; border-left: 3px solid #4A90E2;">
                        "${text}"
                    </div>
                `).join('');

                container.innerHTML = responsesHTML;

                const btn = container.nextElementSibling;
                if (btn && btn.tagName === 'BUTTON') {
                    btn.style.display = 'none';
                }

                utils.showMessage(`âœ… ${themeName} iÃ§in tÃ¼m ${responses.length} yorum gÃ¶steriliyor.`, 'success');
            }
        };

        const sorularManager = {
            selectQuestion: () => {
                const select = document.getElementById('soruSelect');
                const tbody = document.getElementById('sorularBody');
                
                if (!select || !tbody) return;
                
                const selectedIndex = select.value;
                const rows = tbody.querySelectorAll('tr');
                
                // TÃ¼m satÄ±rlarÄ± gÃ¶ster ve highlight'Ä± temizle
                rows.forEach(row => {
                    row.style.display = '';
                    row.classList.remove('soru-highlighted');
                });
                
                // EÄŸer bir soru seÃ§ildiyse
                if (selectedIndex !== '') {
                    rows.forEach(row => {
                        const soruIndex = row.getAttribute('data-soru-index');
                        
                        if (soruIndex === selectedIndex) {
                            // SeÃ§ilen soruyu highlight et
                            row.classList.add('soru-highlighted');
                            // SeÃ§ilen soruya scroll yap
                            setTimeout(() => {
                                row.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }, 100);
                        } else {
                            // DiÄŸer sorularÄ± gizle
                            row.style.display = 'none';
                        }
                    });
                }
            },

            selectMudurluk: () => {
                const select = document.getElementById('mudurlukSoruSelect');
                const thead = document.getElementById('sorularTableHead');
                const tbody = document.getElementById('sorularBody');
                
                if (!select || !thead || !tbody) return;
                
                const selectedKod = select.value;
                const selectedMudurluk = selectedKod ? `md_${selectedKod}` : '';
                
                // Header'dan hangi data-col'larÄ± gizleyeceÄŸimizi belirle
                const headerCells = thead.querySelectorAll('th[data-col]');
                const colsToHide = [];
                
                headerCells.forEach(cell => {
                    const col = cell.getAttribute('data-col');
                    const mudurlukKod = cell.getAttribute('data-mudurluk');
                    
                    // col=0: Soru - her zaman gÃ¶ster
                    // col=1 veya genel: Genel Belediye - her zaman gÃ¶ster
                    if (col === '0' || col === '1' || mudurlukKod === 'genel') {
                        cell.style.display = '';
                    } else if (!selectedKod) {
                        // SeÃ§im yoksa tÃ¼mÃ¼nÃ¼ gÃ¶ster
                        cell.style.display = '';
                    } else if (mudurlukKod === selectedMudurluk) {
                        // SeÃ§ili mÃ¼dÃ¼rlÃ¼ÄŸÃ¼ gÃ¶ster
                        cell.style.display = '';
                    } else {
                        // DiÄŸerlerini gizle ve col numarasÄ±nÄ± kaydet
                        cell.style.display = 'none';
                        colsToHide.push(col);
                    }
                });
                
                // Body'deki tÃ¼m hÃ¼crelerde aynÄ± col numaralarÄ±nÄ± gizle
                const bodyCells = tbody.querySelectorAll('td[data-col]');
                bodyCells.forEach(cell => {
                    const col = cell.getAttribute('data-col');
                    if (colsToHide.includes(col)) {
                        cell.style.display = 'none';
                    } else {
                        cell.style.display = '';
                    }
                });
            },

            resetFilters: () => {
                const soruSelect = document.getElementById('soruSelect');
                const mudurlukSelect = document.getElementById('mudurlukSoruSelect');
                
                if (soruSelect) soruSelect.value = '';
                if (mudurlukSelect) mudurlukSelect.value = '';
                
                sorularManager.selectQuestion();
                sorularManager.selectMudurluk();
                
                utils.showMessage('ðŸ”„ Filtreler sÄ±fÄ±rlandÄ±.', 'success');
            }
        };

        const sosyalMedyaManager = {
            renderDashboard: () => {
                const container = document.getElementById('sosyalMedyaDashboard');
                if (!container || !state.processedData) return;

                const allValidSurveys = Object.values(state.processedData).flatMap(md => md.gecerliAnketler);
                const genelSosyalMedya = utils.calculateSocialMedia(allValidSurveys);
                const totalPeople = allValidSurveys.length;

                const belediyeAccounts = [
                    { name: '@arnavutkoybelediyesi', platform: 'Instagram', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#E1306C"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>', percent: genelSosyalMedya.detay.instagram_belediye, color: '#E1306C' },
                    { name: '@ArnavutkoyBel', platform: 'Twitter', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#1DA1F2"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>', percent: genelSosyalMedya.detay.twitter_belediye, color: '#1DA1F2' },
                    { name: '@Arnavutkoybelediyesi', platform: 'Facebook', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#4267B2"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>', percent: genelSosyalMedya.detay.facebook_belediye, color: '#4267B2' },
                    { name: '@arnavutkoybelediyesi', platform: 'NextSosyal', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#6B46C1"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 6v6l4 2"/></svg>', percent: genelSosyalMedya.detay.nextsosyal_belediye, color: '#6B46C1' }
                ];

                const baskanAccounts = [
                    { name: '@mcandaroglutr', platform: 'Instagram', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#E1306C"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>', percent: genelSosyalMedya.detay.instagram_baskan, color: '#E1306C' },
                    { name: '@mcandaroglutr', platform: 'Twitter', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#1DA1F2"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>', percent: genelSosyalMedya.detay.twitter_baskan, color: '#1DA1F2' },
                    { name: '@mcandaroglutr', platform: 'Facebook', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#4267B2"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>', percent: genelSosyalMedya.detay.facebook_baskan, color: '#4267B2' },
                    { name: '@mustafa_candaroglu', platform: 'NextSosyal', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#6B46C1"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 6v6l4 2"/></svg>', percent: genelSosyalMedya.detay.nextsosyal_baskan, color: '#6B46C1' }
                ];

                const createAccountCard = (acc) => {
                    const followers = Math.round((parseFloat(acc.percent) / 100) * totalPeople);
                    return `
                        <div style="background: #f9fafb; padding: 16px; border-radius: 10px; border-left: 4px solid ${acc.color};">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <div style="width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;">${acc.icon}</div>
                                <div>
                                    <div style="font-size: 13px; color: #1a1a1a; font-weight: 600;">${acc.platform}</div>
                                    <div style="font-size: 11px; color: #9ca3af;">${acc.name}</div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="font-size: 24px; font-weight: 700; color: ${acc.color};">${acc.percent}%</div>
                                <div style="font-size: 12px; color: #6b7280; font-weight: 600;">${followers} kiÅŸi takip ediyor</div>
                            </div>
                        </div>
                    `;
                };

                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div style="background: white; padding: 20px; border-radius: 12px;">
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #1a1a1a;">Belediye HesaplarÄ± Genel Durum</h3>
                            <div style="display: grid; gap: 12px;">
                                ${belediyeAccounts.map(acc => createAccountCard(acc)).join('')}
                            </div>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 12px;">
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #1a1a1a;">BaÅŸkan HesaplarÄ± Genel Durum</h3>
                            <div style="display: grid; gap: 12px;">
                                ${baskanAccounts.map(acc => createAccountCard(acc)).join('')}
                            </div>
                        </div>
                    </div>
                `;
            },

            renderLiderlik: () => {
                const container = document.getElementById('sosyalMedyaLiderlik');
                if (!container || !state.processedData) return;

                const sorted = Object.values(state.processedData)
                    .map(md => {
                        const sm = md.sosyalMedya;
                        const allPlatforms = [
                            parseFloat(sm.detay?.instagram_belediye || 0),
                            parseFloat(sm.detay?.instagram_baskan || 0),
                            parseFloat(sm.detay?.twitter_belediye || 0),
                            parseFloat(sm.detay?.twitter_baskan || 0),
                            parseFloat(sm.detay?.facebook_belediye || 0),
                            parseFloat(sm.detay?.facebook_baskan || 0),
                            parseFloat(sm.detay?.nextsosyal_belediye || 0),
                            parseFloat(sm.detay?.nextsosyal_baskan || 0)
                        ];
                        const avgScore = allPlatforms.reduce((sum, val) => sum + val, 0) / 8;
                        
                        return {
                            ad: md.ad,
                            kod: md.kod,
                            score: avgScore,
                            anketSayisi: md.gecerliAnketler.length
                        };
                    })
                    .sort((a, b) => b.score - a.score);

                const count = sosyalMedyaManager.showAllDepts ? sorted.length : 4;
                const toShow = sorted.slice(0, count);

                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                        ${toShow.map((md, index) => {
                            const medals = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'];
                            const medal = index < 3 ? medals[index] : `#${index + 1}`;
                            
                            let color = '#6b7280';
                            if (md.score >= 75) color = '#10b981';
                            else if (md.score >= 50) color = '#4A90E2';
                            else if (md.score >= 25) color = '#f59e0b';

                            return `
                                <div style="background: #f9fafb; padding: 16px; border-radius: 10px; text-align: center;">
                                    <div style="font-size: 32px; margin-bottom: 8px;">${medal}</div>
                                    <div style="font-size: 13px; font-weight: 600; color: #1a1a1a; margin-bottom: 8px; min-height: 40px; display: flex; align-items: center; justify-content: center;">
                                        ${md.ad}
                                    </div>
                                    <div style="font-size: 24px; font-weight: 700; color: ${color}; margin-bottom: 4px;">
                                        ${md.score.toFixed(1)}%
                                    </div>
                                    <div style="font-size: 11px; color: #9ca3af;">
                                        Ortalama Takip
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
        };

        const surveyManager = {
            showAllDepts: false,

            toggleAllDepts: () => {
                surveyManager.showAllDepts = !surveyManager.showAllDepts;
                surveyManager.renderEnMemnunMudurlukler();
                
                const btn = document.getElementById('toggleDeptText');
                if (btn) {
                    btn.textContent = surveyManager.showAllDepts ? 'Daha Az GÃ¶r' : 'TÃ¼mÃ¼nÃ¼ GÃ¶r';
                }
            },

            renderGenelBakisCards: () => {
                const container = document.getElementById('genelBakisCards');
                if (!container || !state.processedData) return;

                const genelData = tableRenderer.calculateGenelBelediye();
                
                const cardsHTML = `
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px;">
                        <div style="background: #f9fafb; padding: 20px; border-radius: 10px; text-align: center;">
                            <p style="color: #6b7280; font-size: 13px; margin-bottom: 8px;">Toplam Personel</p>
                            <p style="color: #1a1a1a; font-size: 28px; font-weight: 700;">${genelData.toplamPersonel}</p>
                        </div>
                        <div style="background: #f9fafb; padding: 20px; border-radius: 10px; text-align: center;">
                            <p style="color: #6b7280; font-size: 13px; margin-bottom: 8px;">Toplam KatÄ±lan</p>
                            <p style="color: #1a1a1a; font-size: 28px; font-weight: 700;">${genelData.anketler.length}</p>
                        </div>
                        <div style="background: #f9fafb; padding: 20px; border-radius: 10px; text-align: center;">
                            <p style="color: #6b7280; font-size: 13px; margin-bottom: 8px;">GeÃ§erli Anket</p>
                            <p style="color: #1a1a1a; font-size: 28px; font-weight: 700;">${genelData.gecerliAnketler.length}</p>
                        </div>
                        <div style="background: #f9fafb; padding: 20px; border-radius: 10px; text-align: center;">
                            <p style="color: #6b7280; font-size: 13px; margin-bottom: 8px;">KatÄ±lÄ±m OranÄ±</p>
                            <p style="color: #4A90E2; font-size: 28px; font-weight: 700;">${genelData.katilimOrani}%</p>
                        </div>
                        <div style="background: #f9fafb; padding: 20px; border-radius: 10px; text-align: center;">
                            <p style="color: #6b7280; font-size: 13px; margin-bottom: 8px;">Genel Memnuniyet</p>
                            <p style="color: #4A90E2; font-size: 28px; font-weight: 700;">${genelData.genelMemnuniyet}%</p>
                        </div>
                    </div>
                `;
                
                container.innerHTML = cardsHTML;
            },

            renderEnMemnunMudurlukler: () => {
                const container = document.getElementById('enMemnunMudurlukler');
                if (!container || !state.processedData) return;

                const sorted = Object.values(state.processedData)
                    .map(md => ({
                        ad: md.ad,
                        memnuniyet: parseFloat(md.genelMemnuniyet) || 0,
                        anketSayisi: md.gecerliAnketler.length
                    }))
                    .sort((a, b) => b.memnuniyet - a.memnuniyet);

                const count = surveyManager.showAllDepts ? sorted.length : 9;
                const toShow = sorted.slice(0, count);

                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                        ${toShow.map(md => {
                            let icon = 'sentiment_neutral';
                            let color = '#9ca3af';
                            
                            if (md.anketSayisi > 0) {
                                if (md.memnuniyet >= 80) {
                                    icon = 'sentiment_very_satisfied';
                                    color = '#10b981';
                                } else if (md.memnuniyet >= 60) {
                                    icon = 'sentiment_satisfied';
                                    color = '#4A90E2';
                                }
                            }

                            const scoreText = md.anketSayisi === 0 
                                ? '<p style="font-size: 13px; color: #9ca3af;">Veri Yok</p>'
                                : `<p style="font-size: 14px; font-weight: 700; color: ${color};">${md.memnuniyet.toFixed(1)}%</p>`;

                            return `
                                <div style="background: #f9fafb; padding: 16px; border-radius: 10px; display: flex; align-items: center; gap: 14px;">
                                    <span class="material-icons" style="font-size: 40px; color: ${color};">${icon}</span>
                                    <div style="flex: 1;">
                                        <h3 style="font-size: 14px; font-weight: 600; color: #1a1a1a; margin-bottom: 4px;">${md.ad}</h3>
                                        ${scoreText}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            },

            removeSurvey: (anketKodu) => {
                const index = state.allSurveys.findIndex(s => s.kod === anketKodu);
                
                if (index !== -1) {
                    state.allSurveys.splice(index, 1);
                    state.processedData = dataProcessor.analyzeAllData(state.allSurveys);
                    tableRenderer.renderAllTables();
                    utils.showMessage(`âœ… "${anketKodu}" kodlu anket Ã§Ä±karÄ±ldÄ±.`, 'success');
                }
            },

            removeMudurlukSurveys: (mudurlukKod) => {
                const kod = typeof mudurlukKod === 'string' ? parseInt(mudurlukKod) : mudurlukKod;
                const mudurlukAdi = MUDURLUKLER[kod] ? MUDURLUKLER[kod].name : `#${kod}`;
                
                if (!confirm(`âš ï¸ DÄ°KKAT!\n\n${mudurlukAdi} mÃ¼dÃ¼rlÃ¼ÄŸÃ¼nÃ¼n TÃœM anketlerini silmek istediÄŸinizden emin misiniz?\n\nBu iÅŸlem geri alÄ±namaz!\n\n"OK" veya "Tamam" butonuna basarak onaylayÄ±n.`)) {
                    return;
                }
                
                const beforeCount = state.allSurveys.length;
                state.allSurveys = state.allSurveys.filter(s => s.mudurlukKod !== kod);
                const removedCount = beforeCount - state.allSurveys.length;
                
                state.processedData = dataProcessor.analyzeAllData(state.allSurveys);
                tableRenderer.renderAllTables();
                utils.showMessage(`âœ… ${removedCount} anket Ã§Ä±karÄ±ldÄ±.`, 'success');
            },

            updateMudurlukAnalysis: () => {
                const select = document.getElementById('mudurlukSelect');
                const kod = select.value;
                const tbody = document.getElementById('mudurlukSecBody');
                
                if (!tbody) return;
                
                if (!kod) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:30px;">LÃ¼tfen mÃ¼dÃ¼rlÃ¼k seÃ§iniz...</td></tr>';
                    return;
                }
                
                const md = state.processedData[kod];
                const genelBelediyeSorular = tableRenderer.calculateGenelBelediyeSorular();
                
                tbody.innerHTML = SORULAR.map((soru, i) => {
                    const genelSkor = parseFloat(genelBelediyeSorular[i]);
                    const mudurlukSkor = parseFloat(md.soruOrtalamalar[i]);
                    const fark = utils.formatPercentage(mudurlukSkor - genelSkor);
                    const farkClass = parseFloat(fark) >= 0 ? 'positive' : 'negative';
                    const farkSymbol = parseFloat(fark) >= 0 ? '+' : '';
                    
                    return `
                        <tr>
                            <td><strong>S${i+1}.</strong> ${soru}</td>
                            <td>${genelSkor}%</td>
                            <td><strong>${md.ad}</strong></td>
                            <td>${mudurlukSkor}%</td>
                            <td class="${farkClass}"><strong>${farkSymbol}${fark}%</strong></td>
                        </tr>
                    `;
                }).join('');
            }
        };
        
        const unifiedPriorityManager = {
            // AI Insights localStorage yÃ¶netimi
            getAIInsights: () => {
                const stored = localStorage.getItem('aiInsights');
                return stored ? JSON.parse(stored) : [];
            },
            
            saveAIInsight: (insight) => {
                const insights = unifiedPriorityManager.getAIInsights();
                insight.id = Date.now().toString();
                insight.createdAt = new Date().toISOString();
                insights.push(insight);
                localStorage.setItem('aiInsights', JSON.stringify(insights));
                return insight;
            },
            
            removeAIInsight: (id) => {
                const insights = unifiedPriorityManager.getAIInsights();
                const filtered = insights.filter(i => i.id !== id);
                localStorage.setItem('aiInsights', JSON.stringify(filtered));
            },
            
            // Ã–ncelik puanÄ± hesaplama
            calculatePriorityScore: (severity, scope, visibility) => {
                return Math.round((severity + scope + visibility) / 3);
            },
            
            // Soru bazlÄ± Ã¶ncelikler
            getQuestionPriorities: () => {
                if (!state.processedData || Object.keys(state.processedData).length === 0) return [];
                
                const allValidSurveys = Object.values(state.processedData).flatMap(md => md.gecerliAnketler);
                const genelSoruOrtalamalar = tableRenderer.calculateGenelBelediyeSorular();
                const totalPersonel = Object.values(MUDURLUKLER).reduce((sum, m) => sum + m.personel, 0);
                
                // Her sorunun aÃ§Ä±k uÃ§lularda geÃ§me frekansÄ±nÄ± hesapla
                const commentFrequency = SORULAR.map((soru, index) => {
                    const keywords = soru.toLowerCase().split(' ').filter(w => w.length > 3).slice(0, 3);
                    const matchingComments = allValidSurveys.filter(s => 
                        s.acikUclu && keywords.some(kw => s.acikUclu.toLowerCase().includes(kw))
                    );
                    return (matchingComments.length / allValidSurveys.length) * 100;
                });
                
                return SORULAR.map((soru, index) => {
                    const soruSkoru = parseFloat(genelSoruOrtalamalar[index]);
                    const belediyeOrtalamasi = parseFloat(
                        genelSoruOrtalamalar.reduce((sum, val) => sum + parseFloat(val), 0) / genelSoruOrtalamalar.length
                    );
                    
                    // Ciddiyet: Skor farkÄ± normalize edilmiÅŸ
                    const skorFarki = belediyeOrtalamasi - soruSkoru;
                    const severity = Math.min(100, Math.max(0, (skorFarki / 3) * 100));
                    
                    // Kapsam: Cevaplayan personel oranÄ±
                    const cevapSayisi = allValidSurveys.filter(s => s[`s${index + 1}`] !== undefined).length;
                    const scope = Math.min(100, (cevapSayisi / totalPersonel) * 100);
                    
                    // GÃ¶rÃ¼nÃ¼rlÃ¼k: AÃ§Ä±k uÃ§lularda geÃ§me frekansÄ±
                    const visibility = Math.min(100, commentFrequency[index] * 3);
                    
                    const priorityScore = unifiedPriorityManager.calculatePriorityScore(severity, scope, visibility);
                    
                    return {
                        type: 'soru',
                        id: `soru_${index}`,
                        title: soru,
                        soruNo: index + 1,
                        score: soruSkoru,
                        avgScore: belediyeOrtalamasi,
                        scoreDiff: skorFarki.toFixed(1),
                        affectedCount: cevapSayisi,
                        commentFrequency: commentFrequency[index].toFixed(1),
                        severity,
                        scope,
                        visibility,
                        priorityScore
                    };
                }).filter(item => item.priorityScore > 20); // Sadece Ã¶nemli olanlar
            },
            
            // Tema bazlÄ± Ã¶ncelikler
            getThemePriorities: () => {
                if (!state.processedData || Object.keys(state.processedData).length === 0) return [];
                
                const allValidSurveys = Object.values(state.processedData).flatMap(md => md.gecerliAnketler);
                const genelTemalar = tableRenderer.calculateGenelBelediyeTemalar();
                const temaOrtalamasi = Object.values(genelTemalar).reduce((sum, val) => sum + parseFloat(val), 0) / 10;
                const totalPersonel = Object.values(MUDURLUKLER).reduce((sum, m) => sum + m.personel, 0);
                
                return Object.entries(genelTemalar).map(([key, value]) => {
                    const temaSkoru = parseFloat(value);
                    const skorFarki = temaOrtalamasi - temaSkoru;
                    
                    // Ciddiyet
                    const severity = Math.min(100, Math.max(0, (skorFarki / 3) * 100));
                    
                    // Kapsam (tÃ¼m belediye)
                    const scope = 100;
                    
                    // GÃ¶rÃ¼nÃ¼rlÃ¼k (yorumlarda bahsedilme)
                    const keywords = THEME_INFO[key]?.keywords || [];
                    const matchingComments = allValidSurveys.filter(s => 
                        s.acikUclu && keywords.some(kw => s.acikUclu.toLowerCase().includes(kw))
                    );
                    const visibility = Math.min(100, (matchingComments.length / allValidSurveys.length) * 200);
                    
                    const priorityScore = unifiedPriorityManager.calculatePriorityScore(severity, scope, visibility);
                    
                    return {
                        type: 'tema',
                        id: `tema_${key}`,
                        title: THEME_INFO[key]?.title || key,
                        description: THEME_INFO[key]?.description || '',
                        score: temaSkoru,
                        avgScore: temaOrtalamasi,
                        scoreDiff: skorFarki.toFixed(1),
                        affectedCount: totalPersonel,
                        severity,
                        scope,
                        visibility,
                        priorityScore
                    };
                }).filter(item => item.priorityScore > 20);
            },
            
            // AI Insights Ã¶ncelikleri
            getAIInsightPriorities: () => {
                const insights = unifiedPriorityManager.getAIInsights();
                const totalPersonel = Object.values(MUDURLUKLER).reduce((sum, m) => sum + m.personel, 0);
                
                return insights.map(insight => {
                    // Ciddiyet: Duygu skoru (1-10, dÃ¼ÅŸÃ¼k = kÃ¶tÃ¼)
                    const severity = Math.min(100, ((10 - insight.sentiment) / 10) * 100);
                    
                    // Kapsam: Bahseden kiÅŸi sayÄ±sÄ±
                    const scope = Math.min(100, (insight.mentionCount / totalPersonel) * 100);
                    
                    // GÃ¶rÃ¼nÃ¼rlÃ¼k: Frekans yÃ¼zdesi
                    const visibility = Math.min(100, insight.frequency * 2);
                    
                    const priorityScore = unifiedPriorityManager.calculatePriorityScore(severity, scope, visibility);
                    
                    return {
                        type: 'yorum',
                        id: `ai_${insight.id}`,
                        title: insight.topic,
                        sentiment: insight.sentiment,
                        frequency: insight.frequency,
                        mentionCount: insight.mentionCount,
                        topPhrases: insight.topPhrases || [],
                        examples: insight.examples || [],
                        severity,
                        scope,
                        visibility,
                        priorityScore
                    };
                }).filter(item => item.priorityScore > 20);
            },
            
            // TÃ¼m Ã¶ncelikleri birleÅŸtir
            getAllPriorities: (filter = 'all') => {
                let priorities = [];
                
                if (filter === 'all' || filter === 'soru') {
                    priorities = [...priorities, ...unifiedPriorityManager.getQuestionPriorities()];
                }
                if (filter === 'all' || filter === 'tema') {
                    priorities = [...priorities, ...unifiedPriorityManager.getThemePriorities()];
                }
                if (filter === 'all' || filter === 'yorum') {
                    priorities = [...priorities, ...unifiedPriorityManager.getAIInsightPriorities()];
                }
                
                return priorities.sort((a, b) => b.priorityScore - a.priorityScore).slice(0, 10);
            }
        };
        
        const dashboardManager = {
            renderDashboard: () => {
                if (!state.processedData || Object.keys(state.processedData).length === 0) return;
                
                dashboardManager.renderMetrics();
                dashboardManager.renderUnifiedPriorities();
                dashboardManager.renderStrongWeakAreas();
                dashboardManager.renderMudurlukBarChart();
                dashboardManager.renderTopBottomMudurlukler();
                dashboardManager.renderSosyalMedya();
                dashboardManager.renderAcikUcluSummary();
                dashboardManager.renderRuhSagligi();
                dashboardManager.renderActionPriority();
            },
            
            renderMetrics: () => {
                const container = document.getElementById('dashboardMetrics');
                if (!container) return;
                
                const allValidSurveys = Object.values(state.processedData).flatMap(md => md.gecerliAnketler);
                const totalPersonel = Object.values(MUDURLUKLER).reduce((sum, m) => sum + m.personel, 0);
                const totalKatilan = state.allSurveys.length;
                const katilimOrani = utils.formatPercentage((totalKatilan / totalPersonel) * 100);
                
                const genelMemnuniyet = tableRenderer.calculateGenelBelediyeTemalar();
                const avgMemnuniyet = utils.formatPercentage(
                    Object.values(genelMemnuniyet).reduce((sum, val) => sum + parseFloat(val), 0) / 10
                );
                
                const workload = utils.calculateAverage(allValidSurveys, THEME_QUESTIONS.hizmetTalepYogunlugu);
                const support = utils.calculateAverage(allValidSurveys, 
                    [...THEME_QUESTIONS.yoneticilerleIliskiler, ...THEME_QUESTIONS.calismaArkadaslari, ...THEME_QUESTIONS.kurumIciIletisim]
                );
                const denge = utils.formatPercentage(parseFloat(support) - parseFloat(workload));
                
                const sosyalMedya = utils.calculateSocialMedia(allValidSurveys);
                
                const temaListesi = Object.entries(genelMemnuniyet).map(([key, val]) => THEME_INFO[key]?.title || key).join(', ');
                
                const temaBoxes = Object.entries(genelMemnuniyet).map(([key, val]) => {
                    const info = THEME_INFO[key];
                    return `<span style="display: inline-block; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 20px; margin: 2px 4px; font-size: 11px; font-weight: 600;">${info?.title || key}: ${val}%</span>`;
                }).join('');
                
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 16px; color: white; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);">
                            <div style="font-size: 14px; font-weight: 600; opacity: 0.95; margin-bottom: 12px; letter-spacing: 0.5px;">TOPLAM KATILIM</div>
                            <div style="font-size: 56px; font-weight: 900; line-height: 1; margin-bottom: 8px; text-shadow: 0 2px 10px rgba(0,0,0,0.2);">${katilimOrani}%</div>
                            <div style="font-size: 13px; opacity: 0.9; line-height: 1.5; font-weight: 500;">
                                <strong style="font-size: 18px;">${totalKatilan} kiÅŸi</strong> katÄ±ldÄ±<br>
                                <strong style="font-size: 18px;">${allValidSurveys.length} anket</strong> geÃ§erli sayÄ±ldÄ±
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 25px; border-radius: 16px; color: white; box-shadow: 0 8px 20px rgba(240, 147, 251, 0.4);">
                            <div style="font-size: 14px; font-weight: 600; opacity: 0.95; margin-bottom: 12px; letter-spacing: 0.5px;">GENEL MEMNUNÄ°YET</div>
                            <div style="font-size: 56px; font-weight: 900; line-height: 1; margin-bottom: 10px; text-shadow: 0 2px 10px rgba(0,0,0,0.2);">${avgMemnuniyet}%</div>
                            <div style="font-size: 10px; opacity: 0.95; line-height: 1.4;">
                                ${temaBoxes}
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 25px; border-radius: 16px; color: white; box-shadow: 0 8px 20px rgba(79, 172, 254, 0.4);">
                            <div style="font-size: 13px; font-weight: 600; opacity: 0.95; margin-bottom: 12px; letter-spacing: 0.3px;">ALGILANAN BELEDÄ°YE DESTEÄžÄ°NÄ°N HÄ°SSEDÄ°LEN Ä°Åž STRESÄ° Ä°LE DENGESÄ°</div>
                            <div style="font-size: 56px; font-weight: 900; line-height: 1; margin-bottom: 8px; text-shadow: 0 2px 10px rgba(0,0,0,0.2);">${denge >= 0 ? '+' : ''}${denge}%</div>
                            <div style="font-size: 13px; opacity: 0.95; line-height: 1.5; font-weight: 500;">
                                ${denge >= 0 ? `Personeller <strong style="font-size: 16px;">+${denge} puan</strong> destek gÃ¶rÃ¼yor` : `<strong style="font-size: 16px;">${Math.abs(denge)} puan</strong> destek eksikliÄŸi`}
                            </div>
                        </div>
                    </div>
                `;
            },
            
            renderUnifiedPriorities: () => {
                const container = document.getElementById('dashboardUnifiedPriorities');
                if (!container) return;
                
                let currentFilter = 'all';
                
                const renderList = (filter) => {
                    const priorities = unifiedPriorityManager.getAllPriorities(filter);
                    
                    const getTypeBadge = (type) => {
                        if (type === 'soru') return '<span style="background: #3b82f6; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;">SORU</span>';
                        if (type === 'tema') return '<span style="background: #10b981; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;">TEMA</span>';
                        if (type === 'yorum') return '<span style="background: #f59e0b; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;">YORUM</span>';
                    };
                    
                    const renderCard = (item, index) => {
                        if (item.type === 'soru') {
                            return `
                                <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #e5e7eb; border-left: 5px solid #3b82f6;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                        <div style="flex: 1;">
                                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                                <span style="font-size: 20px; font-weight: 700; color: #1a1a1a;">${index + 1}.</span>
                                                ${getTypeBadge(item.type)}
                                                <span style="font-size: 14px; font-weight: 700; color: #1a1a1a;">${item.title}</span>
                                            </div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 32px; font-weight: 900; color: #3b82f6;">%${item.priorityScore}</div>
                                            <div style="font-size: 11px; color: #6b7280;">Ã–ncelik Skoru</div>
                                        </div>
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 15px;">
                                        <div style="background: #eff6ff; padding: 12px; border-radius: 8px;">
                                            <div style="font-size: 11px; color: #3b82f6; font-weight: 600; margin-bottom: 4px;">ðŸ“Š CÄ°DDÄ°YET</div>
                                            <div style="font-size: 16px; font-weight: 700; color: #1a1a1a;">%${Math.round(item.severity)}</div>
                                            <div style="font-size: 10px; color: #6b7280; margin-top: 4px;">Skor: ${item.score}% (Ort: ${item.avgScore.toFixed(1)}%)</div>
                                        </div>
                                        <div style="background: #f0fdf4; padding: 12px; border-radius: 8px;">
                                            <div style="font-size: 11px; color: #10b981; font-weight: 600; margin-bottom: 4px;">ðŸ‘¥ KAPSAM</div>
                                            <div style="font-size: 16px; font-weight: 700; color: #1a1a1a;">%${Math.round(item.scope)}</div>
                                            <div style="font-size: 10px; color: #6b7280; margin-top: 4px;">${item.affectedCount} kiÅŸi etkileniyor</div>
                                        </div>
                                        <div style="background: #fef3c7; padding: 12px; border-radius: 8px;">
                                            <div style="font-size: 11px; color: #f59e0b; font-weight: 600; margin-bottom: 4px;">ðŸ’¬ GÃ–RÃœNÃœRLÃœK</div>
                                            <div style="font-size: 16px; font-weight: 700; color: #1a1a1a;">%${Math.round(item.visibility)}</div>
                                            <div style="font-size: 10px; color: #6b7280; margin-top: 4px;">Yorumlarda %${item.commentFrequency} geÃ§iyor</div>
                                        </div>
                                    </div>
                                    
                                    <div style="background: #f9fafb; padding: 12px; border-radius: 8px;">
                                        <div style="font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 6px;">ðŸ’¡ Ã–nerilen Aksiyonlar:</div>
                                        <div style="font-size: 12px; color: #6b7280;">
                                            â€¢ Soru bazÄ±nda departman analizi yapÄ±n<br>
                                            â€¢ DÃ¼ÅŸÃ¼k skorlu departmanlarla gÃ¶rÃ¼ÅŸmeler planlayÄ±n<br>
                                            â€¢ KÄ±sa vadeli iyileÅŸtirme planÄ± hazÄ±rlayÄ±n
                                        </div>
                                    </div>
                                </div>
                            `;
                        } else if (item.type === 'tema') {
                            return `
                                <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #e5e7eb; border-left: 5px solid #10b981;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                        <div style="flex: 1;">
                                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                                <span style="font-size: 20px; font-weight: 700; color: #1a1a1a;">${index + 1}.</span>
                                                ${getTypeBadge(item.type)}
                                                <span style="font-size: 14px; font-weight: 700; color: #1a1a1a;">${item.title}</span>
                                            </div>
                                            <div style="font-size: 11px; color: #6b7280; font-style: italic;">${item.description}</div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 32px; font-weight: 900; color: #10b981;">%${item.priorityScore}</div>
                                            <div style="font-size: 11px; color: #6b7280;">Ã–ncelik Skoru</div>
                                        </div>
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 15px;">
                                        <div style="background: #eff6ff; padding: 12px; border-radius: 8px;">
                                            <div style="font-size: 11px; color: #3b82f6; font-weight: 600; margin-bottom: 4px;">ðŸ“Š CÄ°DDÄ°YET</div>
                                            <div style="font-size: 16px; font-weight: 700; color: #1a1a1a;">%${Math.round(item.severity)}</div>
                                            <div style="font-size: 10px; color: #6b7280; margin-top: 4px;">Skor: ${item.score}% (Ort: ${item.avgScore.toFixed(1)}%)</div>
                                        </div>
                                        <div style="background: #f0fdf4; padding: 12px; border-radius: 8px;">
                                            <div style="font-size: 11px; color: #10b981; font-weight: 600; margin-bottom: 4px;">ðŸ‘¥ KAPSAM</div>
                                            <div style="font-size: 16px; font-weight: 700; color: #1a1a1a;">%${Math.round(item.scope)}</div>
                                            <div style="font-size: 10px; color: #6b7280; margin-top: 4px;">TÃ¼m belediye (${item.affectedCount} kiÅŸi)</div>
                                        </div>
                                        <div style="background: #fef3c7; padding: 12px; border-radius: 8px;">
                                            <div style="font-size: 11px; color: #f59e0b; font-weight: 600; margin-bottom: 4px;">ðŸ’¬ GÃ–RÃœNÃœRLÃœK</div>
                                            <div style="font-size: 16px; font-weight: 700; color: #1a1a1a;">%${Math.round(item.visibility)}</div>
                                            <div style="font-size: 10px; color: #6b7280; margin-top: 4px;">Yorumlarda bahsediliyor</div>
                                        </div>
                                    </div>
                                    
                                    <div style="background: #f9fafb; padding: 12px; border-radius: 8px;">
                                        <div style="font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 6px;">ðŸ’¡ Ã–nerilen Aksiyonlar:</div>
                                        <div style="font-size: 12px; color: #6b7280;">
                                            â€¢ Tema alt sorularÄ±nÄ± detaylÄ± inceleyin<br>
                                            â€¢ TÃ¼m departmanlara yÃ¶nelik iyileÅŸtirme planÄ±<br>
                                            â€¢ Ã‡alÄ±ÅŸtaylar ve eÄŸitim programlarÄ± dÃ¼zenleyin
                                        </div>
                                    </div>
                                </div>
                            `;
                        } else if (item.type === 'yorum') {
                            return `
                                <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 2px solid #e5e7eb; border-left: 5px solid #f59e0b;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                        <div style="flex: 1;">
                                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                                <span style="font-size: 20px; font-weight: 700; color: #1a1a1a;">${index + 1}.</span>
                                                ${getTypeBadge(item.type)}
                                                <span style="font-size: 14px; font-weight: 700; color: #1a1a1a;">${item.title}</span>
                                            </div>
                                            <div style="font-size: 11px; color: #6b7280;">âš ï¸ Ankette direkt soru yok ama aÃ§Ä±k uÃ§lu yorumlarda tespit edildi</div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 32px; font-weight: 900; color: #f59e0b;">%${item.priorityScore}</div>
                                            <div style="font-size: 11px; color: #6b7280;">Ã–ncelik Skoru</div>
                                        </div>
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 15px;">
                                        <div style="background: #eff6ff; padding: 12px; border-radius: 8px;">
                                            <div style="font-size: 11px; color: #3b82f6; font-weight: 600; margin-bottom: 4px;">ðŸ“Š CÄ°DDÄ°YET</div>
                                            <div style="font-size: 16px; font-weight: 700; color: #1a1a1a;">%${Math.round(item.severity)}</div>
                                            <div style="font-size: 10px; color: #6b7280; margin-top: 4px;">Duygu: ${item.sentiment}/10 ${item.sentiment <= 3 ? '(Ã‡ok olumsuz)' : item.sentiment <= 6 ? '(Olumsuz)' : '(Orta)'}</div>
                                        </div>
                                        <div style="background: #f0fdf4; padding: 12px; border-radius: 8px;">
                                            <div style="font-size: 11px; color: #10b981; font-weight: 600; margin-bottom: 4px;">ðŸ‘¥ KAPSAM</div>
                                            <div style="font-size: 16px; font-weight: 700; color: #1a1a1a;">%${Math.round(item.scope)}</div>
                                            <div style="font-size: 10px; color: #6b7280; margin-top: 4px;">${item.mentionCount} kiÅŸi bahsetmiÅŸ</div>
                                        </div>
                                        <div style="background: #fef3c7; padding: 12px; border-radius: 8px;">
                                            <div style="font-size: 11px; color: #f59e0b; font-weight: 600; margin-bottom: 4px;">ðŸ’¬ GÃ–RÃœNÃœRLÃœK</div>
                                            <div style="font-size: 16px; font-weight: 700; color: #1a1a1a;">%${Math.round(item.visibility)}</div>
                                            <div style="font-size: 10px; color: #6b7280; margin-top: 4px;">%${item.frequency} yorumda geÃ§iyor</div>
                                        </div>
                                    </div>
                                    
                                    ${item.topPhrases && item.topPhrases.length > 0 ? `
                                        <div style="background: #fef3c7; padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                                            <div style="font-size: 11px; font-weight: 600; color: #f59e0b; margin-bottom: 6px;">ðŸ“ En SÄ±k GeÃ§en Ä°fadeler:</div>
                                            ${item.topPhrases.map(phrase => `<div style="font-size: 11px; color: #6b7280;">â€¢ ${phrase}</div>`).join('')}
                                        </div>
                                    ` : ''}
                                    
                                    ${item.examples && item.examples.length > 0 ? `
                                        <div style="background: #f9fafb; padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                                            <div style="font-size: 11px; font-weight: 600; color: #374151; margin-bottom: 6px;">ðŸ’¬ Ã–rnek Yorumlar:</div>
                                            ${item.examples.slice(0, 2).map((ex, i) => `<div style="font-size: 11px; color: #6b7280; margin-bottom: 6px;"><strong>${i + 1}.</strong> "${ex}"</div>`).join('')}
                                        </div>
                                    ` : ''}
                                    
                                    <div style="background: #f9fafb; padding: 12px; border-radius: 8px;">
                                        <div style="font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 6px;">ðŸ’¡ Ã–nerilen Aksiyonlar:</div>
                                        <div style="font-size: 12px; color: #6b7280;">
                                            â€¢ Bu konuyu Ã¶nÃ¼mÃ¼zdeki ankete ekleyin<br>
                                            â€¢ Personel odak gruplarÄ± dÃ¼zenleyin<br>
                                            â€¢ HÄ±zlÄ± aksiyon planÄ± oluÅŸturun
                                        </div>
                                    </div>
                                    
                                    <button onclick="if(confirm('Bu AI analizini silmek istediÄŸinize emin misiniz?')) { unifiedPriorityManager.removeAIInsight('${item.id.replace('ai_', '')}'); dashboardManager.renderUnifiedPriorities(); }" style="margin-top: 10px; padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px;">
                                        Sil
                                    </button>
                                </div>
                            `;
                        }
                    };
                    
                    const html = `
                        <div style="background: white; padding: 25px; border-radius: 12px; margin: 20px 0; border: 1px solid #e5e7eb;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h2 style="font-size: 20px; font-weight: 700; color: #1a1a1a; display: flex; align-items: center; gap: 10px;">
                                    <span class="material-icons" style="font-size: 28px; color: #4A90E2;">priority_high</span>
                                    ðŸŽ¯ Ã–ncelikli MÃ¼dahale AlanlarÄ± (Unified Liste)
                                </h2>
                                <button onclick="document.getElementById('aiInsightModal').style.display='flex';" style="padding: 10px 20px; background: #4A90E2; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <span class="material-icons" style="font-size: 20px;">add_circle</span>
                                    AI Analizi Ekle
                                </button>
                            </div>
                            
                            <p style="color: #6b7280; margin-bottom: 20px; font-size: 14px;">
                                TÃ¼m veri kaynaklarÄ±ndan (temalar, sorular, aÃ§Ä±k uÃ§lu yorumlar) Ã¶ncelik sÄ±rasÄ±na gÃ¶re birleÅŸtirilmiÅŸ liste. 
                                Her Ã¶ÄŸe Ciddiyet Ã— Kapsam Ã— GÃ¶rÃ¼nÃ¼rlÃ¼k formÃ¼lÃ¼yle puanlanmÄ±ÅŸtÄ±r.
                            </p>
                            
                            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                <button onclick="renderUnifiedList('all')" style="padding: 8px 16px; background: ${currentFilter === 'all' ? '#4A90E2' : '#e5e7eb'}; color: ${currentFilter === 'all' ? 'white' : '#6b7280'}; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    TÃ¼mÃ¼
                                </button>
                                <button onclick="renderUnifiedList('tema')" style="padding: 8px 16px; background: ${currentFilter === 'tema' ? '#10b981' : '#e5e7eb'}; color: ${currentFilter === 'tema' ? 'white' : '#6b7280'}; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    Temalar
                                </button>
                                <button onclick="renderUnifiedList('soru')" style="padding: 8px 16px; background: ${currentFilter === 'soru' ? '#3b82f6' : '#e5e7eb'}; color: ${currentFilter === 'soru' ? 'white' : '#6b7280'}; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    Sorular
                                </button>
                                <button onclick="renderUnifiedList('yorum')" style="padding: 8px 16px; background: ${currentFilter === 'yorum' ? '#f59e0b' : '#e5e7eb'}; color: ${currentFilter === 'yorum' ? 'white' : '#6b7280'}; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    Yorumlar
                                </button>
                            </div>
                            
                            <div id="unifiedPriorityList">
                                ${priorities.length > 0 ? priorities.map((item, index) => renderCard(item, index)).join('') : '<div style="text-align: center; padding: 40px; color: #6b7280;">HenÃ¼z Ã¶ncelikli alan bulunamadÄ±. Veri girin veya AI analizi ekleyin.</div>'}
                            </div>
                        </div>
                    `;
                    
                    container.innerHTML = html;
                };
                
                window.renderUnifiedList = (filter) => {
                    currentFilter = filter;
                    renderList(filter);
                };
                
                renderList(currentFilter);
            },
            
            renderStrongWeakAreas: () => {
                const strongContainer = document.getElementById('dashboardStrongAreas');
                const weakContainer = document.getElementById('dashboardWeakAreas');
                if (!strongContainer || !weakContainer) return;
                
                const genelTemalar = tableRenderer.calculateGenelBelediyeTemalar();
                const allValidSurveys = Object.values(state.processedData).flatMap(md => md.gecerliAnketler);
                
                const temaArray = Object.entries(genelTemalar).map(([key, value]) => ({
                    key,
                    name: THEME_INFO[key]?.title || key,
                    description: THEME_INFO[key]?.description || '',
                    score: parseFloat(value),
                    questions: THEME_QUESTIONS[key] || []
                }));
                
                const sorted = temaArray.sort((a, b) => b.score - a.score);
                const strongAreas = sorted.slice(0, 5);
                const weakAreas = sorted.slice(-5).reverse();
                
                const getExampleComments = (tema) => {
                    const comments = allValidSurveys
                        .filter(s => s.acikUclu && s.acikUclu.trim())
                        .map(s => s.acikUclu)
                        .filter(comment => {
                            const keywords = tema.name.toLowerCase().split(' ');
                            return keywords.some(kw => comment.toLowerCase().includes(kw));
                        });
                    return comments.length > 0 ? comments : ['Belirli bir yorum bulunamadÄ±'];
                };
                
                const getQuestionScores = (tema) => {
                    if (!tema.questions || tema.questions.length === 0) return [];
                    return tema.questions.map(qNum => {
                        const score = utils.calculateAverage(allValidSurveys, [qNum]);
                        const question = SORULAR[qNum - 1];
                        return {
                            number: qNum,
                            text: question || `Soru ${qNum}`,
                            score: parseFloat(score)
                        };
                    });
                };
                
                strongContainer.innerHTML = `
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #10b981;">
                        <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 12px; color: #10b981; display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons" style="font-size: 20px;">trending_up</span>
                            âœ… En GÃ¼Ã§lÃ¼ 5 Alan
                        </h3>
                        ${strongAreas.map((area, i) => {
                            const examples = getExampleComments(area);
                            const questionScores = getQuestionScores(area);
                            const displayComments = examples.slice(0, 5);
                            const hasMore = examples.length > 5;
                            const strongId = `strong_${i}`;
                            return `
                                <div style="background: #f0fdf4; padding: 10px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid #10b981;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;" onclick="
                                        const details = document.getElementById('${strongId}_details');
                                        const icon = document.getElementById('${strongId}_icon');
                                        if (details.style.display === 'none') {
                                            details.style.display = 'block';
                                            icon.textContent = 'expand_less';
                                        } else {
                                            details.style.display = 'none';
                                            icon.textContent = 'expand_more';
                                        }
                                    ">
                                        <div style="flex: 1;">
                                            <span style="font-size: 14px; font-weight: 700; color: #10b981;">${i + 1}.</span>
                                            <strong style="font-size: 14px; color: #1a1a1a;">${area.name}</strong>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <div style="font-size: 18px; font-weight: 700; color: #10b981;">${area.score}%</div>
                                            <span class="material-icons" id="${strongId}_icon" style="font-size: 20px; color: #10b981;">expand_more</span>
                                        </div>
                                    </div>
                                    
                                    <div id="${strongId}_details" style="display: none; margin-top: 10px; padding-top: 10px; border-top: 1px dashed #10b981;">
                                        <div style="font-size: 11px; color: #6b7280; margin-bottom: 8px; font-style: italic;">
                                            ${area.description}
                                        </div>
                                        
                                        ${questionScores.length > 0 ? `
                                            <div style="background: white; padding: 8px; border-radius: 4px; margin-bottom: 8px;">
                                                <div style="font-size: 11px; font-weight: 600; color: #10b981; margin-bottom: 6px;">ðŸ“Š Sorular:</div>
                                                ${questionScores.map(q => `
                                                    <div style="display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px dashed #e5e7eb; font-size: 11px;">
                                                        <div style="color: #374151; flex: 1;">${q.text}</div>
                                                        <div style="font-weight: 600; color: #10b981; margin-left: 8px;">${q.score}%</div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        ` : ''}
                                        
                                        <div style="background: white; padding: 8px; border-radius: 4px;">
                                            <div style="font-size: 11px; font-weight: 600; color: #10b981; margin-bottom: 6px;">ðŸ’¬ Yorumlar:</div>
                                            ${displayComments.map((comment, idx) => `
                                                <div style="font-size: 11px; color: #374151; padding: 4px 0; border-bottom: 1px dashed #e5e7eb;">
                                                    <strong>${idx + 1}.</strong> "${comment.substring(0, 120)}${comment.length > 120 ? '...' : ''}"
                                                </div>
                                            `).join('')}
                                            <div id="${strongId}_rest" style="display: none;">
                                                ${examples.slice(5).map((comment, idx) => `
                                                    <div style="font-size: 11px; color: #374151; padding: 4px 0; border-bottom: 1px dashed #e5e7eb;">
                                                        <strong>${idx + 6}.</strong> "${comment.substring(0, 120)}${comment.length > 120 ? '...' : ''}"
                                                    </div>
                                                `).join('')}
                                            </div>
                                            ${hasMore ? `
                                                <button onclick="event.stopPropagation(); 
                                                    const el = document.getElementById('${strongId}_rest');
                                                    const btn = event.target;
                                                    if (el.style.display === 'none') {
                                                        el.style.display = 'block';
                                                        btn.textContent = 'Daha Az';
                                                    } else {
                                                        el.style.display = 'none';
                                                        btn.textContent = 'TÃ¼mÃ¼ (${examples.length})';
                                                    }
                                                " style="margin-top: 6px; padding: 4px 8px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 10px;">
                                                    TÃ¼mÃ¼ (${examples.length})
                                                </button>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                weakContainer.innerHTML = `
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #ef4444;">
                        <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 12px; color: #ef4444; display: flex; align-items: center; gap: 8px;">
                            <span class="material-icons" style="font-size: 20px;">trending_down</span>
                            âš ï¸ GeliÅŸtirilmesi Gereken 5 Alan
                        </h3>
                        ${weakAreas.map((area, i) => {
                            const examples = getExampleComments(area);
                            const questionScores = getQuestionScores(area);
                            const displayComments = examples.slice(0, 5);
                            const hasMore = examples.length > 5;
                            const weakId = `weak_${i}`;
                            return `
                                <div style="background: #fef2f2; padding: 10px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid #ef4444;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;" onclick="
                                        const details = document.getElementById('${weakId}_details');
                                        const icon = document.getElementById('${weakId}_icon');
                                        if (details.style.display === 'none') {
                                            details.style.display = 'block';
                                            icon.textContent = 'expand_less';
                                        } else {
                                            details.style.display = 'none';
                                            icon.textContent = 'expand_more';
                                        }
                                    ">
                                        <div style="flex: 1;">
                                            <span style="font-size: 14px; font-weight: 700; color: #ef4444;">${i + 1}.</span>
                                            <strong style="font-size: 14px; color: #1a1a1a;">${area.name}</strong>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <div style="font-size: 18px; font-weight: 700; color: #ef4444;">${area.score}%</div>
                                            <span class="material-icons" id="${weakId}_icon" style="font-size: 20px; color: #ef4444;">expand_more</span>
                                        </div>
                                    </div>
                                    
                                    <div id="${weakId}_details" style="display: none; margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ef4444;">
                                        <div style="font-size: 11px; color: #6b7280; margin-bottom: 8px; font-style: italic;">
                                            ${area.description}
                                        </div>
                                        
                                        ${questionScores.length > 0 ? `
                                            <div style="background: white; padding: 8px; border-radius: 4px; margin-bottom: 8px;">
                                                <div style="font-size: 11px; font-weight: 600; color: #ef4444; margin-bottom: 6px;">ðŸ“Š Sorular:</div>
                                                ${questionScores.map(q => `
                                                    <div style="display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px dashed #e5e7eb; font-size: 11px;">
                                                        <div style="color: #374151; flex: 1;">${q.text}</div>
                                                        <div style="font-weight: 600; color: #ef4444; margin-left: 8px;">${q.score}%</div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        ` : ''}
                                        
                                        <div style="background: white; padding: 8px; border-radius: 4px;">
                                            <div style="font-size: 11px; font-weight: 600; color: #ef4444; margin-bottom: 6px;">ðŸ’¬ Yorumlar:</div>
                                            ${displayComments.map((comment, idx) => `
                                                <div style="font-size: 11px; color: #374151; padding: 4px 0; border-bottom: 1px dashed #e5e7eb;">
                                                    <strong>${idx + 1}.</strong> "${comment.substring(0, 120)}${comment.length > 120 ? '...' : ''}"
                                                </div>
                                            `).join('')}
                                            <div id="${weakId}_rest" style="display: none;">
                                                ${examples.slice(5).map((comment, idx) => `
                                                    <div style="font-size: 11px; color: #374151; padding: 4px 0; border-bottom: 1px dashed #e5e7eb;">
                                                        <strong>${idx + 6}.</strong> "${comment.substring(0, 120)}${comment.length > 120 ? '...' : ''}"
                                                    </div>
                                                `).join('')}
                                            </div>
                                            ${hasMore ? `
                                                <button onclick="event.stopPropagation(); 
                                                    const el = document.getElementById('${weakId}_rest');
                                                    const btn = event.target;
                                                    if (el.style.display === 'none') {
                                                        el.style.display = 'block';
                                                        btn.textContent = 'Daha Az';
                                                    } else {
                                                        el.style.display = 'none';
                                                        btn.textContent = 'TÃ¼mÃ¼ (${examples.length})';
                                                    }
                                                " style="margin-top: 6px; padding: 4px 8px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 10px;">
                                                    TÃ¼mÃ¼ (${examples.length})
                                                </button>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            },
            
            renderMudurlukBarChart: () => {
                const canvas = document.getElementById('mudurlukBarChart');
                if (!canvas) return;
                
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js yÃ¼klenmedi!');
                    canvas.parentElement.innerHTML = '<p style="text-align:center;padding:20px;color:#ef4444;">Chart.js yÃ¼klenemedi. LÃ¼tfen sayfayÄ± yenileyin.</p>';
                    return;
                }
                
                if (state.charts.mudurlukBar) {
                    state.charts.mudurlukBar.destroy();
                }
                
                const mudurlukler = Object.values(state.processedData)
                    .sort((a, b) => parseFloat(b.genelMemnuniyet) - parseFloat(a.genelMemnuniyet));
                
                const ctx = canvas.getContext('2d');
                state.charts.mudurlukBar = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: mudurlukler.map(m => m.ad),
                        datasets: [{
                            label: 'Genel Memnuniyet (%)',
                            data: mudurlukler.map(m => parseFloat(m.genelMemnuniyet)),
                            backgroundColor: mudurlukler.map(m => {
                                const score = parseFloat(m.genelMemnuniyet);
                                if (score >= 70) return '#10b981';
                                if (score >= 50) return '#f59e0b';
                                return '#ef4444';
                            })
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    title: (context) => {
                                        const m = mudurlukler[context[0].dataIndex];
                                        return m.ad;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: { display: true, text: 'Memnuniyet Skoru (%)' }
                            }
                        }
                    }
                });
            },
            
            renderTopBottomMudurlukler: () => {
                const topContainer = document.getElementById('topMudurlukler');
                const bottomContainer = document.getElementById('bottomMudurlukler');
                if (!topContainer || !bottomContainer) return;
                
                const sorted = Object.values(state.processedData)
                    .sort((a, b) => parseFloat(b.genelMemnuniyet) - parseFloat(a.genelMemnuniyet));
                
                const top5 = sorted.slice(0, 5);
                const bottom5 = sorted.slice(-5).reverse();
                
                topContainer.innerHTML = top5.map((m, i) => `
                    <div style="display: flex; align-items: center; padding: 12px; background: #f0fdf4; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid #10b981;">
                        <div style="font-size: 20px; font-weight: 700; color: #10b981; width: 30px;">${i + 1}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: #1a1a1a;">${m.ad}</div>
                            <div style="font-size: 12px; color: #6b7280;">${m.gecerliAnketler.length} anket</div>
                        </div>
                        <div style="font-size: 24px; font-weight: 700; color: #10b981;">${m.genelMemnuniyet}%</div>
                    </div>
                `).join('');
                
                bottomContainer.innerHTML = bottom5.map((m, i) => `
                    <div style="display: flex; align-items: center; padding: 12px; background: #fef2f2; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid #ef4444;">
                        <div style="font-size: 20px; font-weight: 700; color: #ef4444; width: 30px;">${i + 1}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: #1a1a1a;">${m.ad}</div>
                            <div style="font-size: 12px; color: #6b7280;">${m.gecerliAnketler.length} anket</div>
                        </div>
                        <div style="font-size: 24px; font-weight: 700; color: #ef4444;">${m.genelMemnuniyet}%</div>
                    </div>
                `).join('');
            },
            
            renderSosyalMedya: () => {
                const container = document.getElementById('dashboardSosyalMedya');
                if (!container) return;
                
                const allValidSurveys = Object.values(state.processedData).flatMap(md => md.gecerliAnketler);
                const genelSosyalMedya = utils.calculateSocialMedia(allValidSurveys);
                const totalPeople = allValidSurveys.length;

                const belediyeAccounts = [
                    { name: '@arnavutkoybelediyesi', platform: 'Instagram', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#E1306C"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>', percent: genelSosyalMedya.detay.instagram_belediye, color: '#E1306C' },
                    { name: '@ArnavutkoyBel', platform: 'Twitter', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#1DA1F2"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>', percent: genelSosyalMedya.detay.twitter_belediye, color: '#1DA1F2' },
                    { name: '@Arnavutkoybelediyesi', platform: 'Facebook', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#4267B2"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>', percent: genelSosyalMedya.detay.facebook_belediye, color: '#4267B2' },
                    { name: '@arnavutkoybelediyesi', platform: 'NextSosyal', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#6B46C1"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 6v6l4 2"/></svg>', percent: genelSosyalMedya.detay.nextsosyal_belediye, color: '#6B46C1' }
                ];

                const baskanAccounts = [
                    { name: '@mcanaroglutr', platform: 'Instagram', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#E1306C"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>', percent: genelSosyalMedya.detay.instagram_baskan, color: '#E1306C' },
                    { name: '@mcanaroglutr', platform: 'Twitter', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#1DA1F2"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>', percent: genelSosyalMedya.detay.twitter_baskan, color: '#1DA1F2' },
                    { name: '@mcanaroglutr', platform: 'Facebook', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#4267B2"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>', percent: genelSosyalMedya.detay.facebook_baskan, color: '#4267B2' },
                    { name: '@mustafa_canaroglu', platform: 'NextSosyal', icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="#6B46C1"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 6v6l4 2"/></svg>', percent: genelSosyalMedya.detay.nextsosyal_baskan, color: '#6B46C1' }
                ];

                const createAccountCard = (account) => {
                    const followers = Math.round(parseFloat(account.percent) * totalPeople / 100);
                    const percentValue = parseFloat(account.percent);
                    
                    return `
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: white; border-radius: 8px; border-left: 4px solid ${account.color};">
                            <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                                ${account.icon}
                                <div>
                                    <div style="font-weight: 600; font-size: 14px; color: #1a1a1a;">${account.platform}</div>
                                    <div style="font-size: 12px; color: #6b7280;">${account.name}</div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 24px; font-weight: 700; color: ${account.color};">${percentValue.toFixed(1)}%</div>
                                <div style="font-size: 12px; color: #6b7280; font-weight: 600;">${followers} kiÅŸi takip ediyor</div>
                            </div>
                        </div>
                    `;
                };

                // Calculate bottom 5 departments by social media score
                const mudurluklerSorted = Object.values(state.processedData)
                    .filter(md => md.sosyalMedya && md.sosyalMedya.detay)
                    .map(md => {
                        const sm = md.sosyalMedya;
                        const allPlatforms = [
                            parseFloat(sm.detay?.instagram_belediye || 0),
                            parseFloat(sm.detay?.instagram_baskan || 0),
                            parseFloat(sm.detay?.twitter_belediye || 0),
                            parseFloat(sm.detay?.twitter_baskan || 0),
                            parseFloat(sm.detay?.facebook_belediye || 0),
                            parseFloat(sm.detay?.facebook_baskan || 0),
                            parseFloat(sm.detay?.nextsosyal_belediye || 0),
                            parseFloat(sm.detay?.nextsosyal_baskan || 0)
                        ];
                        const avgScore = allPlatforms.reduce((sum, val) => sum + val, 0) / 8;
                        
                        return {
                            ad: md.ad,
                            score: avgScore,
                            anketSayisi: md.gecerliAnketler.length
                        };
                    })
                    .sort((a, b) => a.score - b.score);
                
                const bottom5 = mudurluklerSorted.slice(0, 5);

                container.innerHTML = `
                    <div style="background: white; padding: 20px; border-radius: 12px; margin: 20px 0; border: 1px solid #e5e7eb;">
                        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 20px; color: #1a1a1a;">
                            ðŸ“± Sosyal Medya Takip DetaylarÄ±
                        </h2>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div style="background: #f9fafb; padding: 20px; border-radius: 12px;">
                                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #1a1a1a;">Belediye HesaplarÄ± Genel Durum</h3>
                                <div style="display: grid; gap: 12px;">
                                    ${belediyeAccounts.map(acc => createAccountCard(acc)).join('')}
                                </div>
                            </div>
                            <div style="background: #f9fafb; padding: 20px; border-radius: 12px;">
                                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #1a1a1a;">BaÅŸkan HesaplarÄ± Genel Durum</h3>
                                <div style="display: grid; gap: 12px;">
                                    ${baskanAccounts.map(acc => createAccountCard(acc)).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #fef2f2; padding: 20px; border-radius: 12px; margin-top: 20px; border: 1px solid #fecaca;">
                            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #ef4444; display: flex; align-items: center; gap: 8px;">
                                <span class="material-icons" style="font-size: 20px;">trending_down</span>
                                En Az Takip Eden 5 MÃ¼dÃ¼rlÃ¼k
                            </h3>
                            <div style="display: grid; gap: 10px;">
                                ${bottom5.map((md, i) => `
                                    <div style="display: flex; align-items: center; padding: 12px; background: white; border-radius: 8px; border-left: 3px solid #ef4444;">
                                        <div style="font-size: 20px; font-weight: 700; color: #ef4444; width: 40px; text-align: center;">${i + 1}</div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: 600; color: #1a1a1a; font-size: 14px;">${md.ad}</div>
                                            <div style="font-size: 12px; color: #6b7280;">${md.anketSayisi} anket</div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 20px; font-weight: 700; color: #ef4444;">${md.score.toFixed(1)}%</div>
                                            <div style="font-size: 11px; color: #6b7280;">ortalama takip</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn" onclick="pageManager.showPage('sosyal-medya')" style="background: #3b82f6;">
                                <span class="material-icons">analytics</span>
                                DetaylÄ± Sosyal Medya Analizini GÃ¶r
                            </button>
                        </div>
                    </div>
                `;
            },
            
            renderAcikUcluSummary: () => {
                const container = document.getElementById('dashboardAcikUclu');
                if (!container) return;
                
                const allSurveys = Object.values(state.processedData).flatMap(md => [...md.gecerliAnketler, ...md.gecersizAnketler]);
                const keywords = utils.analyzeKeywords(allSurveys);
                const totalResponses = allSurveys.filter(s => s.acikUclu && s.acikUclu.trim()).length;
                
                const top5 = keywords.slice(0, 5);
                const next5 = keywords.slice(5, 10);
                
                container.innerHTML = `
                    <div style="background: white; padding: 20px; border-radius: 12px; margin: 20px 0; border: 1px solid #e5e7eb;">
                        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 15px; color: #1a1a1a;">
                            ðŸ’¬ AÃ§Ä±k UÃ§lu Cevaplar - En SÄ±k GeÃ§en Kelimeler
                        </h2>
                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px; max-width: 600px; margin: 0 auto;">
                            ${top5.map((k, i) => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: white; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid #667eea;">
                                    <div>
                                        <span style="font-weight: 700; color: #667eea; margin-right: 8px;">${i + 1}.</span>
                                        <span style="font-size: 14px; font-weight: 600; color: #1a1a1a;">${k.name}</span>
                                    </div>
                                    <div style="background: #667eea; color: white; padding: 4px 12px; border-radius: 12px; font-size: 13px; font-weight: 600;">
                                        ${k.count} kez
                                    </div>
                                </div>
                            `).join('')}
                            <div id="moreKeywords" style="display: none;">
                                ${next5.map((k, i) => `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: white; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid #9ca3af;">
                                        <div>
                                            <span style="font-weight: 700; color: #6b7280; margin-right: 8px;">${i + 6}.</span>
                                            <span style="font-size: 14px; font-weight: 600; color: #1a1a1a;">${k.name}</span>
                                        </div>
                                        <div style="background: #e5e7eb; color: #374151; padding: 4px 12px; border-radius: 12px; font-size: 13px; font-weight: 600;">
                                            ${k.count} kez
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            ${keywords.length > 5 ? `
                                <button onclick="
                                    const el = document.getElementById('moreKeywords');
                                    const btn = event.target;
                                    if (el.style.display === 'none') {
                                        el.style.display = 'block';
                                        btn.textContent = 'Daha Az GÃ¶ster';
                                    } else {
                                        el.style.display = 'none';
                                        btn.textContent = 'â€¢â€¢â€¢';
                                    }
                                " style="width: 100%; margin-top: 10px; padding: 8px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 600;">
                                    â€¢â€¢â€¢
                                </button>
                            ` : ''}
                        </div>
                        <div style="text-align: center; margin-top: 15px;">
                            <button class="btn" onclick="pageManager.showPage('acik-uclu')" style="background: #667eea;">
                                <span class="material-icons">feedback</span>
                                TÃ¼m AÃ§Ä±k UÃ§lu CevaplarÄ± GÃ¶r
                            </button>
                        </div>
                    </div>
                `;
            },
            
            renderRuhSagligi: () => {
                const ruhSagligiContainer = document.getElementById('dashboardRuhSagligi');
                const sigaraContainer = document.getElementById('dashboardSigara');
                if (!ruhSagligiContainer || !sigaraContainer) return;
                
                const allValidSurveys = Object.values(state.processedData).flatMap(md => md.gecerliAnketler);
                const ruhSagligiSkor = utils.calculateAverage(allValidSurveys, [45, 46, 47, 48]);
                
                const ruhSagligiSorted = Object.values(state.processedData)
                    .sort((a, b) => parseFloat(b.ruhSagligi) - parseFloat(a.ruhSagligi));
                
                ruhSagligiContainer.innerHTML = `
                    <div style="background: white; padding: 20px; border-radius: 12px; margin: 20px 0; border: 1px solid #e5e7eb;">
                        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 15px; color: #1a1a1a;">
                            ðŸ§  Ruh SaÄŸlÄ±ÄŸÄ± TaramasÄ±
                        </h2>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <div style="background: #fef2f2; padding: 20px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">Genel Ruh SaÄŸlÄ±ÄŸÄ± Skoru</div>
                                <div style="font-size: 36px; font-weight: 700; color: #ef4444;">${ruhSagligiSkor}%</div>
                                <div style="font-size: 11px; color: #9ca3af; margin-top: 4px;">YÃ¼ksek skor = Olumsuz durum</div>
                            </div>
                            <div style="background: #f9fafb; padding: 20px; border-radius: 8px;">
                                <div style="font-size: 13px; font-weight: 600; color: #6b7280; margin-bottom: 12px;">En Riskli 3 MÃ¼dÃ¼rlÃ¼k</div>
                                ${ruhSagligiSorted.slice(0, 3).map((md, i) => `
                                    <div style="padding: 8px; background: #fef2f2; border-radius: 6px; margin-bottom: 6px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="font-size: 13px;">${i + 1}. ${md.ad}</span>
                                            <strong style="color: #ef4444;">${md.ruhSagligi}%</strong>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 15px;">
                            <button class="btn" onclick="pageManager.showPage('ruh-sagligi')" style="background: #ec4899;">
                                <span class="material-icons">psychology</span>
                                DetaylÄ± Ruh SaÄŸlÄ±ÄŸÄ± Analizini GÃ¶r
                            </button>
                        </div>
                    </div>
                `;
                
                const smokers = allValidSurveys.filter(s => s.sigara && ['evet', 'yes'].includes(s.sigara.toLowerCase())).length;
                const sigaraOrani = allValidSurveys.length > 0 ? utils.formatPercentage(smokers / allValidSurveys.length * 100) : '0';
                
                const sigaraSorted = Object.values(state.processedData)
                    .map(md => {
                        const mdSmokers = md.gecerliAnketler.filter(s => s.sigara && ['evet', 'yes'].includes(s.sigara.toLowerCase())).length;
                        const mdSigaraOrani = md.gecerliAnketler.length > 0 ? (mdSmokers / md.gecerliAnketler.length * 100) : 0;
                        return {
                            ...md,
                            sigaraKisiSayisi: mdSmokers,
                            sigaraOranNumeric: mdSigaraOrani
                        };
                    })
                    .sort((a, b) => b.sigaraOranNumeric - a.sigaraOranNumeric)
                    .filter(md => md.sigaraKisiSayisi > 0);
                
                sigaraContainer.innerHTML = `
                    <div style="background: white; padding: 20px; border-radius: 12px; margin: 20px 0; border: 1px solid #e5e7eb;">
                        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 15px; color: #1a1a1a;">
                            ðŸš¬ Sigara KullanÄ±m Analizi
                        </h2>
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px;">
                            <div style="background: #fef3c7; padding: 20px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 12px; color: #6b7280; margin-bottom: 8px;">Genel Sigara KullanÄ±m OranÄ±</div>
                                <div style="font-size: 36px; font-weight: 700; color: #f59e0b;">${sigaraOrani}%</div>
                                <div style="font-size: 11px; color: #9ca3af; margin-top: 4px;">${smokers} kiÅŸi</div>
                            </div>
                            <div style="background: #f9fafb; padding: 20px; border-radius: 8px;">
                                <div style="font-size: 13px; font-weight: 600; color: #6b7280; margin-bottom: 12px;">En Ã‡ok Sigara Kullanan 5 MÃ¼dÃ¼rlÃ¼k</div>
                                ${sigaraSorted.slice(0, 5).map((md, i) => `
                                    <div style="padding: 10px; background: white; border: 1px solid #fde68a; border-radius: 6px; margin-bottom: 8px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div style="flex: 1;">
                                                <span style="font-size: 14px; font-weight: 600;">${i + 1}. ${md.ad}</span>
                                            </div>
                                            <div style="text-align: right;">
                                                <div style="font-size: 16px; font-weight: 700; color: #f59e0b;">${utils.formatPercentage(md.sigaraOranNumeric)}%</div>
                                                <div style="font-size: 11px; color: #6b7280;">${md.sigaraKisiSayisi} kiÅŸi</div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 15px;">
                            <button class="btn" onclick="pageManager.showPage('ruh-sagligi')" style="background: #f59e0b;">
                                <span class="material-icons">analytics</span>
                                DetaylÄ± Ruh SaÄŸlÄ±ÄŸÄ± ve Sigara Analizini GÃ¶r
                            </button>
                        </div>
                    </div>
                `;
            },
            
            renderActionPriority: () => {
                const container = document.getElementById('dashboardActionPriority');
                if (!container) return;
                
                const priorityData = Object.values(state.processedData).map(md => {
                    const personelSayisi = MUDURLUKLER[md.kod]?.personel || md.gecerliAnketler.length;
                    const memnuniyetSkoru = parseFloat(md.genelMemnuniyet);
                    const priorityScore = (100 - memnuniyetSkoru) * (personelSayisi / 100);
                    
                    return {
                        kod: md.kod,
                        ad: md.ad,
                        memnuniyet: memnuniyetSkoru,
                        personel: personelSayisi,
                        priorityScore: priorityScore,
                        category: priorityScore > 15 ? 'high' : priorityScore > 8 ? 'medium' : 'low'
                    };
                }).sort((a, b) => b.priorityScore - a.priorityScore);
                
                const highPriority = priorityData.filter(d => d.category === 'high');
                const mediumPriority = priorityData.filter(d => d.category === 'medium');
                
                container.innerHTML = `
                    <div style="background: white; padding: 25px; border-radius: 12px; margin: 20px 0; border: 1px solid #e5e7eb;">
                        <h2 style="font-size: 20px; font-weight: 700; margin-bottom: 20px; color: #1a1a1a; display: flex; align-items: center; gap: 10px;">
                            <span class="material-icons" style="font-size: 28px; color: #ef4444;">priority_high</span>
                            Aksiyon Ã–ncelik Matrisi
                        </h2>
                        <p style="color: #6b7280; margin-bottom: 20px; font-size: 14px;">
                            DÃ¼ÅŸÃ¼k memnuniyet skoru + yÃ¼ksek personel sayÄ±sÄ± = yÃ¼ksek mÃ¼dahale Ã¶nceliÄŸi
                        </p>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: #ef4444; display: flex; align-items: center; gap: 8px;">
                                    <span class="material-icons">error</span>
                                    YÃ¼ksek Ã–ncelik (${highPriority.length} MÃ¼dÃ¼rlÃ¼k)
                                </h3>
                                ${highPriority.length > 0 ? highPriority.map((d, i) => `
                                    <div style="background: #fef2f2; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #ef4444;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <div style="font-weight: 600; color: #1a1a1a;">${i + 1}. #${d.kod} - ${d.ad}</div>
                                            <div style="background: #ef4444; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                                Ã–ncelik: ${d.priorityScore.toFixed(1)}
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 15px; font-size: 13px; color: #6b7280;">
                                            <span>ðŸ“‰ Memnuniyet: ${d.memnuniyet}%</span>
                                            <span>ðŸ‘¥ Personel: ${d.personel} kiÅŸi</span>
                                        </div>
                                    </div>
                                `).join('') : '<div style="color: #9ca3af; padding: 20px; text-align: center;">YÃ¼ksek Ã¶ncelikli mÃ¼dÃ¼rlÃ¼k bulunmuyor.</div>'}
                            </div>
                            
                            <div>
                                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: #f59e0b; display: flex; align-items: center; gap: 8px;">
                                    <span class="material-icons">warning</span>
                                    Orta Ã–ncelik (${mediumPriority.length} MÃ¼dÃ¼rlÃ¼k)
                                </h3>
                                ${mediumPriority.length > 0 ? mediumPriority.slice(0, 5).map((d, i) => `
                                    <div style="background: #fef3c7; padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid #f59e0b;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                                            <div style="font-weight: 600; color: #1a1a1a; font-size: 14px;">${i + 1}. #${d.kod} - ${d.ad}</div>
                                            <div style="background: #f59e0b; color: white; padding: 3px 10px; border-radius: 10px; font-size: 11px; font-weight: 600;">
                                                ${d.priorityScore.toFixed(1)}
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 12px; font-size: 12px; color: #6b7280;">
                                            <span>ðŸ“‰ ${d.memnuniyet}%</span>
                                            <span>ðŸ‘¥ ${d.personel} kiÅŸi</span>
                                        </div>
                                    </div>
                                `).join('') : '<div style="color: #9ca3af; padding: 20px; text-align: center;">Orta Ã¶ncelikli mÃ¼dÃ¼rlÃ¼k bulunmuyor.</div>'}
                                ${mediumPriority.length > 5 ? `
                                    <div style="text-align: center; margin-top: 10px; color: #6b7280; font-size: 13px;">
                                        +${mediumPriority.length - 5} mÃ¼dÃ¼rlÃ¼k daha...
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 15px;">
                            <button class="btn" onclick="pageManager.showPage('mudurluk-detay')" style="background: #ef4444;">
                                <span class="material-icons">business</span>
                                MÃ¼dÃ¼rlÃ¼k Detay Analizine Git
                            </button>
                        </div>
                    </div>
                `;
            },
            
            exportPDF: () => {
                alert('PDF rapor Ã¶zelliÄŸi yakÄ±nda eklenecek!');
            }
        };
        
        const comparisonManager = {
            updateComparison: () => {
                const select1 = document.getElementById('karsilastir1');
                const select2 = document.getElementById('karsilastir2');
                const container = document.getElementById('comparisonResult');
                
                if (!select1 || !select2 || !container) return;
                
                const kod1 = select1.value;
                const kod2 = select2.value;
                
                if (!kod1 || !kod2) {
                    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #9ca3af;">LÃ¼tfen iki mÃ¼dÃ¼rlÃ¼k seÃ§iniz...</div>';
                    return;
                }
                
                if (kod1 === kod2) {
                    container.innerHTML = '<div class="warning-box">âš ï¸ LÃ¼tfen farklÄ± iki mÃ¼dÃ¼rlÃ¼k seÃ§iniz.</div>';
                    return;
                }
                
                const md1 = state.processedData[kod1];
                const md2 = state.processedData[kod2];
                
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div style="background: white; padding: 20px; border-radius: 12px; border: 2px solid #667eea;">
                            <h3 style="color: #667eea; margin-bottom: 15px;">#${md1.kod} - ${md1.ad}</h3>
                            <div style="margin-bottom: 20px;">
                                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Genel Memnuniyet</div>
                                <div style="font-size: 32px; font-weight: 700; color: #667eea;">${md1.genelMemnuniyet}%</div>
                            </div>
                            ${Object.entries(md1.temalar).map(([key, value]) => `
                                <div style="display: flex; justify-content: space-between; padding: 8px; background: #f9fafb; border-radius: 6px; margin-bottom: 6px;">
                                    <span style="font-size: 13px; color: #374151;">${THEME_INFO[key]?.title}</span>
                                    <span style="font-weight: 600; color: #667eea;">${value}%</span>
                                </div>
                            `).join('')}
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 12px; border: 2px solid #f5576c;">
                            <h3 style="color: #f5576c; margin-bottom: 15px;">#${md2.kod} - ${md2.ad}</h3>
                            <div style="margin-bottom: 20px;">
                                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">Genel Memnuniyet</div>
                                <div style="font-size: 32px; font-weight: 700; color: #f5576c;">${md2.genelMemnuniyet}%</div>
                            </div>
                            ${Object.entries(md2.temalar).map(([key, value]) => `
                                <div style="display: flex; justify-content: space-between; padding: 8px; background: #f9fafb; border-radius: 6px; margin-bottom: 6px;">
                                    <span style="font-size: 13px; color: #374151;">${THEME_INFO[key]?.title}</span>
                                    <span style="font-weight: 600; color: #f5576c;">${value}%</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 12px; margin-top: 20px; border: 1px solid #e5e7eb;">
                        <h3 style="margin-bottom: 15px;">ðŸ“Š Tema BazlÄ± Farklar</h3>
                        ${Object.keys(THEME_INFO).map(key => {
                            const fark = parseFloat(md1.temalar[key]) - parseFloat(md2.temalar[key]);
                            const farkClass = fark >= 0 ? 'positive' : 'negative';
                            const farkSymbol = fark >= 0 ? '+' : '';
                            return `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #f3f4f6;">
                                    <span style="font-weight: 500;">${THEME_INFO[key].title}</span>
                                    <span class="${farkClass}" style="font-weight: 700;">${farkSymbol}${utils.formatPercentage(fark)}%</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            },
            
            populateSelects: () => {
                const select1 = document.getElementById('karsilastir1');
                const select2 = document.getElementById('karsilastir2');
                
                if (!select1 || !select2 || !state.processedData) return;
                
                const options = Object.values(state.processedData)
                    .map(md => `<option value="${md.kod}">#${md.kod} - ${md.ad}</option>`)
                    .join('');
                
                if (select1.options.length === 1) {
                    select1.innerHTML += options;
                }
                if (select2.options.length === 1) {
                    select2.innerHTML += options;
                }
            }
        };

        const pageManager = {
            pages: {
                'dashboard': () => `
                    <div class="info-box" style="margin-bottom: 20px;">
                        <strong>ðŸ“Š HoÅŸ Geldiniz!</strong> Bu sayfa tÃ¼m anket sonuÃ§larÄ±nÄ±n Ã¶zet gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ sunar. DetaylÄ± analizler iÃ§in sol menÃ¼den ilgili bÃ¶lÃ¼mÃ¼ seÃ§ebilirsiniz.
                    </div>
                    
                    ${!state.processedData || Object.keys(state.processedData).length === 0 ? `
                        <div style="text-align: center; padding: 60px 20px;">
                            <span class="material-icons" style="font-size: 80px; color: #d1d5db;">analytics</span>
                            <h2 style="margin: 20px 0; color: #6b7280;">HenÃ¼z Veri GirilmemiÅŸ</h2>
                            <p style="color: #9ca3af; margin-bottom: 30px;">Dashboard'u gÃ¶rÃ¼ntÃ¼lemek iÃ§in Ã¶nce "Veri GiriÅŸi" bÃ¶lÃ¼mÃ¼nden anket verilerini girin.</p>
                            <button class="btn" onclick="pageManager.showPage('veri-girisi')">
                                <span class="material-icons">input</span> Veri GiriÅŸine Git
                            </button>
                        </div>
                    ` : `
                        <!-- KRÄ°TÄ°K METRÄ°KLER -->
                        <div id="dashboardMetrics"></div>
                        
                        <!-- Ã–NCELÄ°KLÄ° MÃœDAHALE ALANLARI (UNIFIED) -->
                        <div id="dashboardUnifiedPriorities"></div>
                        
                        <!-- EN GÃœÃ‡LÃœ VE GELÄ°ÅžTÄ°RÄ°LMESÄ° GEREKEN ALANLAR -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                            <div id="dashboardStrongAreas"></div>
                            <div id="dashboardWeakAreas"></div>
                        </div>
                        
                        <!-- MÃœDÃœRLÃœK PERFORMANS GRAFÄ°ÄžÄ° -->
                        <div style="background: white; padding: 20px; border-radius: 12px; margin: 20px 0; border: 1px solid #e5e7eb;">
                            <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 15px; color: #1a1a1a;">
                                ðŸ“Š MÃ¼dÃ¼rlÃ¼klerin Memnuniyet OranlarÄ±
                            </h2>
                            <canvas id="mudurlukBarChart" style="max-height: 400px;"></canvas>
                            <div style="text-align: center; margin-top: 15px;">
                                <button class="btn" onclick="pageManager.showPage('genel-skorlar')" style="background: #667eea;">
                                    <span class="material-icons">table_chart</span>
                                    DetaylÄ± MÃ¼dÃ¼rlÃ¼k SkorlarÄ±nÄ± GÃ¶r
                                </button>
                            </div>
                        </div>
                        
                        <!-- EN Ä°YÄ° VE EN KÃ–TÃœ MÃœDÃœRLÃœKLER -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                            <div style="background: white; padding: 20px; border-radius: 12px; border: 1px solid #e5e7eb;">
                                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: #10b981;">
                                    âœ… En Memnun 5 MÃ¼dÃ¼rlÃ¼k
                                </h3>
                                <div id="topMudurlukler"></div>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 12px; border: 1px solid #e5e7eb;">
                                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: #ef4444;">
                                    ðŸ“‰ En Az Memnun 5 MÃ¼dÃ¼rlÃ¼k
                                </h3>
                                <div id="bottomMudurlukler"></div>
                            </div>
                        </div>
                        
                        <!-- SOSYAL MEDYA Ã–ZETÄ° -->
                        <div id="dashboardSosyalMedya"></div>
                        
                        <!-- AÃ‡IK UÃ‡LU Ã–ZET -->
                        <div id="dashboardAcikUclu"></div>
                        
                        <!-- RUH SAÄžLIÄžI Ã–ZET -->
                        <div id="dashboardRuhSagligi"></div>
                        
                        <!-- SÄ°GARA KULLANIMI ANALÄ°ZÄ° -->
                        <div id="dashboardSigara"></div>
                        
                        <!-- AKSÄ°YON Ã–NCELÄ°K MATRÄ°SÄ° -->
                        <div id="dashboardActionPriority"></div>
                        
                        <!-- HIZLI ERÄ°ÅžÄ°M -->
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 12px; margin: 20px 0; text-align: center;">
                            <h3 style="color: white; font-size: 18px; margin-bottom: 20px;">DetaylÄ± Analizler</h3>
                            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                                <button class="btn" onclick="pageManager.showPage('genel-skorlar')" style="background: white; color: #667eea;">
                                    <span class="material-icons">dashboard</span> Genel Skorlar
                                </button>
                                <button class="btn" onclick="pageManager.showPage('temalar')" style="background: white; color: #667eea;">
                                    <span class="material-icons">insights</span> Tema DetaylarÄ±
                                </button>
                                <button class="btn" onclick="pageManager.showPage('mudurluk-karsilastir')" style="background: white; color: #667eea;">
                                    <span class="material-icons">compare_arrows</span> MÃ¼dÃ¼rlÃ¼k KarÅŸÄ±laÅŸtÄ±r
                                </button>
                                <button class="btn" onclick="dashboardManager.exportPDF()" style="background: white; color: #667eea;">
                                    <span class="material-icons">picture_as_pdf</span> PDF Rapor Ä°ndir
                                </button>
                            </div>
                        </div>
                    `}
                `,
                
                'veri-girisi': () => `
                    <div style="margin: 15px 0;">
                        <button class="btn" onclick="dataInput.addTableRows(10)">
                            <span class="material-icons">add</span> 10 SatÄ±r Ekle
                        </button>
                        <button class="btn" onclick="dataInput.addTableRows(20)">
                            <span class="material-icons">add</span> 20 SatÄ±r Ekle
                        </button>
                        <button class="btn btn-danger" onclick="dataInput.clearTableData()">
                            <span class="material-icons">delete_sweep</span> Tabloyu Temizle
                        </button>
                        <button class="btn btn-success" onclick="dataInput.processTableData()">
                            <span class="material-icons">check_circle</span> Tablodan Verileri Ä°ÅŸle
                        </button>
                    </div>
                    
                    <div class="table-container" style="max-height: 60vh;">
                        <table id="dataTable" class="excel-table">
                            <thead>
                                <tr>
                                    <th style="min-width: 100px;">#</th>
                                    ${Array.from({length: 49}, (_, i) => `<th>S${i+1}</th>`).join('')}
                                    <th style="min-width: 80px;">Sigara</th>
                                    <th style="min-width: 200px;">Sosyal Medya</th>
                                    <th>IG_Bel</th><th>IG_BÅŸk</th><th>TW_Bel</th><th>TW_BÅŸk</th>
                                    <th>FB_Bel</th><th>FB_BÅŸk</th><th>NX_Bel</th><th>NX_BÅŸk</th>
                                    <th style="min-width: 200px;">AÃ§Ä±k UÃ§lu</th>
                                </tr>
                            </thead>
                            <tbody id="dataTableBody"></tbody>
                        </table>
                    </div>
                    
                    <div id="processStatus" style="margin-top: 20px;"></div>
                `,

                'girilen-anketler': () => `
                    <div class="info-box">
                        <strong>â„¹ï¸ AÃ§Ä±klama:</strong> Sisteme girilen tÃ¼m anketleri mÃ¼dÃ¼rlÃ¼k bazÄ±nda gÃ¶rÃ¼ntÃ¼leyin ve yÃ¶netin.
                    </div>
                    
                    <div class="stats-card" style="margin-right: 20px;">
                        <h3>ðŸ“Š Toplam Anket</h3>
                        <p id="toplamAnketSayisi">0</p>
                    </div>
                    <div class="stats-card" style="margin-right: 20px;">
                        <h3>âœ… GeÃ§erli Anket</h3>
                        <p id="gecerliAnketSayisi">0</p>
                    </div>
                    <div class="stats-card">
                        <h3>âŒ GeÃ§ersiz Anket</h3>
                        <p id="gecersizAnketSayisi">0</p>
                    </div>
                    
                    <div class="table-container" style="margin-top: 30px;">
                        <table>
                            <thead>
                                <tr>
                                    <th>MÃ¼dÃ¼rlÃ¼k</th>
                                    <th>Toplam Anket</th>
                                    <th>GeÃ§erli</th>
                                    <th>GeÃ§ersiz</th>
                                    <th>Anket KodlarÄ±</th>
                                    <th>Ä°ÅŸlemler</th>
                                </tr>
                            </thead>
                            <tbody id="girilenAnketlerBody">
                                <tr><td colspan="6" style="text-align:center; padding:30px;">HenÃ¼z anket giriÅŸi yapÄ±lmamÄ±ÅŸ...</td></tr>
                            </tbody>
                        </table>
                    </div>
                `,

                'genel-skorlar': () => `
                    <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h2 style="font-size: 20px; font-weight: 700; margin-bottom: 8px;">Genel BakÄ±ÅŸ</h2>
                        <p style="color: #6b7280; font-size: 14px; margin-bottom: 16px;">
                            ArnavutkÃ¶y Belediyesi genelindeki katÄ±lÄ±m ve memnuniyet dÃ¼zeylerini gÃ¶steren bu bÃ¶lÃ¼m.
                        </p>
                        <div id="genelBakisCards"></div>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <h2 style="font-size: 20px; font-weight: 700;">En Memnun MÃ¼dÃ¼rlÃ¼kler</h2>
                            <button class="btn btn-small" onclick="surveyManager.toggleAllDepts()" style="margin: 0;">
                                <span id="toggleDeptText">TÃ¼mÃ¼nÃ¼ GÃ¶r</span>
                                <span class="material-icons" style="font-size: 16px;">arrow_forward</span>
                            </button>
                        </div>
                        <p style="color: #6b7280; font-size: 14px; margin-bottom: 16px;">
                            Ã‡alÄ±ÅŸan memnuniyetinin en yÃ¼ksek olduÄŸu mÃ¼dÃ¼rlÃ¼kleri keÅŸfedin. Bu mÃ¼dÃ¼rlÃ¼klerin baÅŸarÄ±lÄ± uygulamalarÄ± diÄŸerlerine Ã¶rnek olabilir.
                        </p>
                        <div id="enMemnunMudurlukler"></div>
                    </div>
                    
                    <div class="info-box">
                        <strong>â„¹ï¸ AÃ§Ä±klama:</strong> TÃ¼m mÃ¼dÃ¼rlÃ¼klerin genel performans skorlarÄ± ve JD-R dengesi. <em>BaÅŸlÄ±klara tÄ±klayarak sÄ±ralayÄ±n (â‡… â†’ â–² â†’ â–¼ â†’ â‡…)</em>
                    </div>
                    
                    ${tableRenderer.createFilterBar('filterGenelInput', 'genelSkorlarTable')}
                    
                    <div class="table-container">
                        <table id="genelSkorlarTable">
                            <thead>
                                <tr>
                                    ${tableRenderer.createSortableHeader('MÃ¼dÃ¼rlÃ¼kler', 'genelSkorlarTable', 0)}
                                    ${tableRenderer.createSortableHeader('Toplam Personel', 'genelSkorlarTable', 1)}
                                    ${tableRenderer.createSortableHeader('Toplam KatÄ±lan', 'genelSkorlarTable', 2)}
                                    ${tableRenderer.createSortableHeader('GeÃ§erli Anket', 'genelSkorlarTable', 3)}
                                    ${tableRenderer.createSortableHeader('GeÃ§ersiz Anket', 'genelSkorlarTable', 4)}
                                    ${tableRenderer.createSortableHeader('KatÄ±lÄ±m OranÄ± (%)', 'genelSkorlarTable', 5)}
                                    ${tableRenderer.createSortableHeader('Genel Memnuniyet (%)', 'genelSkorlarTable', 6)}
                                    ${tableRenderer.createSortableHeader('Ä°ÅŸ YÃ¼kÃ¼/Stresi (%)', 'genelSkorlarTable', 7)}
                                    ${tableRenderer.createSortableHeader('Kurum DesteÄŸi (%)', 'genelSkorlarTable', 8)}
                                    ${tableRenderer.createSortableHeader('Ä°ÅŸ YÃ¼kÃ¼-Destek Dengesi', 'genelSkorlarTable', 9)}
                                </tr>
                            </thead>
                            <tbody id="genelSkorlarBody">
                                <tr><td colspan="10" style="text-align:center; padding:30px;">LÃ¼tfen veri giriÅŸi yapÄ±nÄ±z...</td></tr>
                            </tbody>
                        </table>
                    </div>
                `,

                'sosyal-medya': () => `
                    <div id="sosyalMedyaDashboard"></div>
                    
                    <h3 style="font-size: 18px; font-weight: 600; margin: 30px 0 15px 0; color: #1a1a1a;">DetaylÄ± Platform Analizi</h3>
                    
                    <div class="info-box">
                        <strong>â„¹ï¸ AÃ§Ä±klama:</strong> MÃ¼dÃ¼rlÃ¼klerin belediye ve baÅŸkan sosyal medya hesaplarÄ±nÄ± takip oranlarÄ±. <em>BaÅŸlÄ±klara tÄ±klayarak sÄ±ralayÄ±n (â‡… â†’ â–² â†’ â–¼ â†’ â‡…)</em>
                    </div>
                    
                    ${tableRenderer.createFilterBar('filterSosyalInput', 'sosyalMedyaTable')}
                    
                    <div class="table-container">
                        <table id="sosyalMedyaTable">
                            <thead>
                                <tr>
                                    ${tableRenderer.createSortableHeader('MÃ¼dÃ¼rlÃ¼kler', 'sosyalMedyaTable', 0)}
                                    ${tableRenderer.createSortableHeader('<svg width="16" height="16" viewBox="0 0 24 24" fill="#E1306C" style="vertical-align: middle; margin-right: 4px;"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg> Belediye', 'sosyalMedyaTable', 1)}
                                    ${tableRenderer.createSortableHeader('<svg width="16" height="16" viewBox="0 0 24 24" fill="#E1306C" style="vertical-align: middle; margin-right: 4px;"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg> BaÅŸkan', 'sosyalMedyaTable', 2)}
                                    ${tableRenderer.createSortableHeader('<svg width="16" height="16" viewBox="0 0 24 24" fill="#1DA1F2" style="vertical-align: middle; margin-right: 4px;"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg> Belediye', 'sosyalMedyaTable', 3)}
                                    ${tableRenderer.createSortableHeader('<svg width="16" height="16" viewBox="0 0 24 24" fill="#1DA1F2" style="vertical-align: middle; margin-right: 4px;"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg> BaÅŸkan', 'sosyalMedyaTable', 4)}
                                    ${tableRenderer.createSortableHeader('<svg width="16" height="16" viewBox="0 0 24 24" fill="#4267B2" style="vertical-align: middle; margin-right: 4px;"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg> Belediye', 'sosyalMedyaTable', 5)}
                                    ${tableRenderer.createSortableHeader('<svg width="16" height="16" viewBox="0 0 24 24" fill="#4267B2" style="vertical-align: middle; margin-right: 4px;"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg> BaÅŸkan', 'sosyalMedyaTable', 6)}
                                    ${tableRenderer.createSortableHeader('<svg width="16" height="16" viewBox="0 0 24 24" fill="#6B46C1" style="vertical-align: middle; margin-right: 4px;"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 6v6l4 2"/></svg> Belediye', 'sosyalMedyaTable', 7)}
                                    ${tableRenderer.createSortableHeader('<svg width="16" height="16" viewBox="0 0 24 24" fill="#6B46C1" style="vertical-align: middle; margin-right: 4px;"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 6v6l4 2"/></svg> BaÅŸkan', 'sosyalMedyaTable', 8)}
                                </tr>
                            </thead>
                            <tbody id="sosyalMedyaBody">
                                <tr><td colspan="9" style="text-align:center; padding:30px;">LÃ¼tfen veri giriÅŸi yapÄ±nÄ±z...</td></tr>
                            </tbody>
                        </table>
                    </div>
                `,

                'ruh-sagligi': () => `
                    <div class="warning-box">
                        <strong>âš ï¸ Ã–nemli:</strong> Ruh saÄŸlÄ±ÄŸÄ± taramasÄ± skorlarÄ±nda yÃ¼ksek deÄŸerler olumsuz durumu gÃ¶sterir. <em>BaÅŸlÄ±klara tÄ±klayarak sÄ±ralayÄ±n (â‡… â†’ â–² â†’ â–¼ â†’ â‡…)</em>
                    </div>
                    
                    ${tableRenderer.createFilterBar('filterRuhInput', 'ruhSagligiTable')}
                    
                    <div class="table-container">
                        <table id="ruhSagligiTable">
                            <thead>
                                <tr>
                                    ${tableRenderer.createSortableHeader('MÃ¼dÃ¼rlÃ¼kler', 'ruhSagligiTable', 0)}
                                    ${tableRenderer.createSortableHeader('Ruh SaÄŸlÄ±ÄŸÄ± Genel (%)', 'ruhSagligiTable', 1)}
                                    ${tableRenderer.createSortableHeader('Sigara KullanÄ±mÄ± (%)', 'ruhSagligiTable', 2)}
                                    ${tableRenderer.createSortableHeader('S46: Keyif Alamama', 'ruhSagligiTable', 3)}
                                    ${tableRenderer.createSortableHeader('S47: ÃœzgÃ¼n/Ã‡Ã¶kkÃ¼n', 'ruhSagligiTable', 4)}
                                    ${tableRenderer.createSortableHeader('S48: Gergin/KaygÄ±lÄ±', 'ruhSagligiTable', 5)}
                                    ${tableRenderer.createSortableHeader('S49: EndiÅŸe KontrolÃ¼', 'ruhSagligiTable', 6)}
                                </tr>
                            </thead>
                            <tbody id="ruhSagligiBody">
                                <tr><td colspan="7" style="text-align:center; padding:30px;">LÃ¼tfen veri giriÅŸi yapÄ±nÄ±z...</td></tr>
                            </tbody>
                        </table>
                    </div>
                `,

                'temalar': () => `
                    <h2 style="font-size: 20px; font-weight: 700; margin: 30px 0 15px 0; color: #1a1a1a;">ðŸ“Š Genel Belediye OranlarÄ±</h2>
                    <p style="color: #6b7280; font-size: 14px; margin-bottom: 20px;">
                        Her temanÄ±n <strong>anket sorularÄ±ndan</strong> hesaplanan performans skoru ve <strong>aÃ§Ä±k uÃ§lu yorumlardan</strong> elde edilen nitel bulgular bir arada.
                    </p>
                    
                    <div id="themeCardsContainer"></div>
                    
                    <h2 style="font-size: 20px; font-weight: 700; margin: 40px 0 15px 0; color: #1a1a1a;">ðŸ“‹ DetaylÄ± MÃ¼dÃ¼rlÃ¼k KarÅŸÄ±laÅŸtÄ±rmasÄ±</h2>
                    
                    <div class="info-box">
                        <strong>â„¹ï¸ AÃ§Ä±klama:</strong> Her temanÄ±n mÃ¼dÃ¼rlÃ¼k bazÄ±nda detaylÄ± analizi. <em>BaÅŸlÄ±klara tÄ±klayarak sÄ±ralayÄ±n (â‡… â†’ â–² â†’ â–¼ â†’ â‡…)</em>
                    </div>
                    
                    ${tableRenderer.createFilterBar('filterTemalarInput', 'temalarTable')}
                    
                    <div class="table-container">
                        <table id="temalarTable">
                            <thead>
                                <tr>
                                    ${tableRenderer.createSortableHeader('MÃ¼dÃ¼rlÃ¼kler', 'temalarTable', 0)}
                                    ${tableRenderer.createSortableHeader('Ä°ÅŸ-KiÅŸi Uyumu', 'temalarTable', 1)}
                                    ${tableRenderer.createSortableHeader('GÃ¶rev-Rol NetliÄŸi', 'temalarTable', 2)}
                                    ${tableRenderer.createSortableHeader('Talep YoÄŸunluÄŸu', 'temalarTable', 3)}
                                    ${tableRenderer.createSortableHeader('YÃ¶neticilerle Ä°liÅŸkiler', 'temalarTable', 4)}
                                    ${tableRenderer.createSortableHeader('Ã‡alÄ±ÅŸma ArkadaÅŸlarÄ±', 'temalarTable', 5)}
                                    ${tableRenderer.createSortableHeader('Kurum Ä°Ã§i Ä°letiÅŸim', 'temalarTable', 6)}
                                    ${tableRenderer.createSortableHeader('Ã‡alÄ±ÅŸma KoÅŸullarÄ±', 'temalarTable', 7)}
                                    ${tableRenderer.createSortableHeader('Kamu Hizmeti Motivasyonu', 'temalarTable', 8)}
                                    ${tableRenderer.createSortableHeader('Yetkinlik & Performans', 'temalarTable', 9)}
                                    ${tableRenderer.createSortableHeader('EÄŸitim & GeliÅŸim', 'temalarTable', 10)}
                                </tr>
                            </thead>
                            <tbody id="temalarBody">
                                <tr><td colspan="11" style="text-align:center; padding:30px;">LÃ¼tfen veri giriÅŸi yapÄ±nÄ±z...</td></tr>
                            </tbody>
                        </table>
                    </div>
                `,

                'sorular': () => `
                    <div class="info-box">
                        <strong>â„¹ï¸ AÃ§Ä±klama:</strong> Her sorunun tÃ¼m mÃ¼dÃ¼rlÃ¼klerdeki performansÄ±. <em>Soru seÃ§erek mercek altÄ±na alabilir, baÅŸlÄ±klara tÄ±klayarak sÄ±ralayabilirsiniz.</em>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin: 15px 0;">
                        <div style="flex: 1;">
                            <div style="background: #ffffff; padding: 12px 16px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                <label for="mudurlukSoruSelect" style="font-size: 13px; font-weight: 600; color: #374151; margin-right: 10px;">ðŸ¢ MÃ¼dÃ¼rlÃ¼k SeÃ§:</label>
                                <select id="mudurlukSoruSelect" onchange="sorularManager.selectMudurluk()" style="min-width: 350px;">
                                    <option value="">-- TÃ¼m MÃ¼dÃ¼rlÃ¼kler --</option>
                                </select>
                                <button class="btn btn-reset" onclick="sorularManager.resetFilters()" style="margin-left: 10px;">
                                    <span class="material-icons" style="font-size: 16px;">refresh</span> SÄ±fÄ±rla
                                </button>
                            </div>
                        </div>
                        <div style="min-width: 400px;">
                            <div style="background: #ffffff; padding: 12px 16px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                <label for="soruSelect" style="font-size: 13px; font-weight: 600; color: #374151; margin-right: 10px;">ðŸ” Soru SeÃ§:</label>
                                <select id="soruSelect" onchange="sorularManager.selectQuestion()" style="min-width: 300px;">
                                    <option value="">-- TÃ¼m Sorular --</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="sorularTable">
                            <thead id="sorularTableHead">
                                <tr>
                                    <th style="min-width:400px;">Soru</th>
                                </tr>
                            </thead>
                            <tbody id="sorularBody">
                                <tr><td style="text-align:center; padding:30px;">LÃ¼tfen veri giriÅŸi yapÄ±nÄ±z...</td></tr>
                            </tbody>
                        </table>
                    </div>
                `,

                'acik-uclu': () => `
                    <div class="info-box">
                        <strong>â„¹ï¸ AÃ§Ä±klama:</strong> MÃ¼dÃ¼rlÃ¼k bazÄ±nda en Ã§ok tekrarlanan kelimeler ve tÃ¼m aÃ§Ä±k uÃ§lu cevaplar. 
                        <strong>Kelimeler Ã¼zerine gelerek detaylarÄ± gÃ¶rebilir, cevap sayÄ±sÄ±na tÄ±klayarak tÃ¼m cevaplarÄ± okuyabilirsiniz.</strong>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th style="min-width: 250px;">MÃ¼dÃ¼rlÃ¼k</th>
                                    <th style="min-width: 400px;">En Ã‡ok GeÃ§en Kelimeler (Top 5)</th>
                                    <th style="min-width: 120px;">Toplam Cevap</th>
                                </tr>
                            </thead>
                            <tbody id="acikUcluBody">
                                <tr><td colspan="3" style="text-align:center; padding:30px;">LÃ¼tfen veri giriÅŸi yapÄ±nÄ±z...</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div id="responsesContainer" class="responses-container"></div>
                `,
                
                'mudurluk-karsilastir': () => `
                    <div class="info-box">
                        <strong>â„¹ï¸ AÃ§Ä±klama:</strong> Ä°ki mÃ¼dÃ¼rlÃ¼ÄŸÃ¼ yan yana karÅŸÄ±laÅŸtÄ±rarak gÃ¼Ã§lÃ¼ ve zayÄ±f yÃ¶nlerini analiz edin.
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div style="background: white; padding: 16px; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <label style="font-weight: 600; color: #374151; margin-bottom: 8px; display: block;">1. MÃ¼dÃ¼rlÃ¼k SeÃ§in:</label>
                            <select id="karsilastir1" onchange="comparisonManager.updateComparison()" style="width: 100%;">
                                <option value="">-- MÃ¼dÃ¼rlÃ¼k SeÃ§iniz --</option>
                            </select>
                        </div>
                        <div style="background: white; padding: 16px; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <label style="font-weight: 600; color: #374151; margin-bottom: 8px; display: block;">2. MÃ¼dÃ¼rlÃ¼k SeÃ§in:</label>
                            <select id="karsilastir2" onchange="comparisonManager.updateComparison()" style="width: 100%;">
                                <option value="">-- MÃ¼dÃ¼rlÃ¼k SeÃ§iniz --</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="comparisonResult"></div>
                `,

                'mudurluk-sec': () => `
                    <div class="info-box">
                        <strong>â„¹ï¸ AÃ§Ä±klama:</strong> SeÃ§ili mÃ¼dÃ¼rlÃ¼ÄŸÃ¼ genel belediye ortalamasÄ±yla karÅŸÄ±laÅŸtÄ±rÄ±n.
                    </div>
                    <div style="margin: 20px 0;">
                        <label for="mudurlukSelect" style="margin-right: 10px;"><strong>MÃ¼dÃ¼rlÃ¼k SeÃ§in:</strong></label>
                        <select id="mudurlukSelect" onchange="surveyManager.updateMudurlukAnalysis()">
                            <option value="">-- MÃ¼dÃ¼rlÃ¼k SeÃ§iniz --</option>
                        </select>
                    </div>
                    <div class="table-container">
                        <table id="mudurlukSecTable">
                            <thead>
                                <tr>
                                    <th style="min-width:400px;">Soru</th>
                                    <th>Genel Belediye (%)</th>
                                    <th>SeÃ§ili MÃ¼dÃ¼rlÃ¼k</th>
                                    <th>SeÃ§ili MÃ¼dÃ¼rlÃ¼k (%)</th>
                                    <th>Fark</th>
                                </tr>
                            </thead>
                            <tbody id="mudurlukSecBody">
                                <tr><td colspan="5" style="text-align:center; padding:30px;">LÃ¼tfen mÃ¼dÃ¼rlÃ¼k seÃ§iniz...</td></tr>
                            </tbody>
                        </table>
                    </div>
                `
            },

            showPage: (pageId) => {
                const contentBody = document.getElementById('contentBody');
                const pageTitle = document.getElementById('pageTitle');
                
                let menuItem = null;
                MENU_ITEMS.forEach(category => {
                    const found = category.items.find(item => item.id === pageId);
                    if (found) menuItem = found;
                });
                
                if (menuItem) {
                    pageTitle.textContent = menuItem.title;
                }
                
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const activeMenuItem = document.querySelector(`.menu-item[data-page="${pageId}"]`);
                if (activeMenuItem) {
                    activeMenuItem.classList.add('active');
                }
                
                if (pageManager.pages[pageId]) {
                    contentBody.innerHTML = `<div class="page-content active">${pageManager.pages[pageId]()}</div>`;
                    
                    if (pageId === 'veri-girisi') {
                        dataInput.addTableRows(CONFIG.MAX_TABLE_ROWS_INITIAL);
                        setTimeout(() => dataInput.setupPasteHandler(), 100);
                    }
                    
                    if (pageId === 'dashboard') {
                        setTimeout(() => dashboardManager.renderDashboard(), 100);
                    }
                    
                    if (pageId === 'mudurluk-karsilastir') {
                        setTimeout(() => {
                            comparisonManager.populateSelects();
                            comparisonManager.updateComparison();
                        }, 100);
                    }
                    
                    setTimeout(() => tableRenderer.renderAllTables(), 100);
                }
            },

            initMenu: () => {
                const menu = document.getElementById('sidebarMenu');
                
                MENU_ITEMS.forEach(category => {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'menu-category';
                    categoryDiv.textContent = category.category;
                    menu.appendChild(categoryDiv);
                    
                    category.items.forEach(item => {
                        const menuItem = document.createElement('div');
                        menuItem.className = item.highlight ? 'menu-item menu-item-highlight' : 'menu-item';
                        menuItem.dataset.page = item.id;
                        menuItem.innerHTML = `
                            <span class="material-icons menu-item-icon">${item.icon}</span>
                            <span>${item.title}</span>
                        `;
                        menuItem.onclick = () => pageManager.showPage(item.id);
                        menu.appendChild(menuItem);
                    });
                });
                
                pageManager.showPage('dashboard');
            }
        };

        // Database API Helper
        const databaseAPI = {
            async loadData() {
                try {
                    const response = await fetch('/api/survey-data');
                    const result = await response.json();
                    
                    if (result.success && result.data) {
                        state.allSurveys = result.data.allSurveys || [];
                        
                        const aiInsights = result.data.aiInsights;
                        if (aiInsights) {
                            localStorage.setItem('aiInsights', JSON.stringify(aiInsights));
                        }
                        
                        if (state.allSurveys.length > 0) {
                            state.processedData = dataProcessor.analyzeAllData(state.allSurveys);
                            console.log(`âœ… VeritabanÄ±ndan ${state.allSurveys.length} anket yÃ¼klendi`);
                        }
                    }
                } catch (error) {
                    console.error('âŒ VeritabanÄ±ndan veri yÃ¼klenemedi:', error);
                    utils.showMessage('âš ï¸ Veriler yÃ¼kleniyor...', 'warning');
                }
            },
            
            async saveData() {
                try {
                    const aiInsights = unifiedPriorityManager.getAIInsights();
                    
                    const response = await fetch('/api/survey-data', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            allSurveys: state.allSurveys,
                            aiInsights: aiInsights
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        console.log('âœ… Veriler veritabanÄ±na kaydedildi');
                        return true;
                    } else {
                        console.error('âŒ KayÄ±t hatasÄ±:', result.error);
                        return false;
                    }
                } catch (error) {
                    console.error('âŒ VeritabanÄ±na kaydetme hatasÄ±:', error);
                    return false;
                }
            }
        };

        document.addEventListener('DOMContentLoaded', async () => {
            window.dataInput = dataInput;
            window.surveyManager = surveyManager;
            window.tableSorter = tableSorter;
            window.tableFilter = tableFilter;
            window.openEndedManager = openEndedManager;
            window.sosyalMedyaManager = sosyalMedyaManager;
            window.sorularManager = sorularManager;
            window.themeManager = themeManager;
            window.dashboardManager = dashboardManager;
            window.comparisonManager = comparisonManager;
            window.pageManager = pageManager;
            window.databaseAPI = databaseAPI;
            
            await databaseAPI.loadData();
            
            pageManager.initMenu();
            
            document.body.addEventListener('click', (e) => {
                const removeBtn = e.target.closest('.remove-btn');
                if (removeBtn) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const anketKod = removeBtn.getAttribute('data-kod');
                    if (anketKod) surveyManager.removeSurvey(anketKod);
                    return false;
                }
                
                const mudurlukBtn = e.target.closest('.btn-remove-mudurluk');
                if (mudurlukBtn) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const mudurlukKod = mudurlukBtn.getAttribute('data-mudurluk');
                    if (mudurlukKod) surveyManager.removeMudurlukSurveys(mudurlukKod);
                    return false;
                }
            });
        });
    </script>
    <!-- AI INSIGHT MODAL -->
    <div id="aiInsightModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 20px; font-weight: 700; color: #1a1a1a;">ðŸ“Š AÃ§Ä±k UÃ§lu Yorum Analizi Ekle</h3>
                <button onclick="document.getElementById('aiInsightModal').style.display='none';" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">&times;</button>
            </div>
            
            <p style="font-size: 13px; color: #6b7280; margin-bottom: 20px; background: #f3f4f6; padding: 12px; border-radius: 8px;">
                â„¹ï¸ <strong>AI Prompt Åžablonu:</strong> ChatGPT'ye veya baÅŸka bir AI'ya aÃ§Ä±k uÃ§lu yorumlarÄ± gÃ¶nderin. AI'dan gelen analizi aÅŸaÄŸÄ±daki forma girin.
                <details style="margin-top: 10px;">
                    <summary style="cursor: pointer; color: #4A90E2; font-weight: 600;">AI'ya GÃ¶nderilecek Prompt (TÄ±kla)</summary>
                    <pre style="background: #1f2937; color: #10b981; padding: 12px; border-radius: 6px; font-size: 11px; margin-top: 10px; overflow-x: auto;">AÅŸaÄŸÄ±daki belediye personeli yorumlarÄ±nÄ± analiz et ve EN SIK GEÃ‡EN 5-10 KONUYU ÅŸu formatta Ã§Ä±kar:

KONU: [KÄ±sa baÅŸlÄ±k]
KaÃ§ yorumda geÃ§iyor: [sayÄ±] yorum ([yÃ¼zde]%)
Duygu: [Olumlu/NÃ¶tr/Olumsuz]
Duygu puanÄ±: [1-10, 1=Ã§ok olumsuz, 10=Ã§ok olumlu]
En sÄ±k ifadeler:
- "[ifade]" ([kaÃ§ kez] kez)
Ã–rnek yorumlar:
1. "[tam yorum]"</pre>
                </details>
            </p>
            
            <form id="aiInsightForm" onsubmit="event.preventDefault(); saveAIInsight();">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 6px;">1. Konu BaÅŸlÄ±ÄŸÄ±:</label>
                    <input type="text" id="aiTopic" required style="width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px;" placeholder="Ã–rn: Otopark YetersizliÄŸi">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 6px;">2. Duygu Durumu (1-10):</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="range" id="aiSentiment" min="1" max="10" value="5" oninput="document.getElementById('sentimentValue').textContent=this.value" style="flex: 1;">
                        <span id="sentimentValue" style="font-weight: 700; color: #4A90E2; min-width: 30px;">5</span>
                    </div>
                    <div style="font-size: 11px; color: #6b7280; margin-top: 4px;">1 = Ã‡ok olumsuz, 10 = Ã‡ok olumlu</div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 6px;">3. KaÃ§ Yorumda GeÃ§iyor (%):</label>
                        <input type="number" id="aiFrequency" required min="0" max="100" style="width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px;" placeholder="Ã–rn: 38">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 6px;">4. KaÃ§ KiÅŸi BahsetmiÅŸ:</label>
                        <input type="number" id="aiMentionCount" required min="0" style="width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px;" placeholder="Ã–rn: 184">
                    </div>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 6px;">5. En SÄ±k GeÃ§en Ä°fadeler (Her satÄ±ra bir tane):</label>
                    <textarea id="aiPhrases" rows="3" style="width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px;" placeholder='"Park yeri bulamÄ±yorum" (72 kez)
"Sabah stres otopark yÃ¼zÃ¼nden" (48 kez)'></textarea>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 6px;">6. Ã–rnek Yorumlar (Her satÄ±ra bir tane):</label>
                    <textarea id="aiExamples" rows="3" style="width: 100%; padding: 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px;" placeholder='"Sabah iÅŸe gelirken en bÃ¼yÃ¼k stresim otopark bulmak."
"Park yeri yetersiz, Ã§ok geÃ§ kalÄ±yorum."'></textarea>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button type="submit" style="flex: 1; padding: 12px; background: #4A90E2; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        Kaydet ve Listeye Ekle
                    </button>
                    <button type="button" onclick="document.getElementById('aiInsightModal').style.display='none'; document.getElementById('aiInsightForm').reset();" style="padding: 12px 20px; background: #6b7280; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                        Ä°ptal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function saveAIInsight() {
            const topic = document.getElementById('aiTopic').value;
            const sentiment = parseInt(document.getElementById('aiSentiment').value);
            const frequency = parseFloat(document.getElementById('aiFrequency').value);
            const mentionCount = parseInt(document.getElementById('aiMentionCount').value);
            const phrasesText = document.getElementById('aiPhrases').value;
            const examplesText = document.getElementById('aiExamples').value;
            
            const topPhrases = phrasesText.split('\n').filter(p => p.trim()).map(p => p.trim());
            const examples = examplesText.split('\n').filter(e => e.trim()).map(e => e.trim());
            
            const insight = {
                topic,
                sentiment,
                frequency,
                mentionCount,
                topPhrases,
                examples
            };
            
            unifiedPriorityManager.saveAIInsight(insight);
            
            document.getElementById('aiInsightModal').style.display = 'none';
            document.getElementById('aiInsightForm').reset();
            document.getElementById('sentimentValue').textContent = '5';
            
            dashboardManager.renderUnifiedPriorities();
            
            alert('âœ… AI analizi baÅŸarÄ±yla eklendi!');
        }
    </script>

</body>
</html>
